<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>爬虫进阶 | czz🕉️</title><meta name="keywords" content="爬虫"><meta name="author" content="czz🕉️"><meta name="copyright" content="czz🕉️"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="javascript调试 学习收获  浏览器的基本使用 浏览器调试断点讲解 怎么过无限debugger hook调试奇门技巧 常见补环境方法  1. 浏览器面板补充 Elements Network  保留日志  勾选每次刷新不会清除之前的请求   停用缓存  勾选后不会从缓存里面拉数据，方便后续JS动态调试    Sources   page ： 所有资源文件   filesystem： 关联本">
<meta property="og:type" content="article">
<meta property="og:title" content="爬虫进阶">
<meta property="og:url" content="https://www.fomal.cc/posts/f27b843b.html">
<meta property="og:site_name" content="czz🕉️">
<meta property="og:description" content="javascript调试 学习收获  浏览器的基本使用 浏览器调试断点讲解 怎么过无限debugger hook调试奇门技巧 常见补环境方法  1. 浏览器面板补充 Elements Network  保留日志  勾选每次刷新不会清除之前的请求   停用缓存  勾选后不会从缓存里面拉数据，方便后续JS动态调试    Sources   page ： 所有资源文件   filesystem： 关联本">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282036259.png">
<meta property="article:published_time" content="2023-02-28T12:20:36.000Z">
<meta property="article:modified_time" content="2025-05-10T07:23:28.624Z">
<meta property="article:author" content="czz🕉️">
<meta property="article:tag" content="爬虫">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282036259.png"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://www.fomal.cc/posts/f27b843b"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '爬虫进阶',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-05-10 15:23:28'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="czz🕉️" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2023/05/08/6458dafb3921a.gif" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">81</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> 八音盒</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> 影院</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> 八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> 画廊</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> 动画</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> 网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> 网站统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> 文章统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> 旧时光</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> 唠叨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-love-sign">                   </use></svg><span class="menu_word" style="font-size:17px"> 恋爱小屋</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">czz🕉️</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> 八音盒</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> 影院</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> 游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> 八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> 画廊</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> 动画</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> 网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> 网站统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> 文章统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> 旧时光</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> 唠叨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-love-sign">                   </use></svg><span class="menu_word" style="font-size:17px"> 恋爱小屋</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> 关于</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> 搜索</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="美化设置-自定义你的风格" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="浅色和深色模式转换" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">爬虫进阶</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于 </span><time class="post-meta-date-created" datetime="2023-02-28T12:20:36.000Z" title="发表于 2023-02-28 20:20:36">2023-02-28</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-10T07:23:28.624Z" title="更新于 2025-05-10 15:23:28">2025-05-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">字数总计:</span><span class="word-count">3.6w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>157分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="爬虫进阶"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="javascript调试">javascript调试</h2>
<p><strong>学习收获</strong></p>
<ul>
<li>浏览器的基本使用</li>
<li>浏览器调试断点讲解</li>
<li>怎么过无限debugger</li>
<li>hook调试奇门技巧</li>
<li>常见补环境方法</li>
</ul>
<h3 id="1-浏览器面板补充">1. 浏览器面板补充</h3>
<h4 id="Elements">Elements</h4>
<h4 id="Network">Network</h4>
<ul>
<li>保留日志
<ul>
<li>勾选每次刷新不会清除之前的请求</li>
</ul>
</li>
<li>停用缓存
<ul>
<li>勾选后不会从缓存里面拉数据，方便后续JS动态调试</li>
</ul>
</li>
</ul>
<h4 id="Sources">Sources</h4>
<ul>
<li>
<p>page ： 所有资源文件</p>
</li>
<li>
<p>filesystem： 关联本地文件</p>
</li>
<li>
<p>overrides：  可以做文件替换，比如替换JS</p>
</li>
<li>
<p>代码段：可以编写脚本，影响页面,代码记录</p>
<ul>
<li>
<pre><code class="language-javascript">var a =document.querySelector(&quot;#su&quot;)
// 可以在控制台操作 输入 a.remove()
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+ 断点介绍</span><br><span class="line"></span><br><span class="line">  地址：https:<span class="comment">//oauth.d.cn/auth/goLogin.html</span></span><br><span class="line"></span><br><span class="line">  + 跳过子函数（次态函数）执行（只在主函数内一步一步执行，不进入子函数内部）</span><br><span class="line">  + 进入子函数（次态函数）执行（在主函数内部一步一步执行，如果遇到子函数，会跳转到子函数内部一步一步执行）</span><br><span class="line">  + 跳出当前函数，回到调用位置</span><br><span class="line">  + 单步执行，会进入到函数内部 更加的细致</span><br><span class="line">  + 屏蔽断点</span><br><span class="line"></span><br><span class="line">#### Application</span><br><span class="line"></span><br><span class="line">+ </span><br><span class="line"></span><br><span class="line">### <span class="number">3</span> 断点讲解</span><br><span class="line"></span><br><span class="line">作用：对数据进行监听，跟值进行分析</span><br><span class="line"></span><br><span class="line">#### <span class="number">3.1</span> 什么是断点</span><br><span class="line"></span><br><span class="line">**网站运行时间轴**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ul>
<p>加载Hmtl - 加载JS - 运行JS初始化 - 用户触发某个事件 - 调用某段JS - 加密函数 - 给服务器发信息（XHR-SEND） - 接收到服务器数据 - 解密函数(如果数据加密的话) - 刷新网页渲染</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">示例：https:<span class="comment">//oauth.d.cn/auth/goLogin.html</span></span><br><span class="line"></span><br><span class="line">##### <span class="number">3.1</span><span class="number">.1</span> DOM事件断点</span><br><span class="line"></span><br><span class="line">+ 执行的比较靠前 距离加密函数比较远</span><br><span class="line"></span><br><span class="line">##### <span class="number">3.1</span><span class="number">.2</span> XHR断点</span><br><span class="line"></span><br><span class="line">+ 执行比较靠后 距离加密函数相对较近   可以根据栈快速定位</span><br><span class="line"></span><br><span class="line">  **注意**：非XHR发送的就断不住</span><br><span class="line"></span><br><span class="line">### <span class="number">4</span> 方法栈</span><br><span class="line"></span><br><span class="line"> 栈是一种先进后出的特殊线性表结构</span><br><span class="line"></span><br><span class="line">调用栈是解析器的一种机制，可以在脚本调用多个函数时，跟踪每个函数在完成执行时应该返回控制的点</span><br><span class="line"></span><br><span class="line">- 当脚本要调用一个函数时，解析器把该函数添加到栈中并且执行这个函数。</span><br><span class="line">- 任何被这个函数调用的函数会进一步添加到调用栈中，并且运行到它们被上个程序调用的位置。</span><br><span class="line">- 当函数运行结束后，解释器将它从堆栈中取出，并在主代码列表中继续执行代码。</span><br><span class="line"></span><br><span class="line">### <span class="number">5</span> debug原理</span><br><span class="line"></span><br><span class="line">站点：http:<span class="comment">//cpquery.cnipa.gov.cn/</span></span><br><span class="line"></span><br><span class="line">+ 无限debbugger不会真正得死循环，而是有规律得执行逻辑，一般用定时器</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">Function(<span class="string">&quot;debugger;&quot;</span>).call()</span><br></pre></td></tr></table></figure>
<h4 id="5-1-样例">5.1 样例</h4>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> ss = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;box&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">ff</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">debugger</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(ff,<span class="number">100</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    ss.<span class="property">innerHTML</span> = <span class="string">&quot;大家晚上好&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="5-1-1-浏览器过debugger">5.1.1 浏览器过debugger</h4>
<p>​	1，当定义器运行到这个debugger这个代码的时候，那么这个时候它为true，它肯定执行我们的debugger代码，那我们可以用浏览器的功能给他改成false</p>
<p>2，编辑断点</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">写个<span class="number">1</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="number">0</span>的先验条件，永远为假，就永远不会进入这个断点了。</span><br></pre></td></tr></table></figure>
<h4 id="5-1-2-方法置空">5.1.2 方法置空</h4>
<p>无限debugger产生的原因是第七行代码<code>ff</code>这个函数造成的,所以我们可以重写这个函数,使无限debugger失效.在控制台中输入<code>function ff()&#123;&#125;</code>即可,如图:</p>
<p>注：一定要在debugger进入之前</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setInterval_ba = <span class="built_in">setInterval</span></span><br><span class="line"><span class="built_in">setInterval</span> = <span class="keyword">function</span> <span class="title function_">ff</span>(<span class="params"></span>)&#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-13-过OB混淆debugger">5.13 过OB混淆debugger</h4>
<p>站点：<a target="_blank" rel="noopener" href="https://bz.zzzmh.cn/index">https://bz.zzzmh.cn/index</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__constructor_back</span> = <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span>;</span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">arguments</span> &amp;&amp; <span class="keyword">typeof</span> <span class="variable language_">arguments</span>[<span class="number">0</span>]===<span class="string">&#x27;string&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;debugger&quot;</span> === <span class="variable language_">arguments</span>[<span class="number">0</span>])&#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__constructor_back</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>,<span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-hook技术">6  hook技术</h3>
<p>Hook 是一种钩子技术，在系统没有调用函数之前，钩子程序就先得到控制权，这时钩子函数既可以加工处理（改变）该函数的执行行为，也可以强制结束消息的传递。简单来说，修改原有的 JS 代码就是 Hook。</p>
<p><strong>Hook 技术之所以能够实现有两个条件：</strong></p>
<ul>
<li>客户端拥有 JS 的最高解释权，可以决定在任何时候注入 JS，而服务器无法阻止或干预。服务端只能通过检测和混淆的手段，另 Hook 难度加大，但是无法直接阻止。</li>
<li>除了上面的必要条件之外，还有一个条件。就是 JS 是一种弱类型语言，同一个变量可以多次定义、根据需要进行不同的赋值，而这种情况如果在其他强类型语言中则可能会报错，导致代码无法执行。js 的这种特性，为我们 Hook 代码提供了便利。</li>
</ul>
<p>**注意：**JS 变量是有作用域的，只有当被 hook 函数和 debugger 断点在同一个作用域的时候，才能 hook 成功。</p>
<h4 id="6-1-Hook步骤：">6.1 <em>Hook步骤：</em></h4>
<ul>
<li>
<p>1。寻找hook的点</p>
</li>
<li>
<p>2。编写hook逻辑</p>
</li>
<li>
<p>3。调试</p>
</li>
</ul>
<p><strong>注</strong>：最常用的是<code>hook cookie</code></p>
<h4 id="6-2-HOOK-cookie操作">6.2 HOOK cookie操作</h4>
<p>WEBAPI地址：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API">https://developer.mozilla.org/zh-CN/docs/Web/API</a></p>
<p><code>Object.defineProperty </code>为对象的属性赋值，替换对象属性</p>
<p>基本语法：<code>Object.defineProperty(obj, prop, descriptor)</code>，它的作用就是直接在一个对象上定义一个新属性，或者修改一个对象的现有属性，接收的三个参数含义如下：</p>
<ul>
<li>
<p><code>obj</code>：需要定义属性的当前对象；</p>
</li>
<li>
<p><code>prop</code>：当前需要定义的属性名；</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(user,<span class="string">&quot;age&quot;</span>,&#123;</span><br><span class="line"> <span class="attr">get</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;这个人来获取值了！！&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line"> &#125;,</span><br><span class="line">    </span><br><span class="line"> <span class="attr">set</span>:<span class="keyword">function</span>(<span class="params">newVal</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;这个人来设置值了！！&quot;</span>);</span><br><span class="line">      count=newVal+<span class="number">1</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>cookie 示范</strong></p>
<p>示范例子：<a target="_blank" rel="noopener" href="http://q.10jqka.com.cn/">http://q.10jqka.com.cn/</a></p>
<p>cookie 钩子用于定位 cookie 中关键参数生成位置，以下代码演示了当 cookie 中匹配到了 <code>v</code>， 则插入断点：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> cookieTemp = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">document</span>, <span class="string">&#x27;cookie&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span> (<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (val.<span class="title function_">indexOf</span>(<span class="string">&#x27;v&#x27;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">debugger</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hook捕获到cookie设置-&gt;&#x27;</span>, val);</span><br><span class="line">      cookieTemp = val;</span><br><span class="line">      <span class="keyword">return</span> val;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> cookieTemp;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>注：正常<code>hook cookie</code>操作的时候需要清除下<code>cookie</code></p>
<h4 id="6-3-hook-方法">6.3 hook 方法</h4>
<p>站点：<a target="_blank" rel="noopener" href="https://www.wcbchina.com/login/login.html">https://www.wcbchina.com/login/login.html</a></p>
<p>我们知道在 JavaScript 中 <code>JSON.stringify()</code> 方法用于将 JavaScript 对象或值转换为 JSON 字符串，<code>JSON.parse()</code> 方法用于将一个 JSON 字符串转换为 JavaScript 对象，某些站点在向 web 服务器传输用户名密码时，会用到这两个方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> stringify = <span class="title class_">JSON</span>.<span class="property">stringify</span>;</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="property">stringify</span> = <span class="keyword">function</span>(<span class="params">params</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hook JSON.stringify ——&gt; &quot;</span>, params);</span><br><span class="line">        <span class="keyword">debugger</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">stringify</span>(params);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>首先定义了一个变量 <code>stringify</code> 保留原始 <code>JSON.stringify</code> 方法，然后重写 <code>JSON.stringify</code> 方法，遇到 <code>JSON.stringify</code> 方法就会执行 debugger 语句，会立即断下，最后将接收到的参数返回给原始的 <code>JSON.stringify</code> 方法进行处理，确保数据正常传输</p>
<h4 id="6-4-hook-XHR请求">6.4 hook  XHR请求</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> open = <span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">open</span>;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">open</span> = <span class="keyword">function</span> (<span class="params">method, url, <span class="keyword">async</span></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (url.<span class="title function_">indexOf</span>(<span class="string">&quot;analysis&quot;</span>) != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">debugger</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> open.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>定义了一个变量 <code>open</code> 保留原始 <code>XMLHttpRequest.open</code> 方法，然后重写 <code>XMLHttpRequest.open</code> 方法，判断如果 rnd 字符串值在 URL 里首次出现的位置不为 -1，即 URL 里包含 <code>analysis</code>字符串，则执行 <code>debugger</code> 语句，会立即断下。</p>
<h3 id="7-python执行JS的方式">7 python执行JS的方式</h3>
<h5 id="7-1-PyExecJS">7.1 PyExecJS</h5>
<p>地址;<a target="_blank" rel="noopener" href="https://github.com/doloopwhile/PyExecJS">https://github.com/doloopwhile/PyExecJS</a></p>
<p>PyExecJS 是使用最多的一种方式，底层实现方式是：在本地 JS 环境下运行 JS 代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install PyExecJS </span><br></pre></td></tr></table></figure>
<p>7.1.1 读取JS代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file_name, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;UTF-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">	result = file.read()</span><br></pre></td></tr></table></figure>
<p>7.1.2 execjs 类的compile()方法编译加载上面的 JS 字符串，返回一个上下文对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context1 = execjs.<span class="built_in">compile</span>(<span class="string">&quot;这里面是JS代码&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>7.1.3 调用上下文对象的call() 方法执行 JS 方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result1 = context1.call(<span class="string">&quot;函数&quot;</span>, <span class="string">&quot;参数1&quot;</span>, <span class="string">&quot;参数2&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>需要注意的，由于 PyExecJS 运行在本地 JS 环境下，使用之前会启动 JS 环境，最终导致运行速度会偏慢</p>
<p>7.1.4 eval执行</p>
<p>eval() 函数计算 JavaScript 字符串，并把它作为脚本代码来执行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">print</span>(execjs.<span class="built_in">eval</span>(<span class="string">&#x27;Date.now()&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h3 id="8-浏览器环境补充方法">8 浏览器环境补充方法</h3>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/obj-window.html">https://www.runoob.com/jsref/obj-window.html</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span> = &#123;</span><br><span class="line">    <span class="attr">cookie</span>:<span class="string">&#x27;uuid_tt_dd=10_29360271920-1658044222535-945484; __gads=ID=5b925b796ab29466-22740a5938d50041:T=1658044224:RT=1658044224:S=ALNI_MYZZ3qnATdjgh4YHRlZaBk3TnwTFw; p_uid=U010000&#x27;</span>,</span><br><span class="line">    location : &#123;</span><br><span class="line">        <span class="attr">href</span>:<span class="string">&#x27;https://www.baidu.com/s?ie=utf-8&amp;f=8&amp;rsv_bp=1&amp;rsv_idx=1&amp;tn=87135040_oem_dg&amp;wd=eval%20JS%20&amp;fenlei=256&amp;oq=eval&amp;rsv_pq=e1b3f2520003297e&amp;rsv_t=7e58%2ByqRgVEysyNAVRctyGmKUct9An%2B6da7wzdVJDXgo7qaAS1DKyn86mLazGA1IqBPpY359&amp;rqlang=cn&amp;rsv_dl=tb&amp;rsv_enter=1&amp;rsv_btype=t&amp;inputT=860&amp;rsv_sug3=56&amp;rsv_sug1=35&amp;rsv_sug7=100&amp;rsv_sug2=0&amp;rsv_sug4=1037&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">navigator = &#123;<span class="attr">userAgent</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span> = &#123;</span><br><span class="line">    <span class="variable language_">document</span> : <span class="variable language_">document</span>,</span><br><span class="line">    <span class="attr">navigator</span>:navigator</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="property">location</span>.<span class="property">href</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">getElementsByTagName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="摘要算法">摘要算法</h2>
<p>在 <code>JavaScript</code> 中和 <code>Python </code>中的基本实现方法，遇到 <code>JS</code> 加密的时候可以快速还原加密过程，有的网站在加密的过程中可能还经过了其他处理，但是大致的方法是一样的。</p>
<p>消息摘要算法/签名算法：<code>MD5、SHA、HMAC</code></p>
<h3 id="1-MD5">1. MD5</h3>
<p>简介：全称<code> MD5</code> 消息摘要算法，又称哈希算法、散列算法，由美国密码学家<code>罗纳德·李维斯特</code>设计，于 1992 年作为 RFC 1321 被公布，用以取代 MD4 算法。摘要算法是单向加密的，也就是说明文通过摘要算法加密之后，是不能解密的。摘要算法的第二个特点密文是固定长度的，它通过一个函数，把任意长度的数据转换为一个长度固定的数据串（通常用<code>16进制</code>的字符串表示）。之所以叫摘要算法，它的算法就是提取明文重要的特征。所以，两个不同的明文，使用了摘要算法之后，有可能他们的密文是一样的，不过这个概率非常的低。</p>
<h4 id="1-1-JavaScript-实现">1.1 JavaScript 实现</h4>
<p>地址：<a target="_blank" rel="noopener" href="https://www.autohome.com.cn/changsha/">https://www.autohome.com.cn/changsha/</a></p>
<p>安装对应的模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install crypto-js  --save</span><br></pre></td></tr></table></figure>
<p><strong>使用案例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引用 crypto-js 加密模块</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">CryptoJS</span> = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MD5Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> text = <span class="string">&quot;I love python!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(text).<span class="title function_">toString</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">MD5Test</span>())  <span class="comment">// 21169ee3acd4a24e1fcb4322cfd9a2b8</span></span><br></pre></td></tr></table></figure>
<h4 id="1-2-Python-实现">1.2 Python 实现</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_test2</span>():</span><br><span class="line">    md5 = hashlib.md5()</span><br><span class="line">    md5.update(<span class="string">&#x27;python&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(md5.hexdigest())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    md5_test2()  <span class="comment"># 21169ee3acd4a24e1fcb4322cfd9a2b8</span></span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong><code>MD5</code>哈希视为字符串，而是将其视为十六进制数， <code>MD5</code>哈希长度为128位，通常由<code>32</code>个十六进制数字表示。</p>
<h3 id="2-SHA">2. SHA</h3>
<p>简介：全称安全哈希算法，由美国国家安全局<code>（NSA）</code>所设计，主要适用于数字签名标准里面定义的数字签名算法，<code>SHA</code> 通常指 <code>SHA</code> 家族的五个算法，分别是<code> SHA-1、SHA-224、SHA-256、SHA-384、SHA-512</code>，<code>SHA</code> 是比 <code>MD5</code> 更安全一点的摘要算法，<code>MD5</code> 的密文是 32 位，而 <code>SHA-1</code> 是 40 位，版本越强，密文越长，代价是速度越慢。</p>
<h4 id="2-1-JavaScript-实现">2.1  JavaScript 实现</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引用 crypto-js 加密模块</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">CryptoJS</span> = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SHA1Encrypt</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> text = <span class="string">&quot;I love python!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="title class_">SHA1</span>(text).<span class="title function_">toString</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">SHA1Encrypt</span>())  <span class="comment">// 23c02b203bd2e2ca19da911f1d270a06d86719fb</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-Python-实现">2.2 Python 实现</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sha1_test2</span>():</span><br><span class="line">    sha1 = hashlib.sha1()</span><br><span class="line">    sha1.update(<span class="string">&#x27;I love python!&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(sha1.hexdigest())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    sha1_test2()  <span class="comment"># 23c02b203bd2e2ca19da911f1d270a06d86719fb</span></span><br></pre></td></tr></table></figure>
<h3 id="3-HMAC">3. <code>HMAC</code></h3>
<p>简介：全称散列消息认证码、密钥相关的哈希运算消息认证码，于 1996 年提出，1997 年作为 RFC 2104 被公布，<code>HMAC</code> 加密算法是一种安全的基于加密 <code>Hash</code> 函数和共享密钥的消息认证协议，它要求通信双方共享密钥 key、约定算法、对报文进行 <code>Hash</code> 运算，形成固定长度的认证码。通信双方通过认证码的校验来确定报文的合法性。</p>
<p>参考资料：</p>
<ul>
<li>百科：<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/hmac/7307543?fr=aladdin">https://baike.baidu.com/item/hmac/7307543?fr=aladdin</a></li>
</ul>
<h4 id="3-1-JavaScript-实现">3.1 JavaScript 实现</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引用 crypto-js 加密模块</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">CryptoJS</span> = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">HMACEncrypt</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> text = <span class="string">&quot;I love python!&quot;</span></span><br><span class="line">    <span class="keyword">var</span> key = <span class="string">&quot;secret&quot;</span>   <span class="comment">// 密钥文件</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">CryptoJS</span>.<span class="title class_">HmacMD5</span>(text, key).<span class="title function_">toString</span>();</span><br><span class="line">    <span class="comment">// return CryptoJS.HmacSHA1(text, key).toString();</span></span><br><span class="line">    <span class="comment">// return CryptoJS.HmacSHA256(text, key).toString();</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">HMACEncrypt</span>())</span><br></pre></td></tr></table></figure>
<h4 id="3-2-Python-实现">3.2 Python 实现</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hmac_test1</span>():</span><br><span class="line">    message = <span class="string">b&#x27;I love python!&#x27;</span></span><br><span class="line">    key = <span class="string">b&#x27;secret&#x27;</span></span><br><span class="line">    md5 = hmac.new(key, message, digestmod=<span class="string">&#x27;MD5&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(md5.hexdigest())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hmac_test2</span>():</span><br><span class="line">    key = <span class="string">&#x27;secret&#x27;</span>.encode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    sha1 = hmac.new(key, digestmod=<span class="string">&#x27;sha1&#x27;</span>)</span><br><span class="line">    sha1.update(<span class="string">&#x27;I love &#x27;</span>.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line">    sha1.update(<span class="string">&#x27;Python!&#x27;</span>.encode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(sha1.hexdigest())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    hmac_test1()  <span class="comment"># 9c503a1f852edcc3526ea56976c38edf</span></span><br><span class="line">    hmac_test2()  <span class="comment"># 2d8449a4292d4bbeed99ce9ea570880d6e19b61a</span></span><br></pre></td></tr></table></figure>
<h3 id="4-实战案例">4. 实战案例</h3>
<h4 id="4-1-案例-md5加密逆向">4.1 案例 <code>md5</code>加密逆向</h4>
<h5 id="4-1-1-逆向目标">4.1.1 <strong>逆向目标</strong></h5>
<ul>
<li>
<p>主页：<a target="_blank" rel="noopener" href="http://fanyi.youdao.com/">http://fanyi.youdao.com/</a></p>
</li>
<li>
<p>逆向字段：<code>sign: 'asdasdasdasdasdasdasd'</code></p>
</li>
</ul>
<h5 id="4-1-2-逆向分析">4.1.2 <strong>逆向分析</strong></h5>
<ol>
<li>先进行抓包，可以看到有一个签名信息 <code>sign</code></li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c1ba28035.png" alt="image-20241128090455920" style="zoom:33%;" />
<ol start="2">
<li>数据加密位置，可以在这儿进行分析</li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c1dab8655.png" alt="image-20241128090525355" style="zoom:33%;" />
<h5 id="4-1-3-python代码模拟">4.1.3 <strong>python代码模拟</strong></h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@author: 夏洛</span></span><br><span class="line"><span class="string">@QQ: 1972386194</span></span><br><span class="line"><span class="string">@site: https://www.tulingxueyuan.cn/</span></span><br><span class="line"><span class="string">@file: 网易云.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests,time,random</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Crawl</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;OUTFOX_SEARCH_USER_ID=322076570@10.169.0.83; JSESSIONID=aaaZhLm5ZNK87a08TerIx; OUTFOX_SEARCH_USER_ID_NCOO=1158799533.2810698; ___rl__test__cookies=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(math.ceil(time.time() * <span class="number">1000</span>)),</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36&#x27;</span>,</span><br><span class="line"></span><br><span class="line">            <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://fanyi.youdao.com/&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.url = <span class="string">&#x27;http://fanyi.youdao.com/translate_o?smartresult=dict&amp;smartresult=rule&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">spider</span>(<span class="params">self,key</span>):</span><br><span class="line"></span><br><span class="line">        times = <span class="built_in">str</span>(math.ceil(time.time() * <span class="number">1000</span>) + random.randint(<span class="number">1</span>, <span class="number">10</span>))</span><br><span class="line">        sign = <span class="variable language_">self</span>.Md5(<span class="string">&quot;fanyideskweb&quot;</span> + key + <span class="built_in">str</span>(times) + <span class="string">&quot;Tbh5E8=q6U3EXe+&amp;L[4c@&quot;</span>)</span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;i&quot;</span>: key,</span><br><span class="line">            <span class="string">&quot;from&quot;</span>: <span class="string">&quot;AUTO&quot;</span>,</span><br><span class="line">            <span class="string">&quot;to&quot;</span>: <span class="string">&quot;AUTO&quot;</span>,</span><br><span class="line">            <span class="string">&quot;smartresult&quot;</span>: <span class="string">&quot;dict&quot;</span>,</span><br><span class="line">            <span class="string">&quot;client&quot;</span>: <span class="string">&quot;fanyideskweb&quot;</span>,</span><br><span class="line">            <span class="string">&quot;salt&quot;</span>: times,</span><br><span class="line">            <span class="string">&quot;sign&quot;</span>: sign,</span><br><span class="line">            <span class="string">&quot;lts&quot;</span>: times[:-<span class="number">1</span>],</span><br><span class="line">            <span class="string">&quot;bv&quot;</span>: <span class="string">&quot;cda1e53e0c0eb8dd4002cefc117fa588&quot;</span>,</span><br><span class="line">            <span class="string">&quot;doctype&quot;</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="string">&quot;version&quot;</span>: <span class="string">&quot;2.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;keyfrom&quot;</span>: <span class="string">&quot;fanyi.web&quot;</span>,</span><br><span class="line">            <span class="string">&quot;action&quot;</span>: <span class="string">&quot;FY_BY_REALTlME&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(<span class="variable language_">self</span>.url, data=data, headers=<span class="variable language_">self</span>.headers).json()</span><br><span class="line">        <span class="keyword">if</span> res.get(<span class="string">&#x27;errorCode&#x27;</span>) == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;执行的结果:&#x27;</span> + res.get(<span class="string">&#x27;translateResult&#x27;</span>)[<span class="number">0</span>][<span class="number">0</span>][<span class="string">&#x27;tgt&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Md5</span>(<span class="params">self,value</span>):</span><br><span class="line">        md = hashlib.md5()</span><br><span class="line">        md.update(value.encode(<span class="string">&#x27;utf8&#x27;</span>)) <span class="comment"># 接收字节类型  16进制表示</span></span><br><span class="line">        <span class="keyword">return</span> md.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        s = <span class="built_in">input</span>(<span class="string">&#x27;请输入你不懂的话术&amp;&amp;输入y退出:&#x27;</span>)</span><br><span class="line">        Crawl().spider(s)</span><br><span class="line">        <span class="keyword">if</span> s == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="4-2-案例sha256系列">4.2 案例<code>sha256</code>系列</h4>
<p><strong>逆向目标</strong></p>
<ul>
<li>
<p>主页：<a target="_blank" rel="noopener" href="http://www.hh1024.com/">http://www.hh1024.com/</a></p>
</li>
<li>
<p>接口：<a target="_blank" rel="noopener" href="https://ucp.hrdjyun.com:60359/api/dy">https://ucp.hrdjyun.com:60359/api/dy</a></p>
</li>
<li>
<p>逆向参数：<code>sign: &quot;0d2864b1420c42f12de6efeff30bcb4b458157d8177675b8910fa632524604cb&quot;</code></p>
</li>
</ul>
<h5 id="4-2-1-抓包分析：">4.2.1  抓包分析：</h5>
<ol>
<li>通过对比，可以发现这个参数每次都会切换</li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c1fd8207b.png" alt="image-20241128090603065" style="zoom:33%;" />
<h5 id="4-2-2-调试加密地地点">4.2.2 调试加密地地点</h5>
<ol>
<li>打开全局搜索 <code>sign</code>关键字</li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c220b79e8.png" alt="image-20241128090638600" style="zoom:33%;" />
<ol start="2">
<li>参数加密地点</li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c23b12bbd.png" alt="image-20241128090705223" style="zoom:67%;" />
<h5 id="4-2-3-python代码实现">4.2.3 python代码实现</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib3,requests,time,json</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">months = <span class="built_in">input</span>(<span class="string">&quot;请输入查询月份：&quot;</span>)</span><br><span class="line">days = <span class="built_in">input</span>(<span class="string">&quot;请输入查询日期,2天以内：&quot;</span>)</span><br><span class="line">times = <span class="built_in">str</span>(<span class="built_in">int</span>(time.time()) * <span class="number">1000</span>)</span><br><span class="line">params = &#123;<span class="string">&quot;no&quot;</span>:<span class="string">&quot;dy0002&quot;</span>,<span class="string">&quot;data&quot;</span>:&#123;<span class="string">&quot;days&quot;</span>:<span class="number">1</span>,<span class="string">&quot;rankType&quot;</span>:<span class="number">5</span>,<span class="string">&quot;liveDay&quot;</span>:<span class="string">f&quot;2022-<span class="subst">&#123;months.zfill(<span class="number">2</span>)&#125;</span>-<span class="subst">&#123;days.zfill(<span class="number">2</span>)&#125;</span>&quot;</span>&#125;&#125;</span><br><span class="line"><span class="built_in">print</span>(params)</span><br><span class="line">dd = json.dumps(params)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sign</span>():</span><br><span class="line">    data = <span class="string">f&#x27;param=<span class="subst">&#123;dd&#125;</span>&amp;timestamp=<span class="subst">&#123;times&#125;</span>&amp;tenant=1&amp;salt=kbn%&amp;)@&lt;?FGkfs8sdf4Vg1*+;`kf5ndl$&#x27;</span>  <span class="comment"># 要进行加密的数据</span></span><br><span class="line">    data_sha = hashlib.sha256(data.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> data_sha</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():</span><br><span class="line">    s = get_sign()</span><br><span class="line">    datas = &#123;<span class="string">&quot;param&quot;</span>:dd,<span class="string">&quot;sign&quot;</span>:s,<span class="string">&quot;tenant&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;timestamp&quot;</span>:times,<span class="string">&quot;token&quot;</span>:t&#125;</span><br><span class="line">    url = <span class="string">&#x27;https://ucp.hrdjyun.com:60359/api/dy&#x27;</span></span><br><span class="line">    res = session.post(url,headers=headers,data=json.dumps(datas))</span><br><span class="line">    <span class="keyword">if</span> res.json().get(<span class="string">&#x27;status&#x27;</span>) == <span class="number">0</span>:</span><br><span class="line">        data = res.json().get(<span class="string">&#x27;data&#x27;</span>)[<span class="string">&#x27;rankList&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> d <span class="keyword">in</span> data:</span><br><span class="line">            items = &#123;&#125;</span><br><span class="line">            items[<span class="string">&#x27;抖音名&#x27;</span>] = d.get(<span class="string">&#x27;anchorName&#x27;</span>)</span><br><span class="line">            items[<span class="string">&#x27;带货销量&#x27;</span>] =<span class="string">&#x27;%.2f&#x27;</span> % (d.get(<span class="string">&#x27;salesVolume&#x27;</span>) / <span class="number">10000</span>) + <span class="string">&#x27;万&#x27;</span></span><br><span class="line">            items[<span class="string">&#x27;带货销售额&#x27;</span>] = <span class="string">&#x27;%.2f&#x27;</span> % (d.get(<span class="string">&#x27;salesMoney&#x27;</span>) / <span class="number">1000000</span>) + <span class="string">&#x27;万&#x27;</span></span><br><span class="line">            items[<span class="string">&#x27;粉丝&#x27;</span>] = <span class="string">&#x27;%.2f&#x27;</span> % (d.get(<span class="string">&#x27;fans&#x27;</span>) / <span class="number">10000</span>) + <span class="string">&#x27;万&#x27;</span></span><br><span class="line">            items[<span class="string">&#x27;在线人数&#x27;</span>] = <span class="string">&#x27;%.2f&#x27;</span> % (d.get(<span class="string">&#x27;online&#x27;</span>) / <span class="number">10000</span>) + <span class="string">&#x27;万&#x27;</span></span><br><span class="line">            items[<span class="string">&#x27;时间&#x27;</span>]  =d.get(<span class="string">&#x27;liveDay&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(items)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    reads = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        本接口只开放抖音带货销量日榜</span></span><br><span class="line"><span class="string">        可以根据日期查询</span></span><br><span class="line"><span class="string">                                --- 夏洛</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(reads)</span><br><span class="line">    get_data()</span><br></pre></td></tr></table></figure>
<h2 id="对称加密">对称加密</h2>
<p>对称加密（加密解密密钥相同）：DES、3DES、AES、RC4</p>
<p><strong>简介</strong></p>
<p>对称式加密就是加密和解密使用同一个密钥。信息接收双方都需事先知道密匙和加解密算法且其密匙是相同的，之后便是对数据进行加解密了。对称加密算法用来对敏感数据等信息进行加密。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c25a73853.png" alt="image-20241128090736472" style="zoom:50%;" />
<h3 id="常见算法归纳">常见算法归纳</h3>
<p>DES：56位密钥，由于密钥太短，被逐渐被弃用。</p>
<p>AES：有128位、192位、256位密钥，现在比较流行。密钥长、可以增加破解的难度和成本。</p>
<h3 id="1-DES算法">1. DES算法</h3>
<p>简介：<strong>DES</strong>是一种分组<strong>加密算法</strong>，他以<code>64</code>位为分组对数据加密。<code>64</code>位一组的明文从算法的一端 输入，<code>64</code>位的密文从另一端输出。<strong>DES</strong>是一个对称算法：加密和解密用的是同一个算法（除 密钥编排不同以外）。</p>
<p>密钥的长度为<code>56</code>位(密钥通常表示为<code>64</code>位的数，但每个第8位都用作奇偶检验，可以忽 略)。密钥可以是任意的<code>56</code>位数，且可以在任意的时候改变。</p>
<p><strong>DES</strong>算法的入口参数有3个：<code>Key，Data，Mode</code>。其中<code>Key</code>为8个字节共64位，是<strong>DES</strong>算法 的工作密钥；<code>Data</code>也为8个字节64位，是要被加密或解密的数据：Mode为<strong>DES</strong>的工作方式，有 两种：加密或解密。</p>
<p>DES算法的工作过程：若Mode为加密，则用Key对数据Data进行加密，生成Data的密码 形式（64位）作为DES的输出结果；若Mode为解密，则用Key对密码形式的数据Data解密，还 原为Data的明码形式（64位）作为DES的输出结果。<br>
　　 简单地说，算法只不过是加密的一种基本技术，DES基本组建分组是这些技术的一种组合 ，他基于密钥作用于明文，这是众所周知的轮（round）。DES有16轮，这意味着要在明文分 组上16次实施相同的组合技术。</p>
<ul>
<li>mode 支持：CBC，CFB，CTR，CTRGladman，ECB，OFB 等。</li>
<li>padding 支持：ZeroPadding，NoPadding，AnsiX923，Iso10126，Iso97971，Pkcs7 等。</li>
</ul>
<p><strong>工作模式归纳</strong></p>
<ul>
<li>
<p><strong>ECB模式</strong> 全称Electronic Codebook模式，译为电子密码本模式</p>
</li>
<li>
<p><strong>CBC模式</strong> 全称Cipher Block Chaining模式，译为密文分组链接模式</p>
</li>
<li>
<p><strong>CFB模式</strong> 全称Cipher FeedBack模式，译为密文反馈模式</p>
</li>
<li>
<p><strong>OFB模式</strong> 全称Output Feedback模式，译为输出反馈模式。</p>
</li>
<li>
<p><strong>CTR模式</strong> 全称Counter模式，译为计数器模式。</p>
</li>
</ul>
<p>iv: 防止同样的明文块、加密成同样的密文块</p>
<p><strong>参考资料：</strong></p>
<ul>
<li>RFC 4772：<a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/rfc4772/">https://datatracker.ietf.org/doc/rfc4772/</a></li>
<li>DES 维基百科：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Data_Encryption_Standard">https://en.wikipedia.org/wiki/Data_Encryption_Standard</a></li>
</ul>
<h4 id="1-1-JavaScript-实现-2">1.1 JavaScript 实现</h4>
<p><code>DES</code>算法的入口参数有3个</p>
<ul>
<li><code>key、DATA、Mode、padding</code>
<ul>
<li><code>key</code>为<code>7个字节</code>共56位，是DES算法的工作密钥</li>
<li><code>Data</code>为<code>8个字节</code>64位，是要被加密或被解密的数据</li>
<li><code>Mode</code>为<code>DES</code>的工作方式</li>
<li><code>padding</code>为填充模式，如果加密后密文长度如果达不到指定整数倍（8个字节，16个字节），填充</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引用 crypto-js 加密模块 </span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">CryptoJS</span> = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">desEncrypt</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(desKey),</span><br><span class="line">        iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(desIv),</span><br><span class="line">        srcs = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(text),</span><br><span class="line">        <span class="comment">// CBC 加密模式，Pkcs7 填充方式</span></span><br><span class="line">        encrypted = <span class="title class_">CryptoJS</span>.<span class="property">DES</span>.<span class="title function_">encrypt</span>(srcs, key, &#123;</span><br><span class="line">            <span class="attr">iv</span>: iv,</span><br><span class="line">            <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">            <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="keyword">return</span> encrypted.<span class="title function_">toString</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">desDecrypt</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(desKey),</span><br><span class="line">        iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(desIv),</span><br><span class="line">        srcs = encryptedData,</span><br><span class="line">        <span class="comment">// CBC 加密模式，Pkcs7 填充方式</span></span><br><span class="line">        decrypted = <span class="title class_">CryptoJS</span>.<span class="property">DES</span>.<span class="title function_">decrypt</span>(srcs, key, &#123;</span><br><span class="line">            <span class="attr">iv</span>: iv,</span><br><span class="line">            <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">            <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="keyword">return</span> decrypted.<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> text = <span class="string">&quot;I love Python!&quot;</span>       <span class="comment">// 待加密对象</span></span><br><span class="line"><span class="keyword">var</span> desKey = <span class="string">&quot;6f726c64f2c2057&quot;</span>    <span class="comment">// 密钥</span></span><br><span class="line"><span class="keyword">var</span> desIv = <span class="string">&quot;0123456789ABCDEF&quot;</span>    <span class="comment">// 初始向量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> encryptedData = <span class="title function_">desEncrypt</span>()</span><br><span class="line"><span class="keyword">var</span> decryptedData = <span class="title function_">desDecrypt</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;加密字符串: &quot;</span>, encryptedData)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;解密字符串: &quot;</span>, decryptedData)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密字符串:  +ndbEkWNw2QAfIYQtwC14w==</span></span><br><span class="line"><span class="comment">// 解密字符串:  I love Python!</span></span><br></pre></td></tr></table></figure>
<h4 id="1-2-Python-实现-2">1.2 Python 实现</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyDes</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="comment"># 加密模式 CBC，填充方式 PAD_PKCS5</span></span><br><span class="line"><span class="keyword">from</span> pyDes <span class="keyword">import</span> des, CBC, PAD_PKCS5</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_encrypt</span>(<span class="params">key, text, iv</span>):</span><br><span class="line">    k = des(key, CBC, iv, pad=<span class="literal">None</span>, padmode=PAD_PKCS5)</span><br><span class="line">    en = k.encrypt(text, padmode=PAD_PKCS5)</span><br><span class="line">    <span class="keyword">return</span> binascii.b2a_hex(en)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_decrypt</span>(<span class="params">key, text, iv</span>):</span><br><span class="line">    k = des(key, CBC, iv, pad=<span class="literal">None</span>, padmode=PAD_PKCS5)</span><br><span class="line">    de = k.decrypt(binascii.a2b_hex(text), padmode=PAD_PKCS5)</span><br><span class="line">    <span class="keyword">return</span> de</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    secret_key = <span class="string">&#x27;12345678&#x27;</span>   <span class="comment"># 密钥</span></span><br><span class="line">    text = <span class="string">&#x27;hello world&#x27;</span>   <span class="comment"># 加密对象</span></span><br><span class="line">    iv = secret_key           <span class="comment"># 偏移量</span></span><br><span class="line">    secret_str = des_encrypt(secret_key, text, iv)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;加密字符串：&#x27;</span>, secret_str)</span><br><span class="line">    clear_str = des_decrypt(secret_key, secret_str, iv)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;解密字符串：&#x27;</span>, clear_str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密字符串：b&#x27;302d3abf2421169239f829b38a9545f1&#x27;</span></span><br><span class="line"><span class="comment"># 解密字符串：b&#x27;I love Python!&#x27;</span></span><br></pre></td></tr></table></figure>
<p>总结：<a target="_blank" rel="noopener" href="https://www.processon.com/view/link/6374f0e10e3e742ce7bd597b">https://www.processon.com/view/link/6374f0e10e3e742ce7bd597b</a></p>
<h4 id="1-3-实操练习1">1.3 实操练习1</h4>
<p>地址：<a target="_blank" rel="noopener" href="https://bqcm0.cavip1.com/">https://bqcm0.cavip1.com/</a></p>
<p>地址：<a target="_blank" rel="noopener" href="http://www.91118.com/Passport/Account/Login">http://www.91118.com/Passport/Account/Login</a></p>
<h4 id="1-4-实操练习2">1.4 实操练习2</h4>
<h5 id="1-3-1-逆向目标">1.3.1 逆向目标</h5>
<p>首页：<a target="_blank" rel="noopener" href="https://www.endata.com.cn/BoxOffice/BO/Month/oneMonth.html">https://www.endata.com.cn/BoxOffice/BO/Month/oneMonth.html</a></p>
<p>数据：<a target="_blank" rel="noopener" href="https://www.endata.com.cn/API/GetData.ashx">https://www.endata.com.cn/API/GetData.ashx</a></p>
<p>逆向：加密数据</p>
<h5 id="1-3-2-逆向分析">1.3.2 逆向分析</h5>
<ul>
<li>使用xhr断点数据地址，进行单步调试</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c299ae205.png" alt="image-20241128090839590" style="zoom:33%;" />
<ul>
<li>调试对应的数据</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c2b7366b2.png" alt="image-20241128090908331" style="zoom:33%;" />
<p>总结：可以看到他是对数据用<code>webInstace.shell</code>进行了解密</p>
<h5 id="1-3-3-数据还原">1.3.3  数据还原</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-AES算法">2. AES算法</h3>
<p><strong>环境安装</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pycryptodome -i pip源</span><br></pre></td></tr></table></figure>
<h4 id="2-1-算法简介">2.1 算法简介</h4>
<p>​		简介：全称高级加密标准（英文名称：Advanced Encryption Standard），在密码学中又称 Rijndael 加密法，由美国国家标准与技术研究院 （NIST）于 2001 年发布，并在 2002 年成为有效的标准，是美国联邦政府采用的一种区块加密标准。这个标准用来替代原先的 DES，已经被多方分析且广为全世界所使用，它本身只有一个密钥，即用来实现加密，也用于解密。</p>
<ul>
<li>mode 支持：CBC，CFB，CTR，CTRGladman，ECB，OFB 等。</li>
<li>padding 支持：ZeroPadding，NoPadding，AnsiX923，Iso10126，Iso97971，Pkcs7 等。</li>
</ul>
<p><strong>参考资料：</strong></p>
<ul>
<li>RFC 3268：<a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/rfc3268/">https://datatracker.ietf.org/doc/rfc3268/</a></li>
<li>AES 维基百科：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">https://en.wikipedia.org/wiki/Advanced_Encryption_Standard</a></li>
</ul>
<p><strong>参数定义：</strong></p>
<ol>
<li>key length（密钥位数，密码长度）<code>AES128，AES192，AES256（128 位、192 位或 256 位）</code></li>
<li>key （密钥，密码）key指的就是密码了，<code>AES128</code>就是<code>128位</code>的，如果位数不够，某些库可能会自动填充到<code>128</code>。</li>
<li>IV （向量）IV称为初始向量，不同的IV加密后的字符串是不同的，加密和解密需要相同的IV。</li>
<li>mode （加密模式）AES分为几种模式，比如ECB，CBC，CFB等等，这些模式除了ECB由于没有使用IV而不太安全，其他模式差别并没有太明显。</li>
<li>padding （填充方式）对于加密解密两端需要使用同一的PADDING模式，大部分PADDING模式为<code>PKCS5, PKCS7, NOPADDING</code>。</li>
</ol>
<p><strong>加密原理：</strong></p>
<p>​		AES加密算法采用分组密码体制，每个分组数据的长度为<code>128位16个字节</code>，密钥长度可以是<code>128位16个字节</code>、<code>192位或256位</code>，一共有四种加密模式，我们通常采用需要初始向量IV的CBC模式，初始向量的长度也是<code>128位16个字节</code>。</p>
<h4 id="2-2-JavaScript-实现">2.2  JavaScript 实现</h4>
<p>类似网站：<a target="_blank" rel="noopener" href="https://www.dns.com/login.html">https://www.dns.com/login.html</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引用 crypto-js 加密模块</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">CryptoJS</span> = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tripleAesEncrypt</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(aesKey),</span><br><span class="line">        iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(aesIv),</span><br><span class="line">        srcs = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(text),</span><br><span class="line">        <span class="comment">// CBC 加密方式，Pkcs7 填充方式</span></span><br><span class="line">        encrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(srcs, key, &#123;</span><br><span class="line">            <span class="attr">iv</span>: iv,</span><br><span class="line">            <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">            <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="keyword">return</span> encrypted.<span class="title function_">toString</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tripleAesDecrypt</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(aesKey),</span><br><span class="line">        iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(aesIv),</span><br><span class="line">        srcs = encryptedData,</span><br><span class="line">        <span class="comment">// CBC 加密方式，Pkcs7 填充方式</span></span><br><span class="line">        decrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(srcs, key, &#123;</span><br><span class="line">            <span class="attr">iv</span>: iv,</span><br><span class="line">            <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">            <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="keyword">return</span> decrypted.<span class="title function_">toString</span>(<span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> text = <span class="string">&quot;I love Python!&quot;</span>       <span class="comment">// 待加密对象</span></span><br><span class="line"><span class="keyword">var</span> aesKey = <span class="string">&quot;6f726c64f2c2057c&quot;</span>   <span class="comment">// 密钥，16 倍数</span></span><br><span class="line"><span class="keyword">var</span> aesIv = <span class="string">&quot;0123456789ABCDEF&quot;</span>    <span class="comment">// 偏移量，16 倍数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> encryptedData = <span class="title function_">tripleAesEncrypt</span>()</span><br><span class="line"><span class="keyword">var</span> decryptedData = <span class="title function_">tripleAesDecrypt</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;加密字符串: &quot;</span>, encryptedData)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;解密字符串: &quot;</span>, decryptedData)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密字符串:  dZL7TLJR786VGvuUvqYGoQ==</span></span><br><span class="line"><span class="comment">// 解密字符串:  I love Python!</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-Python-实现">2.3 Python 实现</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要补位，str不是16的倍数那就补足为16的倍数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_to_16</span>(<span class="params">value</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(value) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">        value += <span class="string">&#x27;\0&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>.encode(value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密方法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encrypt</span>(<span class="params">key, t, iv</span>):</span><br><span class="line">    aes = AES.new(add_to_16(key), AES.MODE_CBC, add_to_16(iv))  <span class="comment"># 初始化加密器</span></span><br><span class="line">    encrypt_aes = aes.encrypt(add_to_16(t))                    <span class="comment"># 先进行 aes 加密</span></span><br><span class="line">    encrypted_text = <span class="built_in">str</span>(base64.encodebytes(encrypt_aes), encoding=<span class="string">&#x27;utf-8&#x27;</span>)  <span class="comment"># 执行加密并转码返回 bytes</span></span><br><span class="line">    <span class="keyword">return</span> encrypted_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密方法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_decrypt</span>(<span class="params">key, t, iv</span>):</span><br><span class="line">    aes = AES.new(add_to_16(key), AES.MODE_CBC, add_to_16(iv))         <span class="comment"># 初始化加密器</span></span><br><span class="line">    base64_decrypted = base64.decodebytes(t.encode(encoding=<span class="string">&#x27;utf-8&#x27;</span>))  <span class="comment"># 优先逆向解密 base64 成 bytes</span></span><br><span class="line">    decrypted_text = <span class="built_in">str</span>(aes.decrypt(base64_decrypted), encoding=<span class="string">&#x27;utf-8&#x27;</span>).replace(<span class="string">&#x27;\0&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  <span class="comment"># 执行解密密并转码返回str</span></span><br><span class="line">    <span class="keyword">return</span> decrypted_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    secret_key = <span class="string">&#x27;12345678&#x27;</span>   <span class="comment"># 密钥</span></span><br><span class="line">    text = <span class="string">&#x27;I love Python!&#x27;</span>   <span class="comment"># 加密对象</span></span><br><span class="line">    iv = secret_key           <span class="comment"># 初始向量</span></span><br><span class="line">    encrypted_str = aes_encrypt(secret_key, text, iv)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;加密字符串：&#x27;</span>, encrypted_str)</span><br><span class="line">    decrypted_str = aes_decrypt(secret_key, encrypted_str, iv)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;解密字符串：&#x27;</span>, decrypted_str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密字符串：lAVKvkQh+GtdNpoKf4/mHA==</span></span><br><span class="line"><span class="comment"># 解密字符串：I love Python!</span></span><br></pre></td></tr></table></figure>
<p>**注意：**明文加密要求是16的整数倍</p>
<h4 id="2-4-实际案例">2.4 实际案例</h4>
<h5 id="2-4-1-逆向目标">2.4.1 逆向目标</h5>
<ul>
<li>
<p>目标：升学E网通登录接口</p>
</li>
<li>
<p>主页：<a target="_blank" rel="noopener" href="https://web.ewt360.com/register/#/login">https://web.ewt360.com/register/#/login</a></p>
</li>
<li>
<p>接口：aHR0cHM6Ly9nYXRld2F5LmV3dDM2MC5jb20vYXBpL2F1dGhjZW50ZXIvdjIvb2F1dGgvbG9naW4vYWNjb3VudA==</p>
</li>
<li>
<p>逆向参数：</p>
</li>
<li>
<ul>
<li>Request Headers：<code>sign: 3976F10977FC65F9CB967AEF79E508BD</code></li>
<li>Request Payload：<code>password: &quot;A7428361DEF118911783F446A129FFCE&quot;</code></li>
</ul>
</li>
</ul>
<h5 id="2-4-2-抓包分析">2.4.2 <strong>抓包分析</strong></h5>
<p>来到某 e 网通的登录页面，随便输入一个账号密码登陆，抓包定位到登录接口为 aHR0cHM6Ly9nYXRld2F5LmV3dDM2MC5jb20vYXBpL2F1dGhjZW50ZXIvdjIvb2F1dGgvbG9naW4vYWNjb3VudA==，请求头里，有一个 sign，Payload 里，密码 password 被加密处理了。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c2de3e8fc.png" alt="image-20241128090947731" style="zoom:80%;" />
<h5 id="2-4-3-参数逆向">2.4.3 <strong>参数逆向</strong></h5>
<h6 id="2-4-3-sign签名处理">2.4.3 sign签名处理</h6>
<p>首先来看一下请求头的 sign，尝试直接搜索一下，发现并不是经过某些请求返回的数据，观察一下其他请求，可以发现同样有 sign，而且每次请求的值都不一样：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/iabtD4jabia4LJmLPiaJcQvictOzV5grPjHoMDx6z4kPU6VhTuibYUBdXeVQFhFldMuklxpSL2DJygc8lMibR9O5sMdQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>由此可以初步判断这个值应该是通过 JS 生成的，全局搜索关键字 <code>sign:</code>，可以分别在 request.js、request.ts 两个文件里面看到疑似 sign 赋值的地方，埋下断点调试，成功断下，原理也很简单，时间戳加上一串固定的字符，经过 MD5 加密后再转大写即可。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c326140f4.png" alt="image-20241128091059633" style="zoom:80%;" />
<p><strong>使用 Python 实现：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">timestamp = <span class="built_in">str</span>(<span class="built_in">int</span>(time.time() * <span class="number">1000</span>))</span><br><span class="line">sign = hashlib.md5((timestamp + <span class="string">&#x27;bdc739ff2dcf&#x27;</span>).encode(encoding=<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest().upper()</span><br><span class="line"><span class="built_in">print</span>(sign)</span><br></pre></td></tr></table></figure>
<h6 id="2-4-4-password处理">2.4.4 password处理</h6>
<p>​		<code>password</code> 是明文密码经过加密后得到的值，如果尝试直接去搜索的话，会发现出来的值非常非常多，要想找到准确的值难度巨大：</p>
<p>可以看到这条请求是 XHR 请求，本次我们使用 <code>XHR</code> 断点的方法来定位具体的加密位置，通过本次案例，我们来学习一下具体是如何跟进调用栈、如何通过上下文来定位具体的加密位置。</p>
<p>切换到 <code>Network</code> 选项卡，找到登陆请求，鼠标移动到 <code>Initiator</code> 选项卡下的 JS 上，可以看到其调用栈，如果站点的加密方式比较简单，没有太多混淆的话，调用栈里面就可以看到<code> login、send、post、encrypt</code> 等等之类的关键词，这种情况下就可以直接点进去，比较容易找到加密的地方，但是大多数站点对于函数名、变量名都做了混淆，和本案例一样，调用栈里面显示的都是一些单个或者多个无规则的字母的函数，无法直接定位，此时就需要我们从最后一个函数往前慢慢找。</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c34f75a66.png" alt="image-20241128091137690" style="zoom:80%;" />
<p>点击进入最后一个函数，即 Y 函数，它位于调用栈的最顶层，表示经过此函数后，浏览器就会发送登录的请求，密码的加密过程已经处理完毕。在此函数埋下断点，可以在右侧的<code> Call Stack</code> 看到调用栈，从下到上，表示的是点击登陆后，先后调用的函数的执行过程：</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c36f0a13a.png" alt="image-20241128091212530" style="zoom:67%;" />
<p>根据这种思路，一步一步往下跟进调用栈，可以看到在 utils.ts 里面执行了一个匿名函数，其中调用了一个 passwordEncrypt 函数，通过函数名就可以看出基本上就是密码加密的函数了：</p>
<p><strong>总结：</strong></p>
<p>在此处埋下断点进行调试，传进来的是明文密码，passwordEncrypt 实际上是调用的 encode.ts 中的 O 函数：</p>
<p>跟进 O 函数，引用了 crypto-js 加密模块，很明显的 AES 加密，本地改写一下就行了。</p>
<p><strong>JavaScript 加密代码</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">CryptoJS</span> = <span class="built_in">require</span>(<span class="string">&quot;crypto-js&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> key = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="string">&quot;20171109124536982017110912453698&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> iv = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="string">&#x27;2017110912453698&#x27;</span>); <span class="comment">//十六位十六进制数作为密钥偏移量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getEncryptedPassword</span>(<span class="params">word</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> srcs = <span class="title class_">CryptoJS</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(word);</span><br><span class="line">    <span class="keyword">let</span> encrypted = <span class="title class_">CryptoJS</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(srcs, key, &#123;</span><br><span class="line">            <span class="attr">iv</span>: iv,</span><br><span class="line">            <span class="attr">mode</span>: <span class="title class_">CryptoJS</span>.<span class="property">mode</span>.<span class="property">CBC</span>,</span><br><span class="line">            <span class="attr">padding</span>: <span class="title class_">CryptoJS</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="keyword">return</span> encrypted.<span class="property">ciphertext</span>.<span class="title function_">toString</span>().<span class="title function_">toUpperCase</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试样例</span></span><br><span class="line"><span class="comment">// console.log(getEncryptedPassword(&quot;123457&quot;))</span></span><br></pre></td></tr></table></figure>
<p>python模拟登录</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">login_url = <span class="string">&#x27;https://gateway.ewt360.com/api/authcenter/v2/oauth/login/account&#x27;</span></span><br><span class="line">session = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sign</span>():</span><br><span class="line">    timestamp = <span class="built_in">str</span>(<span class="built_in">int</span>(time.time()*<span class="number">1000</span>))</span><br><span class="line">    sign = hashlib.md5((timestamp + <span class="string">&#x27;bdc739ff2dcf&#x27;</span>).encode(encoding=<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest().upper()</span><br><span class="line">    <span class="keyword">return</span> sign</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_encrypted_parameter</span>(<span class="params">password</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;encrypt.js&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        ewt360_js = f.read()</span><br><span class="line">    encrypted_password = execjs.<span class="built_in">compile</span>(ewt360_js).call(<span class="string">&#x27;getEncryptedPassword&#x27;</span>, password)</span><br><span class="line">    <span class="keyword">return</span> encrypted_password</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">sign, username, encrypted_password</span>):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;sign&#x27;</span>: sign,</span><br><span class="line">        <span class="string">&#x27;timestamp&#x27;</span>: <span class="built_in">str</span>(<span class="built_in">int</span>(time.time()*<span class="number">1000</span>)),</span><br><span class="line">        <span class="string">&#x27;sec-ch-ua&#x27;</span>: <span class="string">&#x27;&quot; Not;A Brand&quot;;v=&quot;99&quot;, &quot;Google Chrome&quot;;v=&quot;91&quot;, &quot;Chromium&quot;;v=&quot;91&quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;autoLogin&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: encrypted_password,</span><br><span class="line">        <span class="string">&#x27;platform&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;userName&#x27;</span>: username</span><br><span class="line">    &#125;</span><br><span class="line">    response = session.post(url=login_url, headers=headers, json=data)</span><br><span class="line">    <span class="built_in">print</span>(response.json())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    username = <span class="built_in">input</span>(<span class="string">&#x27;请输入登录账号: &#x27;</span>)</span><br><span class="line">    password = <span class="built_in">input</span>(<span class="string">&#x27;请输入登录密码: &#x27;</span>)</span><br><span class="line">    sign = get_sign()</span><br><span class="line">    encrypted_password = get_encrypted_parameter(password)</span><br><span class="line">    login(sign, username, encrypted_password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h2 id="非对称加密">非对称加密</h2>
<h3 id="1-非对称简介">1 非对称简介</h3>
<p>​		与对称加密算法不同，非对称加密算法需要两个密钥：公开密钥<code>（publickey）</code>和私有密钥<code>（privatekey）</code>。公开密钥与私有密钥是一对，如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密。因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。</p>
<ul>
<li>常见非对称加密算法 <code>RSA</code>、<code>DSA</code>。</li>
<li>非对称加密算法私钥由数据接收方持有，不会在网络上传递，保证了密钥的安全。</li>
<li>非对称加密算法通常比对称加密算法计算复杂，性能消耗高。</li>
<li>非对称加密算法可用于数字签名。</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c39800079.png" alt="image-20241128091254142" style="zoom:33%;" />
<p><strong>注意：</strong></p>
<ul>
<li>使用时都是使用公钥加密使用私钥解密，公钥可以公开，私钥自己保留。</li>
<li>算法强度复杂、安全性依赖于算法与密钥但是由于其算法复杂，而使加密解密速度慢于对称加密</li>
</ul>
<h3 id="2-非对称特征">2 非对称特征</h3>
<p>常见JavaScript调试算法</p>
<ul>
<li>搜索关键词 <code>new JSEncrypt()</code>，<code>JSEncrypt</code> 等，一般会使用 <code>JSEncrypt </code>库，会有 new 一个实例对象的操作；</li>
<li>搜索关键词 <code>setPublicKey</code>、<code>setKey</code>、<code>setPrivateKey</code>、<code>getPublicKey</code> 等，一般实现的代码里都含有设置密钥的过程。</li>
</ul>
<p>RSA 的私钥、公钥、明文、密文长度也有一定对应关系，也可以从这方面初步判断：</p>
<table>
<thead>
<tr>
<th>私钥长度</th>
<th>公钥长度</th>
<th>明文长度</th>
<th>密文长度</th>
</tr>
</thead>
<tbody>
<tr>
<td>428</td>
<td>128</td>
<td>1~53</td>
<td>88</td>
</tr>
<tr>
<td>812</td>
<td>216</td>
<td>1~117</td>
<td>172</td>
</tr>
<tr>
<td>1588</td>
<td>392</td>
<td>1~245</td>
<td>344</td>
</tr>
</tbody>
</table>
<h4 id="2-1-JavaScript-实现-2">2.1  JavaScript 实现</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// npm install node-rsa --save</span></span><br><span class="line"><span class="comment">// 引用 node-rsa 加密模块</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">NodeRSA</span> = <span class="built_in">require</span>(<span class="string">&#x27;node-rsa&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">rsaEncrypt</span>(<span class="params"></span>) &#123;</span><br><span class="line">    pubKey = <span class="keyword">new</span> <span class="title class_">NodeRSA</span>(publicKey,<span class="string">&#x27;pkcs8-public&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> encryptedData = pubKey.<span class="title function_">encrypt</span>(text, <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> encryptedData</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">rsaDecrypt</span>(<span class="params"></span>) &#123;</span><br><span class="line">    priKey = <span class="keyword">new</span> <span class="title class_">NodeRSA</span>(privatekey,<span class="string">&#x27;pkcs8-private&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> decryptedData = priKey.<span class="title function_">decrypt</span>(encryptedData, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> decryptedData</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> key = <span class="keyword">new</span> <span class="title class_">NodeRSA</span>(&#123;<span class="attr">b</span>: <span class="number">512</span>&#125;);                    <span class="comment">//生成512位秘钥</span></span><br><span class="line"><span class="keyword">var</span> publicKey = key.<span class="title function_">exportKey</span>(<span class="string">&#x27;pkcs8-public&#x27;</span>);    <span class="comment">//导出公钥</span></span><br><span class="line"><span class="keyword">var</span> privatekey = key.<span class="title function_">exportKey</span>(<span class="string">&#x27;pkcs8-private&#x27;</span>);  <span class="comment">//导出私钥</span></span><br><span class="line"><span class="keyword">var</span> text = <span class="string">&quot;I love Python!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> encryptedData = <span class="title function_">rsaEncrypt</span>()</span><br><span class="line"><span class="keyword">var</span> decryptedData = <span class="title function_">rsaDecrypt</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;公钥:\n&quot;</span>, publicKey)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;私钥:\n&quot;</span>, privatekey)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;加密字符串: &quot;</span>, encryptedData)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;解密字符串: &quot;</span>, decryptedData)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-Python-实现-2">2.2 Python 实现</h4>
<p>模块：<code>rsa</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author  : 夏洛</span></span><br><span class="line"><span class="comment"># @File    : 02-demo.py</span></span><br><span class="line"><span class="comment"># @VX : tl210329</span></span><br><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rsa_encrypt</span>(<span class="params">pu_key, t</span>):</span><br><span class="line">    <span class="comment"># 公钥加密</span></span><br><span class="line">    rsas = rsa.encrypt(t.encode(<span class="string">&quot;utf-8&quot;</span>), pu_key)</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(rsas)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rsa_decrypt</span>(<span class="params">pr_key, t</span>):</span><br><span class="line">    <span class="comment"># 私钥解密</span></span><br><span class="line">    rsas = rsa.decrypt(base64.b64decode(t), pr_key).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> rsas</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    public_key, private_key = rsa.newkeys(<span class="number">512</span>)   <span class="comment"># 生成公钥、私钥</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;公钥：&#x27;</span>, public_key)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;私钥：&#x27;</span>, private_key)</span><br><span class="line">    text = <span class="string">&#x27;I love Python!&#x27;</span>  <span class="comment"># 加密对象</span></span><br><span class="line">    encrypted_str = rsa_encrypt(public_key, text)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;加密字符串：&#x27;</span>, encrypted_str)</span><br><span class="line">    decrypted_str = rsa_decrypt(private_key, encrypted_str)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;解密字符串：&#x27;</span>, decrypted_str)</span><br></pre></td></tr></table></figure>
<h3 id="3-案例实战">3 案例实战</h3>
<ul>
<li>
<p>目标：房天下账号密码登录</p>
</li>
<li>
<p>主页：<a target="_blank" rel="noopener" href="https://passport.fang.com/">https://passport.fang.com/</a></p>
</li>
<li>
<p>接口：<a target="_blank" rel="noopener" href="https://passport.fang.com/login.api">https://passport.fang.com/login.api</a></p>
</li>
<li>
<p>逆向参数：</p>
<p><strong>Form Data：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwd: 044b527dba64d1e82657668beae1d61e4d86643d231792c78d5c538461a146b01c8e28d98b14915a11758deb60</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="3-1-抓包分析">3.1 抓包分析</h4>
<p>随便输入一个账号密码，点击登陆，抓包定位到登录接口为 <a target="_blank" rel="noopener" href="https://passport.fang.com/login.api">https://passport.fang.com/login.api</a> ，POST 请求，<code>Form Data</code> 里，密码 <code>pwd</code> 被加密处理了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/iabtD4jabia4JSlhKbZ7886IyfdWMia07OD7Tiad5l19Et3lneVcJf9Mq5hjibB7aibSAKQLXNTiaWicbUicaD6QNUrG4pA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h4 id="3-2-参数逆向">3.2 参数逆向</h4>
<p>加密参数只有一个 pwd，直接全局搜索，出现一个 <code>loginbypassword.js</code>，很明显就是加密的<code> JS</code>，这个<code>JS</code>贴心的写上了中文注释，直接来到登录模块，埋下断点：</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2024/11/28/6747c3ca19992.png" alt="image-20241128091343611" style="zoom:67%;" />
<p><strong>关键代码：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uid: that.username.val(),</span><br><span class="line">pwd: encryptedString(key_to_encode, that.password.val()),</span><br><span class="line">Service: that.service.val(),</span><br><span class="line">AutoLogin: that.autoLogin.val()</span><br></pre></td></tr></table></figure>
<p>这里主要用到了 <code>encryptedString</code> 这个函数和 <code>key_to_encode</code> 参数，鼠标放到<code> encryptedString</code> 函数上面，可以看到这个函数实际上是在一个叫做 <code>RSA.min.js</code> 的加密 JS 文件里，很明显的<code>RSA</code>加密，我们跟进这个函数，直接将所有加密函数剥离下来进行本地调试即可：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://mmbiz.qpic.cn/mmbiz_png/iabtD4jabia4IyXASUYVZqIEibOcJqWTkv3hcibJ0AqYiczRQ4ZKlpcIYKFAibH0uscqZgHI4xlaV2oPJlK4Oy5ST4Ww/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>而 <code>key_to_encode</code> 这个参数是可以直接在首页搜到，可以看到是向 <code>RSAKeyPair</code> 函数传入参数得到的：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282023649.png" alt="图片"></p>
<p>根据以上分析，我们可以把加密的主要步骤重写并封装成一个函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function getEncryptedPassword(pwd, n, i, t) &#123;</span><br><span class="line">    var key_to_encode = new RSAKeyPair(n, i, t);</span><br><span class="line">    <span class="keyword">return</span> encryptedString(key_to_encode, pwd)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code> pwd</code> 就是明文密码，<code>n，i，t</code> 是用来获取 <code>key_to_encode</code> 的参数，它们三个的值都可以在主页中找到。</p>
<h4 id="3-3-JS代码">3.3 JS代码</h4>
<ul>
<li><code>setMaxDigits()</code>貌似是生成密文的最大位数， 计算公式<code> n ** 2 / 16</code>。其中n为密钥长度</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setMaxDigits</span>(<span class="params">n</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">BigInt</span>(<span class="params">n</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">biFromDecimal</span>(<span class="params">n</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处省略 N 个函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">twoDigit</span>(<span class="params">n</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encryptedString</span>(<span class="params">n, t</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">decryptedString</span>(<span class="params">n, t</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> biRadixBase = <span class="number">2</span>, biRadixBits = <span class="number">16</span>, bitsPerDigit = biRadixBits, biRadix = <span class="number">65536</span>, biHalfRadix = biRadix &gt;&gt;&gt; <span class="number">1</span>,</span><br><span class="line">    biRadixSquared = biRadix * biRadix, maxDigitVal = biRadix - <span class="number">1</span>, maxInteger = <span class="number">9999999999999998</span>, maxDigits, <span class="variable constant_">ZERO_ARRAY</span>,</span><br><span class="line">    bigZero, bigOne, dpl10, lr10, hexatrigesimalToChar, hexToChar, highBitMasks, lowBitMasks;</span><br><span class="line"><span class="title function_">setMaxDigits</span>(<span class="number">20</span>);</span><br><span class="line">dpl10 = <span class="number">15</span>;</span><br><span class="line">lr10 = <span class="title function_">biFromNumber</span>(<span class="number">1e15</span>);</span><br><span class="line">hexatrigesimalToChar = [<span class="string">&quot;0&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;8&quot;</span>, <span class="string">&quot;9&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>, <span class="string">&quot;g&quot;</span>, <span class="string">&quot;h&quot;</span>, <span class="string">&quot;i&quot;</span>, <span class="string">&quot;j&quot;</span>, <span class="string">&quot;k&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;m&quot;</span>, <span class="string">&quot;n&quot;</span>, <span class="string">&quot;o&quot;</span>, <span class="string">&quot;p&quot;</span>, <span class="string">&quot;q&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="string">&quot;s&quot;</span>, <span class="string">&quot;t&quot;</span>, <span class="string">&quot;u&quot;</span>, <span class="string">&quot;v&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;z&quot;</span>];</span><br><span class="line">hexToChar = [<span class="string">&quot;0&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;8&quot;</span>, <span class="string">&quot;9&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>];</span><br><span class="line">highBitMasks = [<span class="number">0</span>, <span class="number">32768</span>, <span class="number">49152</span>, <span class="number">57344</span>, <span class="number">61440</span>, <span class="number">63488</span>, <span class="number">64512</span>, <span class="number">65024</span>, <span class="number">65280</span>, <span class="number">65408</span>, <span class="number">65472</span>, <span class="number">65504</span>, <span class="number">65520</span>, <span class="number">65528</span>, <span class="number">65532</span>, <span class="number">65534</span>, <span class="number">65535</span>];</span><br><span class="line">lowBitMasks = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">31</span>, <span class="number">63</span>, <span class="number">127</span>, <span class="number">255</span>, <span class="number">511</span>, <span class="number">1023</span>, <span class="number">2047</span>, <span class="number">4095</span>, <span class="number">8191</span>, <span class="number">16383</span>, <span class="number">32767</span>, <span class="number">65535</span>];</span><br><span class="line"><span class="title function_">setMaxDigits</span>(<span class="number">129</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getEncryptedPassword</span>(<span class="params">pwd, n, i, t</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> key_to_encode = <span class="keyword">new</span> <span class="title class_">RSAKeyPair</span>(n, i, t);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">encryptedString</span>(key_to_encode, pwd)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试样例</span></span><br><span class="line"><span class="comment">// console.log(getEncryptedPassword(&quot;16521689404&quot;, &quot;010001&quot;, &quot;&quot;, &quot;978C0A92D2173439707498F0944AA476B1B62595877DD6FA87F6E2AC6DCB3D0BF0B82857439C99B5091192BC134889DFF60C562EC54EFBA4FF2F9D55ADBCCEA4A2FBA80CB398ED501280A007C83AF30C3D1A142D6133C63012B90AB26AC60C898FB66EDC3192C3EC4FF66925A64003B72496099F4F09A9FB72A2CF9E4D770C41&quot;))</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-python代码">3.4 python代码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index_url = <span class="string">&#x27;https://passport.fang.com/&#x27;</span></span><br><span class="line">login_url = <span class="string">&#x27;https://passport.fang.com/login.api&#x27;</span></span><br><span class="line">user_agent = <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&#x27;</span></span><br><span class="line">session = requests.session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_key_to_encode</span>():</span><br><span class="line">    headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: user_agent&#125;</span><br><span class="line">    response = session.get(url=index_url, headers=headers)</span><br><span class="line">    key_to_encode = re.findall(<span class="string">r&#x27;RSAKeyPair\((.*)\);&#x27;</span>, response.text)[<span class="number">0</span>].replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;, &#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> key_to_encode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_encrypted_password</span>(<span class="params">key_to_encode, pwd</span>):</span><br><span class="line">    n, i, t = key_to_encode[<span class="number">0</span>], key_to_encode[<span class="number">1</span>], key_to_encode[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;fang_encrypt.js&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        fang_js = f.read()</span><br><span class="line">    encrypted_pwd = execjs.<span class="built_in">compile</span>(fang_js).call(<span class="string">&#x27;getEncryptedPassword&#x27;</span>, pwd, n, i, t)</span><br><span class="line">    <span class="keyword">return</span> encrypted_pwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">encrypted_password, uid</span>):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: user_agent,</span><br><span class="line">        <span class="string">&#x27;X-Requested-With&#x27;</span>: <span class="string">&#x27;XMLHttpRequest&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;passport.fang.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Origin&#x27;</span>: <span class="string">&#x27;https://passport.fang.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;https://passport.fang.com/?backurl=http%3a%2f%2fmy.fang.com%2f&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sec-ch-ua&#x27;</span>: <span class="string">&#x27;&quot; Not;A Brand&quot;;v=&quot;99&quot;, &quot;Google Chrome&quot;;v=&quot;91&quot;, &quot;Chromium&quot;;v=&quot;91&quot;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded; charset=UTF-8&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;uid&#x27;</span>: uid,</span><br><span class="line">        <span class="string">&#x27;pwd&#x27;</span>: encrypted_password,</span><br><span class="line">        <span class="string">&#x27;Service&#x27;</span>: <span class="string">&#x27;soufun-passport-web&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;AutoLogin&#x27;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = session.post(url=login_url, data=data, headers=headers)</span><br><span class="line">    <span class="built_in">print</span>(response.json())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 16521689404</span></span><br><span class="line">    uid = <span class="built_in">input</span>(<span class="string">&#x27;请输入登录账号：&#x27;</span>)</span><br><span class="line">    pwd = <span class="built_in">input</span>(<span class="string">&#x27;请输入登录密码：&#x27;</span>)</span><br><span class="line">    rsa_key = get_key_to_encode()</span><br><span class="line">    encrypted_pwd = get_encrypted_password(rsa_key, pwd)</span><br><span class="line">    login(encrypted_pwd, uid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="4-案例实战">4. 案例实战</h3>
<p><strong>说明</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本教程为教学使用，不承担任何风险，请各学员自觉遵守法律法规 -- 微流云平台</span><br></pre></td></tr></table></figure>
<h4 id="4-1-逆向参数">4.1 逆向参数</h4>
<ul>
<li>该案例是多层嵌套加密</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">地址：https://www.wei-liu.com/user/login.html</span><br><span class="line"></span><br><span class="line">password: <span class="string">&quot;ZfYhxYg6V6STQDo8FwTCeqpmtsWjh73R/nIotCh0RnkuJMgd7e72U+JVo/XQ6sY3qEVd+J+d6D</span></span><br></pre></td></tr></table></figure>
<h4 id="4-2-逆向分析">4.2 逆向分析</h4>
<p>点击登录会加载2个地址</p>
<p>地址1：<a target="_blank" rel="noopener" href="https://api.wei-liu.com/api/v1/Token/code">https://api.wei-liu.com/api/v1/Token/code</a></p>
<p>地址2：<a target="_blank" rel="noopener" href="https://api.wei-liu.com/api/v1/Token">https://api.wei-liu.com/api/v1/Token</a></p>
<p>**总结：**地址2里面有携带参数  地址1返回<code>公钥</code>和<code>item2</code>参数</p>
<h4 id="4-3-JavaScript分析">4.3 JavaScript分析</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282023333.png" alt="image-20220817153828723"></p>
<p>**总结：**从这里可以看出密码是属于加密的</p>
<p>下<code>XHR</code>断点分析<code>https://api.wei-liu.com/api/v1/Token</code>,可以在以下位置发现参数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282023820.png" alt="image-20220817154256383"></p>
<h4 id="4-4-密钥分析">4.4 密钥分析</h4>
<ul>
<li>拉动滑块，获取后台公钥 <code>item1</code> 和带有时间的<code>item2</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282023847.png" alt="image-20220817153949071"></p>
<h4 id="4-5-算法还原">4.5 算法还原</h4>
<h5 id="4-5-1-用python模拟请求测试">4.5.1 用python模拟请求测试</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_miyue</span>():</span><br><span class="line">    session = requests.session()</span><br><span class="line">    header = &#123;</span><br><span class="line">        <span class="string">&#x27;具体参数找夏洛老师拿&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    session.headers = header</span><br><span class="line">    url = <span class="string">&#x27;https://api.wei-liu.com/api/v1/Token/code&#x27;</span></span><br><span class="line">    res = session.get(url)</span><br><span class="line">    <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">        res1 = res.json().get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">        item1 = res1.get(<span class="string">&#x27;item1&#x27;</span>)</span><br><span class="line">        item2 = res1.get(<span class="string">&#x27;item2&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> item1,item2</span><br></pre></td></tr></table></figure>
<h5 id="4-5-2-JavaScript测试代码">4.5.2  JavaScript测试代码</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JSEncrypt</span> = <span class="built_in">require</span>(<span class="string">&#x27;jsencrypt&#x27;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">encrypt</span>(<span class="params"><span class="variable language_">module</span>,pubCode,pwd</span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> encrypt = <span class="keyword">new</span> <span class="title class_">JSEncrypt</span>();</span><br><span class="line">    encrypt.<span class="title function_">setPublicKey</span>(<span class="variable language_">module</span>);</span><br><span class="line">    <span class="keyword">var</span> result = encrypt.<span class="title function_">encrypt</span>(pubCode + pwd);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-5-3-密码获取">4.5.3 密码获取</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">js_code = <span class="title function_">open</span>(<span class="string">&#x27;psd.js&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).<span class="title function_">read</span>()</span><br><span class="line">result = execjs.<span class="title function_">compile</span>(js_code).<span class="title function_">call</span>(<span class="string">&#x27;encrypt&#x27;</span>,item1,item2,<span class="title function_">jm_sha256</span>(<span class="string">&#x27;&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h2 id="WebPack打包"><code>WebPack</code>打包</h2>
<p><code>webpack</code>是一个基于模块化的打包（构建）工具, 它把一切都视作模块</p>
<p><strong>概念：</strong></p>
<p>​       <code>webpack</code>是 <code>JavaScript</code> 应用程序的模块打包器,可以把开发中的所有资源（图片、js文件、css文件等）都看成模块，通过loader（加载器）和<code>plugins</code>（插件）对资源进行处理，打包成符合生产环境部署的前端资源。所有的资源都是通过<code>JavaScript</code>渲染出来的。</p>
<p>如果一个页面大部分是script标签构成，80%以上是<code>webpack</code>打包。</p>
<p><strong>地址</strong>：<a target="_blank" rel="noopener" href="http://cls.cn/telegraph">http://cls.cn/telegraph</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://app.yinxiang.com/FileSharing.action?hash=1/7d9dde72b8262d871a27f10af50a9b44-286201" alt="img"></p>
<h3 id="1-webpack打包简介">1. <code>webpack</code>打包简介</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://app.yinxiang.com/FileSharing.action?hash=1/62be23ee03da0e043ff4b088eb0872cd-72813" alt="img"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282024241.png" alt="image-20220329153518062"></p>
<h4 id="1-0-多个JS文件打包：">1.0 多个<code>JS</code>文件打包：</h4>
<p>​		如果模块比较多，就会将模块打包成JS文件, 然后定义一个全局变量 window[“webpackJsonp”] = [ ]，它的作用是存储需要动态导入的模块，然后重写 window[“webpackJsonp”] 数组的 push( ) 方法为 webpackJsonpCallback( ),也就是说 window[“webpackJsonp”].push( ) 其实执行的是 webpackJsonpCallback( ),window[“webpackJsonp”].push( )接收三个参数,第一个参数是模块的ID,第二个参数是 一个数组或者对象,里面定义大量的函数,第三个参数是要调用的函数(可选)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://app.yinxiang.com/FileSharing.action?hash=1/46d51af6b6946548adccc97f31a249ef-20029" alt="img"></p>
<h4 id="1-1-webpack数组形式">1.1 <code>webpack</code>数组形式</h4>
<ul>
<li>给需要处理业务的模块进行打包，通过下标取值。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">!<span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> t = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载器  所有的模块都是从这个函数加载 执行</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">n</span>(<span class="params">r</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (t[r])</span><br><span class="line">            <span class="keyword">return</span> t[r].<span class="property">exports</span>;</span><br><span class="line">        <span class="keyword">var</span> o = t[r] = &#123;</span><br><span class="line">            <span class="attr">i</span>: r,</span><br><span class="line">            <span class="attr">l</span>: !<span class="number">1</span>,</span><br><span class="line">            <span class="attr">exports</span>: &#123;&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> e[r].<span class="title function_">call</span>(o.<span class="property">exports</span>, o, o.<span class="property">exports</span>, n),</span><br><span class="line">            o.<span class="property">l</span> = !<span class="number">0</span>,</span><br><span class="line">            o.<span class="property">exports</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">n</span>(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line">    ([</span><br><span class="line">        <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;123456&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">              <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;模块2&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">    ])</span><br></pre></td></tr></table></figure>
<h4 id="1-2-webpack对象形式">1.2 <code>webpack</code>对象形式</h4>
<ul>
<li>给需要处理业务的模块进行打包，通过<code>key</code>取值。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">!<span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> t = &#123;&#125;;</span><br><span class="line">    <span class="comment">//  所有的模块 都是从这个加载器 执行的  分发器</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">n</span>(<span class="params">r</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (t[r])</span><br><span class="line">            <span class="keyword">return</span> t[r].<span class="property">exports</span>;</span><br><span class="line">        <span class="keyword">var</span> o = t[r] = &#123;</span><br><span class="line">            <span class="attr">i</span>: r,</span><br><span class="line">            <span class="attr">l</span>: !<span class="number">1</span>,</span><br><span class="line">            <span class="attr">exports</span>: &#123;&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> e[r].<span class="title function_">call</span>(o.<span class="property">exports</span>, o, o.<span class="property">exports</span>, n),</span><br><span class="line">        o.<span class="property">l</span> = !<span class="number">0</span>,</span><br><span class="line">        o.<span class="property">exports</span></span><br><span class="line">    &#125;</span><br><span class="line">   <span class="title function_">n</span>(<span class="string">&#x27;xialuo&#x27;</span>)  <span class="comment">// 对象 根据KEY 找模块</span></span><br><span class="line">&#125;(&#123;</span><br><span class="line"></span><br><span class="line">        <span class="number">0</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;我是模块1  负责加密&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;xialuo&#x27;</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;我是模块2  负责解密&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="number">2</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;我是模块3  负责爬数据&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="2-webpack教学">2. <code>webpack</code>教学</h3>
<h4 id="2-1-逆向目标">2.1 逆向目标</h4>
<ul>
<li>
<p>首页：<a target="_blank" rel="noopener" href="https://agent.leju.com/ucenter/passportlogin/">https://agent.leju.com/ucenter/passportlogin/</a></p>
</li>
<li>
<p>接口：<a target="_blank" rel="noopener" href="https://agent.leju.com/ucenter/login/">https://agent.leju.com/ucenter/login/</a></p>
</li>
<li>
<p>逆向参数：<code>password: 8cbf7f88e70300def68533a74c77b785e11d743c77627b624</code></p>
</li>
</ul>
<h4 id="2-2-逆向分析">2.2 逆向分析</h4>
<ul>
<li>全局搜索<code>password</code>参数，然后下断点调试，可以发现加密逻辑在<code>loginNew_9697dc1c616207641ca0.js</code>里面。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282024248.png" alt="image-20220821172434242"></p>
<ul>
<li>
<p>点击进去，发现是模块</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282024245.png" alt="image-20220821173358041"></p>
</li>
<li>
<p>导出加载器，查看所有模块</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282024706.png" alt="image-20220821180249172"></p>
<h4 id="2-3-代码处理">2.3 代码处理</h4>
<ul>
<li>找出对应负责模块</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282024558.png" alt="image-20220821181840088"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> _xx;</span><br><span class="line">!<span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> e = &#123;&#125;;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">i</span>(<span class="params">n</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e[n])</span><br><span class="line">            <span class="keyword">return</span> e[n].<span class="property">exports</span>;</span><br><span class="line">        <span class="keyword">var</span> s = e[n] = &#123;</span><br><span class="line">            <span class="attr">i</span>: n,</span><br><span class="line">            <span class="attr">l</span>: !<span class="number">1</span>,</span><br><span class="line">            <span class="attr">exports</span>: &#123;&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(n)</span><br><span class="line">        <span class="keyword">return</span> t[n].<span class="title function_">call</span>(s.<span class="property">exports</span>, s, s.<span class="property">exports</span>, i),</span><br><span class="line">        s.<span class="property">l</span> = !<span class="number">0</span>,</span><br><span class="line">        s.<span class="property">exports</span></span><br><span class="line">    &#125;</span><br><span class="line">    i.<span class="property">m</span> = t,</span><br><span class="line">    i.<span class="property">c</span> = e,</span><br><span class="line">    i.<span class="property">d</span> = <span class="keyword">function</span>(<span class="params">t, e, n</span>) &#123;</span><br><span class="line">        i.<span class="title function_">o</span>(t, e) || <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(t, e, &#123;</span><br><span class="line">            <span class="attr">enumerable</span>: !<span class="number">0</span>,</span><br><span class="line">            <span class="attr">get</span>: n</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    i.<span class="property">r</span> = <span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">        <span class="string">&quot;undefined&quot;</span> != <span class="keyword">typeof</span> <span class="title class_">Symbol</span> &amp;&amp; <span class="title class_">Symbol</span>.<span class="property">toStringTag</span> &amp;&amp; <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(t, <span class="title class_">Symbol</span>.<span class="property">toStringTag</span>, &#123;</span><br><span class="line">            <span class="attr">value</span>: <span class="string">&quot;Module&quot;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(t, <span class="string">&quot;__esModule&quot;</span>, &#123;</span><br><span class="line">            <span class="attr">value</span>: !<span class="number">0</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    i.<span class="property">t</span> = <span class="keyword">function</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> &amp; e &amp;&amp; (t = <span class="title function_">i</span>(t)),</span><br><span class="line">        <span class="number">8</span> &amp; e)</span><br><span class="line">            <span class="keyword">return</span> t;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">4</span> &amp; e &amp;&amp; <span class="string">&quot;object&quot;</span> == <span class="keyword">typeof</span> t &amp;&amp; t &amp;&amp; t.<span class="property">__esModule</span>)</span><br><span class="line">            <span class="keyword">return</span> t;</span><br><span class="line">        <span class="keyword">var</span> n = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (i.<span class="title function_">r</span>(n),</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(n, <span class="string">&quot;default&quot;</span>, &#123;</span><br><span class="line">            <span class="attr">enumerable</span>: !<span class="number">0</span>,</span><br><span class="line">            <span class="attr">value</span>: t</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="number">2</span> &amp; e &amp;&amp; <span class="string">&quot;string&quot;</span> != <span class="keyword">typeof</span> t)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> s <span class="keyword">in</span> t)</span><br><span class="line">                i.<span class="title function_">d</span>(n, s, <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> t[e]</span><br><span class="line">                &#125;</span><br><span class="line">                .<span class="title function_">bind</span>(<span class="literal">null</span>, s));</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    i.<span class="property">n</span> = <span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> e = t &amp;&amp; t.<span class="property">__esModule</span> ? <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> t.<span class="property">default</span></span><br><span class="line">        &#125;</span><br><span class="line">        : <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> t</span><br><span class="line">        &#125;</span><br><span class="line">        ;</span><br><span class="line">        <span class="keyword">return</span> i.<span class="title function_">d</span>(e, <span class="string">&quot;a&quot;</span>, e),</span><br><span class="line">        e</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    i.<span class="property">o</span> = <span class="keyword">function</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(t, e)</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    i.<span class="property">p</span> = <span class="string">&quot;//esfres.leju.com/agent_www_new/dist/&quot;</span>,</span><br><span class="line">    <span class="comment">// i(i.s = 301)</span></span><br><span class="line">       _xx = i;</span><br><span class="line"></span><br><span class="line">&#125;(&#123;</span><br><span class="line"> <span class="number">305</span>: <span class="keyword">function</span>(<span class="params">t, e, i</span>) &#123;</span><br><span class="line">        <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(e, <span class="string">&quot;__esModule&quot;</span>, &#123;</span><br><span class="line">            <span class="attr">value</span>: !<span class="number">0</span></span><br><span class="line">        &#125;),</span><br><span class="line">        e.<span class="property">encryptedString</span> = e.<span class="property">RSAKeyPair</span> = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">var</span> n = <span class="title function_">i</span>(<span class="number">228</span>)</span><br><span class="line">          , s = <span class="title function_">i</span>(<span class="number">306</span>)</span><br><span class="line">          , o = &#123;&#125;;</span><br><span class="line">        o.<span class="property">NoPadding</span> = <span class="string">&quot;NoPadding&quot;</span>,</span><br><span class="line">        o.<span class="property">PKCS1Padding</span> = <span class="string">&quot;PKCS1Padding&quot;</span>,</span><br><span class="line">        o.<span class="property">RawEncoding</span> = <span class="string">&quot;RawEncoding&quot;</span>,</span><br><span class="line">        o.<span class="property">NumericEncoding</span> = <span class="string">&quot;NumericEncoding&quot;</span>,</span><br><span class="line">        e.<span class="property">RSAKeyPair</span> = <span class="keyword">function</span>(<span class="params">t, e, i, o</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">e</span> = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biFromHex</span>)(t),</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">d</span> = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biFromHex</span>)(e),</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">m</span> = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biFromHex</span>)(i),</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">chunkSize</span> = <span class="string">&quot;number&quot;</span> != <span class="keyword">typeof</span> o ? <span class="number">2</span> * (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biHighIndex</span>)(<span class="variable language_">this</span>.<span class="property">m</span>) : o / <span class="number">8</span>,</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">radix</span> = <span class="number">16</span>,</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">barrett</span> = <span class="keyword">new</span> s.<span class="title class_">BarrettMu</span>(<span class="variable language_">this</span>.<span class="property">m</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        ,</span><br><span class="line">        e.<span class="property">encryptedString</span> = <span class="keyword">function</span>(<span class="params">t, e, i, s</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> a, r, l, c, u, d, p, h, f, g = <span class="keyword">new</span> <span class="title class_">Array</span>, m = e.<span class="property">length</span>, y = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (c = <span class="string">&quot;string&quot;</span> == <span class="keyword">typeof</span> i ? i == o.<span class="property">NoPadding</span> ? <span class="number">1</span> : i == o.<span class="property">PKCS1Padding</span> ? <span class="number">2</span> : <span class="number">0</span> : <span class="number">0</span>,</span><br><span class="line">            u = <span class="string">&quot;string&quot;</span> == <span class="keyword">typeof</span> s &amp;&amp; s == o.<span class="property">RawEncoding</span> ? <span class="number">1</span> : <span class="number">0</span>,</span><br><span class="line">            <span class="number">1</span> == c ? m &gt; t.<span class="property">chunkSize</span> &amp;&amp; (m = t.<span class="property">chunkSize</span>) : <span class="number">2</span> == c &amp;&amp; m &gt; t.<span class="property">chunkSize</span> - <span class="number">11</span> &amp;&amp; (m = t.<span class="property">chunkSize</span> - <span class="number">11</span>),</span><br><span class="line">            a = <span class="number">0</span>,</span><br><span class="line">            r = <span class="number">2</span> == c ? m - <span class="number">1</span> : t.<span class="property">chunkSize</span> - <span class="number">1</span>; a &lt; m; )</span><br><span class="line">                c ? g[r] = e.<span class="title function_">charCodeAt</span>(a) : g[a] = e.<span class="title function_">charCodeAt</span>(a),</span><br><span class="line">                a++,</span><br><span class="line">                r--;</span><br><span class="line">            <span class="keyword">for</span> (<span class="number">1</span> == c &amp;&amp; (a = <span class="number">0</span>),</span><br><span class="line">            r = t.<span class="property">chunkSize</span> - m % t.<span class="property">chunkSize</span>; r &gt; <span class="number">0</span>; ) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">2</span> == c) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (d = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">256</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>()); !d; )</span><br><span class="line">                        d = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">256</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>());</span><br><span class="line">                    g[a] = d</span><br><span class="line">                &#125; <span class="keyword">else</span></span><br><span class="line">                    g[a] = <span class="number">0</span>;</span><br><span class="line">                a++,</span><br><span class="line">                r--</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="number">2</span> == c &amp;&amp; (g[m] = <span class="number">0</span>,</span><br><span class="line">            g[t.<span class="property">chunkSize</span> - <span class="number">2</span>] = <span class="number">2</span>,</span><br><span class="line">            g[t.<span class="property">chunkSize</span> - <span class="number">1</span>] = <span class="number">0</span>),</span><br><span class="line">            p = g.<span class="property">length</span>,</span><br><span class="line">            a = <span class="number">0</span>; a &lt; p; a += t.<span class="property">chunkSize</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (h = <span class="keyword">new</span> n.<span class="property">BigInt</span>,</span><br><span class="line">                r = <span class="number">0</span>,</span><br><span class="line">                l = a; l &lt; a + t.<span class="property">chunkSize</span>; ++r)</span><br><span class="line">                    h.<span class="property">digits</span>[r] = g[l++],</span><br><span class="line">                    h.<span class="property">digits</span>[r] += g[l++] &lt;&lt; <span class="number">8</span>;</span><br><span class="line">                f = t.<span class="property">barrett</span>.<span class="title function_">powMod</span>(h, t.<span class="property">e</span>),</span><br><span class="line">                y += <span class="number">1</span> == u ? <span class="title function_">biToBytes</span>(f) : <span class="number">16</span> == t.<span class="property">radix</span> ? (<span class="number">0</span>,</span><br><span class="line">                n.<span class="property">biToHex</span>)(f) : <span class="title function_">biToString</span>(f, t.<span class="property">radix</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> y</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">           <span class="number">228</span>: <span class="keyword">function</span>(<span class="params">t, e, i</span>) &#123;</span><br><span class="line">        <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(e, <span class="string">&quot;__esModule&quot;</span>, &#123;</span><br><span class="line">            <span class="attr">value</span>: !<span class="number">0</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">var</span> n, s;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">o</span>(<span class="params">t</span>) &#123;</span><br><span class="line">n = <span class="keyword">new</span> <span class="title class_">Array</span>(t);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> e = <span class="number">0</span>; e &lt; n.<span class="property">length</span>; e++)</span><br><span class="line">                n[e] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">new</span> a,</span><br><span class="line">            (s = <span class="keyword">new</span> a).<span class="property">digits</span>[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">o</span>(<span class="number">20</span>);</span><br><span class="line">        <span class="title function_">l</span>(<span class="number">1e15</span>);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">a</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">digits</span> = <span class="string">&quot;boolean&quot;</span> == <span class="keyword">typeof</span> t &amp;&amp; <span class="number">1</span> == t ? <span class="literal">null</span> : n.<span class="title function_">slice</span>(<span class="number">0</span>),</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isNeg</span> = !<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">r</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> e = <span class="keyword">new</span> <span class="title function_">a</span>(!<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> e.<span class="property">digits</span> = t.<span class="property">digits</span>.<span class="title function_">slice</span>(<span class="number">0</span>),</span><br><span class="line">            e.<span class="property">isNeg</span> = t.<span class="property">isNeg</span>,</span><br><span class="line">            e</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">l</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> e = <span class="keyword">new</span> a;</span><br><span class="line">            e.<span class="property">isNeg</span> = t &lt; <span class="number">0</span>,</span><br><span class="line">            t = <span class="title class_">Math</span>.<span class="title function_">abs</span>(t);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; t &gt; <span class="number">0</span>; )</span><br><span class="line">                e.<span class="property">digits</span>[i++] = <span class="number">65535</span> &amp; t,</span><br><span class="line">                t &gt;&gt;= <span class="number">16</span>;</span><br><span class="line">            <span class="keyword">return</span> e</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">c</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> e = <span class="string">&quot;&quot;</span>, i = t.<span class="property">length</span> - <span class="number">1</span>; i &gt; -<span class="number">1</span>; --i)</span><br><span class="line">                e += t.<span class="title function_">charAt</span>(i);</span><br><span class="line">            <span class="keyword">return</span> e</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="string">&quot;0&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>,<span class="string">&quot;4&quot;</span>,<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;7&quot;</span>,<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;f&quot;</span>,<span class="string">&quot;g&quot;</span>,<span class="string">&quot;h&quot;</span>,<span class="string">&quot;i&quot;</span>,<span class="string">&quot;j&quot;</span>,<span class="string">&quot;k&quot;</span>,<span class="string">&quot;l&quot;</span>,<span class="string">&quot;m&quot;</span>,<span class="string">&quot;n&quot;</span>,<span class="string">&quot;o&quot;</span>,<span class="string">&quot;p&quot;</span>,<span class="string">&quot;q&quot;</span>,<span class="string">&quot;r&quot;</span>,<span class="string">&quot;s&quot;</span>,<span class="string">&quot;t&quot;</span>,<span class="string">&quot;u&quot;</span>,<span class="string">&quot;v&quot;</span>,<span class="string">&quot;w&quot;</span>,<span class="string">&quot;x&quot;</span>,<span class="string">&quot;y&quot;</span>,<span class="string">&quot;z&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> u = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="string">&quot;0&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>,<span class="string">&quot;4&quot;</span>,<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;7&quot;</span>,<span class="string">&quot;8&quot;</span>,<span class="string">&quot;9&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;f&quot;</span>);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">d</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> e = <span class="string">&quot;&quot;</span>, i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i)</span><br><span class="line">                e += u[<span class="number">15</span> &amp; t],</span><br><span class="line">                t &gt;&gt;&gt;= <span class="number">4</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">c</span>(e)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">p</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> t &gt;= <span class="number">48</span> &amp;&amp; t &lt;= <span class="number">57</span> ? t - <span class="number">48</span> : t &gt;= <span class="number">65</span> &amp;&amp; t &lt;= <span class="number">90</span> ? <span class="number">10</span> + t - <span class="number">65</span> : t &gt;= <span class="number">97</span> &amp;&amp; t &lt;= <span class="number">122</span> ? <span class="number">10</span> + t - <span class="number">97</span> : <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">h</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> e = <span class="number">0</span>, i = <span class="title class_">Math</span>.<span class="title function_">min</span>(t.<span class="property">length</span>, <span class="number">4</span>), n = <span class="number">0</span>; n &lt; i; ++n)</span><br><span class="line">                e &lt;&lt;= <span class="number">4</span>,</span><br><span class="line">                e |= <span class="title function_">p</span>(t.<span class="title function_">charCodeAt</span>(n));</span><br><span class="line">            <span class="keyword">return</span> e</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> i;</span><br><span class="line">            <span class="keyword">if</span> (t.<span class="property">isNeg</span> != e.<span class="property">isNeg</span>)</span><br><span class="line">                e.<span class="property">isNeg</span> = !e.<span class="property">isNeg</span>,</span><br><span class="line">                i = <span class="title function_">g</span>(t, e),</span><br><span class="line">                e.<span class="property">isNeg</span> = !e.<span class="property">isNeg</span>;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                i = <span class="keyword">new</span> a;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> n, s = <span class="number">0</span>, o = <span class="number">0</span>; o &lt; t.<span class="property">digits</span>.<span class="property">length</span>; ++o)</span><br><span class="line">                    n = t.<span class="property">digits</span>[o] + e.<span class="property">digits</span>[o] + s,</span><br><span class="line">                    i.<span class="property">digits</span>[o] = <span class="number">65535</span> &amp; n,</span><br><span class="line">                    s = <span class="title class_">Number</span>(n &gt;= <span class="number">65536</span>);</span><br><span class="line">                i.<span class="property">isNeg</span> = t.<span class="property">isNeg</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">g</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> i;</span><br><span class="line">            <span class="keyword">if</span> (t.<span class="property">isNeg</span> != e.<span class="property">isNeg</span>)</span><br><span class="line">                e.<span class="property">isNeg</span> = !e.<span class="property">isNeg</span>,</span><br><span class="line">                i = <span class="title function_">f</span>(t, e),</span><br><span class="line">                e.<span class="property">isNeg</span> = !e.<span class="property">isNeg</span>;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> n, s;</span><br><span class="line">                i = <span class="keyword">new</span> a,</span><br><span class="line">                s = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> o = <span class="number">0</span>; o &lt; t.<span class="property">digits</span>.<span class="property">length</span>; ++o)</span><br><span class="line">                    n = t.<span class="property">digits</span>[o] - e.<span class="property">digits</span>[o] + s,</span><br><span class="line">                    i.<span class="property">digits</span>[o] = <span class="number">65535</span> &amp; n,</span><br><span class="line">                    i.<span class="property">digits</span>[o] &lt; <span class="number">0</span> &amp;&amp; (i.<span class="property">digits</span>[o] += <span class="number">65536</span>),</span><br><span class="line">                    s = <span class="number">0</span> - <span class="title class_">Number</span>(n &lt; <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (-<span class="number">1</span> == s) &#123;</span><br><span class="line">                    s = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">for</span> (o = <span class="number">0</span>; o &lt; t.<span class="property">digits</span>.<span class="property">length</span>; ++o)</span><br><span class="line">                        n = <span class="number">0</span> - i.<span class="property">digits</span>[o] + s,</span><br><span class="line">                        i.<span class="property">digits</span>[o] = <span class="number">65535</span> &amp; n,</span><br><span class="line">                        i.<span class="property">digits</span>[o] &lt; <span class="number">0</span> &amp;&amp; (i.<span class="property">digits</span>[o] += <span class="number">65536</span>),</span><br><span class="line">                        s = <span class="number">0</span> - <span class="title class_">Number</span>(n &lt; <span class="number">0</span>);</span><br><span class="line">                    i.<span class="property">isNeg</span> = !t.<span class="property">isNeg</span></span><br><span class="line">                &#125; <span class="keyword">else</span></span><br><span class="line">                    i.<span class="property">isNeg</span> = t.<span class="property">isNeg</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">m</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> e = t.<span class="property">digits</span>.<span class="property">length</span> - <span class="number">1</span>; e &gt; <span class="number">0</span> &amp;&amp; <span class="number">0</span> == t.<span class="property">digits</span>[e]; )</span><br><span class="line">                --e;</span><br><span class="line">            <span class="keyword">return</span> e</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">y</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> e, i = <span class="title function_">m</span>(t), n = t.<span class="property">digits</span>[i], s = <span class="number">16</span> * (i + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (e = s; e &gt; s - <span class="number">16</span> &amp;&amp; <span class="number">0</span> == (<span class="number">32768</span> &amp; n); --e)</span><br><span class="line">                n &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> e</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">v</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i, n, s, o = <span class="keyword">new</span> a, r = <span class="title function_">m</span>(t), l = <span class="title function_">m</span>(e), c = <span class="number">0</span>; c &lt;= l; ++c) &#123;</span><br><span class="line">                i = <span class="number">0</span>,</span><br><span class="line">                s = c;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> u = <span class="number">0</span>; u &lt;= r; ++u,</span><br><span class="line">                ++s)</span><br><span class="line">                    n = o.<span class="property">digits</span>[s] + t.<span class="property">digits</span>[u] * e.<span class="property">digits</span>[c] + i,</span><br><span class="line">                    o.<span class="property">digits</span>[s] = <span class="number">65535</span> &amp; n,</span><br><span class="line">                    i = n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">                o.<span class="property">digits</span>[c + r + <span class="number">1</span>] = i</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> o.<span class="property">isNeg</span> = t.<span class="property">isNeg</span> != e.<span class="property">isNeg</span>,</span><br><span class="line">            o</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">b</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> i, n, s, o = <span class="keyword">new</span> a;</span><br><span class="line">            i = <span class="title function_">m</span>(t),</span><br><span class="line">            n = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> r = <span class="number">0</span>; r &lt;= i; ++r)</span><br><span class="line">                s = o.<span class="property">digits</span>[r] + t.<span class="property">digits</span>[r] * e + n,</span><br><span class="line">                o.<span class="property">digits</span>[r] = <span class="number">65535</span> &amp; s,</span><br><span class="line">                n = s &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">            <span class="keyword">return</span> o.<span class="property">digits</span>[<span class="number">1</span> + i] = n,</span><br><span class="line">            o</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">w</span>(<span class="params">t, e, i, n, s</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> o = <span class="title class_">Math</span>.<span class="title function_">min</span>(e + s, t.<span class="property">length</span>), a = e, r = n; a &lt; o; ++a,</span><br><span class="line">            ++r)</span><br><span class="line">                i[r] = t[a]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> k = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">0</span>,<span class="number">32768</span>,<span class="number">49152</span>,<span class="number">57344</span>,<span class="number">61440</span>,<span class="number">63488</span>,<span class="number">64512</span>,<span class="number">65024</span>,<span class="number">65280</span>,<span class="number">65408</span>,<span class="number">65472</span>,<span class="number">65504</span>,<span class="number">65520</span>,<span class="number">65528</span>,<span class="number">65532</span>,<span class="number">65534</span>,<span class="number">65535</span>);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">C</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> i = <span class="title class_">Math</span>.<span class="title function_">floor</span>(e / <span class="number">16</span>)</span><br><span class="line">              , n = <span class="keyword">new</span> a;</span><br><span class="line">            <span class="title function_">w</span>(t.<span class="property">digits</span>, <span class="number">0</span>, n.<span class="property">digits</span>, i, n.<span class="property">digits</span>.<span class="property">length</span> - i);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> s = e % <span class="number">16</span>, o = <span class="number">16</span> - s, r = n.<span class="property">digits</span>.<span class="property">length</span> - <span class="number">1</span>, l = r - <span class="number">1</span>; r &gt; <span class="number">0</span>; --r,</span><br><span class="line">            --l)</span><br><span class="line">                n.<span class="property">digits</span>[r] = n.<span class="property">digits</span>[r] &lt;&lt; s &amp; <span class="number">65535</span> | (n.<span class="property">digits</span>[l] &amp; k[s]) &gt;&gt;&gt; o;</span><br><span class="line">            <span class="keyword">return</span> n.<span class="property">digits</span>[<span class="number">0</span>] = n.<span class="property">digits</span>[r] &lt;&lt; s &amp; <span class="number">65535</span>,</span><br><span class="line">            n.<span class="property">isNeg</span> = t.<span class="property">isNeg</span>,</span><br><span class="line">            n</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> x = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">15</span>,<span class="number">31</span>,<span class="number">63</span>,<span class="number">127</span>,<span class="number">255</span>,<span class="number">511</span>,<span class="number">1023</span>,<span class="number">2047</span>,<span class="number">4095</span>,<span class="number">8191</span>,<span class="number">16383</span>,<span class="number">32767</span>,<span class="number">65535</span>);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">_</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> i = <span class="title class_">Math</span>.<span class="title function_">floor</span>(e / <span class="number">16</span>)</span><br><span class="line">              , n = <span class="keyword">new</span> a;</span><br><span class="line">            <span class="title function_">w</span>(t.<span class="property">digits</span>, i, n.<span class="property">digits</span>, <span class="number">0</span>, t.<span class="property">digits</span>.<span class="property">length</span> - i);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> s = e % <span class="number">16</span>, o = <span class="number">16</span> - s, r = <span class="number">0</span>, l = r + <span class="number">1</span>; r &lt; n.<span class="property">digits</span>.<span class="property">length</span> - <span class="number">1</span>; ++r,</span><br><span class="line">            ++l)</span><br><span class="line">                n.<span class="property">digits</span>[r] = n.<span class="property">digits</span>[r] &gt;&gt;&gt; s | (n.<span class="property">digits</span>[l] &amp; x[s]) &lt;&lt; o;</span><br><span class="line">            <span class="keyword">return</span> n.<span class="property">digits</span>[n.<span class="property">digits</span>.<span class="property">length</span> - <span class="number">1</span>] &gt;&gt;&gt;= s,</span><br><span class="line">            n.<span class="property">isNeg</span> = t.<span class="property">isNeg</span>,</span><br><span class="line">            n</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">$</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> i = <span class="keyword">new</span> a;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">w</span>(t.<span class="property">digits</span>, <span class="number">0</span>, i.<span class="property">digits</span>, e, i.<span class="property">digits</span>.<span class="property">length</span> - e),</span><br><span class="line">            i</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">S</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (t.<span class="property">isNeg</span> != e.<span class="property">isNeg</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span> - <span class="number">2</span> * <span class="title class_">Number</span>(t.<span class="property">isNeg</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = t.<span class="property">digits</span>.<span class="property">length</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">                <span class="keyword">if</span> (t.<span class="property">digits</span>[i] != e.<span class="property">digits</span>[i])</span><br><span class="line">                    <span class="keyword">return</span> t.<span class="property">isNeg</span> ? <span class="number">1</span> - <span class="number">2</span> * <span class="title class_">Number</span>(t.<span class="property">digits</span>[i] &gt; e.<span class="property">digits</span>[i]) : <span class="number">1</span> - <span class="number">2</span> * <span class="title class_">Number</span>(t.<span class="property">digits</span>[i] &lt; e.<span class="property">digits</span>[i]);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">j</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> i, n, o = <span class="title function_">y</span>(t), l = <span class="title function_">y</span>(e), c = e.<span class="property">isNeg</span>;</span><br><span class="line">            <span class="keyword">if</span> (o &lt; l)</span><br><span class="line">                <span class="keyword">return</span> t.<span class="property">isNeg</span> ? ((i = <span class="title function_">r</span>(s)).<span class="property">isNeg</span> = !e.<span class="property">isNeg</span>,</span><br><span class="line">                t.<span class="property">isNeg</span> = !<span class="number">1</span>,</span><br><span class="line">                e.<span class="property">isNeg</span> = !<span class="number">1</span>,</span><br><span class="line">                n = <span class="title function_">g</span>(e, t),</span><br><span class="line">                t.<span class="property">isNeg</span> = !<span class="number">0</span>,</span><br><span class="line">                e.<span class="property">isNeg</span> = c) : (i = <span class="keyword">new</span> a,</span><br><span class="line">                n = <span class="title function_">r</span>(t)),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Array</span>(i,n);</span><br><span class="line">            i = <span class="keyword">new</span> a,</span><br><span class="line">            n = t;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> u = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(l / <span class="number">16</span>) - <span class="number">1</span>, d = <span class="number">0</span>; e.<span class="property">digits</span>[u] &lt; <span class="number">32768</span>; )</span><br><span class="line">                e = <span class="title function_">C</span>(e, <span class="number">1</span>),</span><br><span class="line">                ++d,</span><br><span class="line">                ++l,</span><br><span class="line">                u = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(l / <span class="number">16</span>) - <span class="number">1</span>;</span><br><span class="line">            n = <span class="title function_">C</span>(n, d),</span><br><span class="line">            o += d;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> p = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(o / <span class="number">16</span>) - <span class="number">1</span>, h = $(e, p - u); -<span class="number">1</span> != <span class="title function_">S</span>(n, h); )</span><br><span class="line">                ++i.<span class="property">digits</span>[p - u],</span><br><span class="line">                n = <span class="title function_">g</span>(n, h);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> v = p; v &gt; u; --v) &#123;</span><br><span class="line">                <span class="keyword">var</span> w = v &gt;= n.<span class="property">digits</span>.<span class="property">length</span> ? <span class="number">0</span> : n.<span class="property">digits</span>[v]</span><br><span class="line">                  , k = v - <span class="number">1</span> &gt;= n.<span class="property">digits</span>.<span class="property">length</span> ? <span class="number">0</span> : n.<span class="property">digits</span>[v - <span class="number">1</span>]</span><br><span class="line">                  , x = v - <span class="number">2</span> &gt;= n.<span class="property">digits</span>.<span class="property">length</span> ? <span class="number">0</span> : n.<span class="property">digits</span>[v - <span class="number">2</span>]</span><br><span class="line">                  , j = u &gt;= e.<span class="property">digits</span>.<span class="property">length</span> ? <span class="number">0</span> : e.<span class="property">digits</span>[u]</span><br><span class="line">                  , A = u - <span class="number">1</span> &gt;= e.<span class="property">digits</span>.<span class="property">length</span> ? <span class="number">0</span> : e.<span class="property">digits</span>[u - <span class="number">1</span>];</span><br><span class="line">                i.<span class="property">digits</span>[v - u - <span class="number">1</span>] = w == j ? <span class="number">65535</span> : <span class="title class_">Math</span>.<span class="title function_">floor</span>((<span class="number">65536</span> * w + k) / j);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> T = i.<span class="property">digits</span>[v - u - <span class="number">1</span>] * (<span class="number">65536</span> * j + A), q = <span class="number">4294967296</span> * w + (<span class="number">65536</span> * k + x); T &gt; q; )</span><br><span class="line">                    --i.<span class="property">digits</span>[v - u - <span class="number">1</span>],</span><br><span class="line">                    T = i.<span class="property">digits</span>[v - u - <span class="number">1</span>] * (<span class="number">65536</span> * j | A),</span><br><span class="line">                    q = <span class="number">65536</span> * w * <span class="number">65536</span> + (<span class="number">65536</span> * k + x);</span><br><span class="line">                (n = <span class="title function_">g</span>(n, <span class="title function_">b</span>(h = $(e, v - u - <span class="number">1</span>), i.<span class="property">digits</span>[v - u - <span class="number">1</span>]))).<span class="property">isNeg</span> &amp;&amp; (n = <span class="title function_">f</span>(n, h),</span><br><span class="line">                --i.<span class="property">digits</span>[v - u - <span class="number">1</span>])</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> n = <span class="title function_">_</span>(n, d),</span><br><span class="line">            i.<span class="property">isNeg</span> = t.<span class="property">isNeg</span> != c,</span><br><span class="line">            t.<span class="property">isNeg</span> &amp;&amp; (i = c ? <span class="title function_">f</span>(i, s) : <span class="title function_">g</span>(i, s),</span><br><span class="line">            n = <span class="title function_">g</span>(e = <span class="title function_">_</span>(e, d), n)),</span><br><span class="line">            <span class="number">0</span> == n.<span class="property">digits</span>[<span class="number">0</span>] &amp;&amp; <span class="number">0</span> == <span class="title function_">m</span>(n) &amp;&amp; (n.<span class="property">isNeg</span> = !<span class="number">1</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Array</span>(i,n)</span><br><span class="line">        &#125;</span><br><span class="line">        e.<span class="property">setMaxDigits</span> = o,</span><br><span class="line">        e.<span class="property">biFromHex</span> = <span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> e = <span class="keyword">new</span> a, i = t.<span class="property">length</span>, n = <span class="number">0</span>; i &gt; <span class="number">0</span>; i -= <span class="number">4</span>,</span><br><span class="line">            ++n)</span><br><span class="line">                e.<span class="property">digits</span>[n] = <span class="title function_">h</span>(t.<span class="title function_">substr</span>(<span class="title class_">Math</span>.<span class="title function_">max</span>(i - <span class="number">4</span>, <span class="number">0</span>), <span class="title class_">Math</span>.<span class="title function_">min</span>(i, <span class="number">4</span>)));</span><br><span class="line">            <span class="keyword">return</span> e</span><br><span class="line">        &#125;</span><br><span class="line">        ,</span><br><span class="line">        e.<span class="property">biHighIndex</span> = m,</span><br><span class="line">        e.<span class="property">biCopy</span> = r,</span><br><span class="line">        e.<span class="property">BigInt</span> = a,</span><br><span class="line">        e.<span class="property">biDivide</span> = <span class="keyword">function</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">j</span>(t, e)[<span class="number">0</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        ,</span><br><span class="line">        e.<span class="property">biMultiply</span> = v,</span><br><span class="line">        e.<span class="property">biDivideByRadixPower</span> = <span class="keyword">function</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> i = <span class="keyword">new</span> a;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">w</span>(t.<span class="property">digits</span>, e, i.<span class="property">digits</span>, <span class="number">0</span>, i.<span class="property">digits</span>.<span class="property">length</span> - e),</span><br><span class="line">            i</span><br><span class="line">        &#125;</span><br><span class="line">        ,</span><br><span class="line">        e.<span class="property">biModuloByRadixPower</span> = <span class="keyword">function</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> i = <span class="keyword">new</span> a;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">w</span>(t.<span class="property">digits</span>, <span class="number">0</span>, i.<span class="property">digits</span>, <span class="number">0</span>, e),</span><br><span class="line">            i</span><br><span class="line">        &#125;</span><br><span class="line">        ,</span><br><span class="line">        e.<span class="property">biSubtract</span> = g,</span><br><span class="line">        e.<span class="property">biCompare</span> = S,</span><br><span class="line">        e.<span class="property">biShiftRight</span> = _,</span><br><span class="line">        e.<span class="property">biToHex</span> = <span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> e = <span class="string">&quot;&quot;</span>, i = (<span class="title function_">m</span>(t),</span><br><span class="line">            <span class="title function_">m</span>(t)); i &gt; -<span class="number">1</span>; --i)</span><br><span class="line">                e += <span class="title function_">d</span>(t.<span class="property">digits</span>[i]);</span><br><span class="line">            <span class="keyword">return</span> e</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">        <span class="number">306</span>: <span class="keyword">function</span>(<span class="params">t, e, i</span>) &#123;</span><br><span class="line">        <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(e, <span class="string">&quot;__esModule&quot;</span>, &#123;</span><br><span class="line">            <span class="attr">value</span>: !<span class="number">0</span></span><br><span class="line">        &#125;),</span><br><span class="line">        e.<span class="property">BarrettMu_powMod</span> = e.<span class="property">BarrettMu_multiplyMod</span> = e.<span class="property">BarrettMu_modulo</span> = e.<span class="property">BarrettMu</span> = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">var</span> n = <span class="title function_">i</span>(<span class="number">228</span>);</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">s</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> e = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biDivideByRadixPower</span>)(t, <span class="variable language_">this</span>.<span class="property">k</span> - <span class="number">1</span>)</span><br><span class="line">              , i = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biMultiply</span>)(e, <span class="variable language_">this</span>.<span class="property">mu</span>)</span><br><span class="line">              , s = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biDivideByRadixPower</span>)(i, <span class="variable language_">this</span>.<span class="property">k</span> + <span class="number">1</span>)</span><br><span class="line">              , o = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biModuloByRadixPower</span>)(t, <span class="variable language_">this</span>.<span class="property">k</span> + <span class="number">1</span>)</span><br><span class="line">              , a = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biMultiply</span>)(s, <span class="variable language_">this</span>.<span class="property">modulus</span>)</span><br><span class="line">              , r = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biModuloByRadixPower</span>)(a, <span class="variable language_">this</span>.<span class="property">k</span> + <span class="number">1</span>)</span><br><span class="line">              , l = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biSubtract</span>)(o, r);</span><br><span class="line">            l.<span class="property">isNeg</span> &amp;&amp; (l = <span class="title function_">biAdd</span>(l, <span class="variable language_">this</span>.<span class="property">bkplus1</span>));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> c = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biCompare</span>)(l, <span class="variable language_">this</span>.<span class="property">modulus</span>) &gt;= <span class="number">0</span>; c; )</span><br><span class="line">                l = (<span class="number">0</span>,</span><br><span class="line">                n.<span class="property">biSubtract</span>)(l, <span class="variable language_">this</span>.<span class="property">modulus</span>),</span><br><span class="line">                c = (<span class="number">0</span>,</span><br><span class="line">                n.<span class="property">biCompare</span>)(l, <span class="variable language_">this</span>.<span class="property">modulus</span>) &gt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> l</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">o</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> i = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biMultiply</span>)(t, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">modulo</span>(i)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">a</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> i = <span class="keyword">new</span> n.<span class="property">BigInt</span>;</span><br><span class="line">            i.<span class="property">digits</span>[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> s = t, o = e; <span class="number">0</span> != (<span class="number">1</span> &amp; o.<span class="property">digits</span>[<span class="number">0</span>]) &amp;&amp; (i = <span class="variable language_">this</span>.<span class="title function_">multiplyMod</span>(i, s)),</span><br><span class="line">            <span class="number">0</span> != (o = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biShiftRight</span>)(o, <span class="number">1</span>)).<span class="property">digits</span>[<span class="number">0</span>] || <span class="number">0</span> != (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biHighIndex</span>)(o); )</span><br><span class="line">                s = <span class="variable language_">this</span>.<span class="title function_">multiplyMod</span>(s, s);</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        &#125;</span><br><span class="line">        e.<span class="property">BarrettMu</span> = <span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">modulus</span> = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biCopy</span>)(t),</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">k</span> = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biHighIndex</span>)(<span class="variable language_">this</span>.<span class="property">modulus</span>) + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">var</span> e = <span class="keyword">new</span> n.<span class="property">BigInt</span>;</span><br><span class="line">            e.<span class="property">digits</span>[<span class="number">2</span> * <span class="variable language_">this</span>.<span class="property">k</span>] = <span class="number">1</span>,</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">mu</span> = (<span class="number">0</span>,</span><br><span class="line">            n.<span class="property">biDivide</span>)(e, <span class="variable language_">this</span>.<span class="property">modulus</span>),</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">bkplus1</span> = <span class="keyword">new</span> n.<span class="property">BigInt</span>,</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">bkplus1</span>.<span class="property">digits</span>[<span class="variable language_">this</span>.<span class="property">k</span> + <span class="number">1</span>] = <span class="number">1</span>,</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">modulo</span> = s,</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">multiplyMod</span> = o,</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">powMod</span> = a</span><br><span class="line">        &#125;</span><br><span class="line">        ,</span><br><span class="line">        e.<span class="property">BarrettMu_modulo</span> = s,</span><br><span class="line">        e.<span class="property">BarrettMu_multiplyMod</span> = o,</span><br><span class="line">        e.<span class="property">BarrettMu_powMod</span> = a</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">_xx</span>(<span class="number">305</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get_pwd</span>(<span class="params">pwd</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="title function_">_xx</span>(<span class="number">228</span>);</span><br><span class="line">     (<span class="number">0</span>, a.<span class="property">setMaxDigits</span>) (<span class="number">129</span>);</span><br><span class="line">    <span class="keyword">var</span> r = <span class="title function_">_xx</span>(<span class="number">305</span>);</span><br><span class="line">   <span class="keyword">var</span> n = <span class="keyword">new</span> r.<span class="title class_">RSAKeyPair</span>(<span class="string">&quot;10001&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;BC087C7C00848CE8A349C9072C3229E0D595F817EDDE9ABF6FC72B41942A759E97956CE9CB7D1F2E99399EADBACC0531F16EAE8EFCB68553DE0E125B2231ED955ADBF5208E65DC804237C93EB23C83E7ECDA0B586ECF31839038EE6B640E0EEC5FF17D219FDEA33E730F287F0D384C74A53DFE1F91ACC63C7C92039A43AC6E97&quot;</span>);</span><br><span class="line">   <span class="keyword">var</span> s = (<span class="number">0</span>, r.<span class="property">encryptedString</span>)(n, pwd);</span><br><span class="line">     <span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">get_pwd</span>(<span class="string">&#x27;123456&#x27;</span>));</span><br></pre></td></tr></table></figure>
<h3 id="3-webpack教学">3. <code>webpack</code>教学</h3>
<h4 id="3-1-逆向目标">3.1 逆向目标</h4>
<ul>
<li>地址：<a target="_blank" rel="noopener" href="https://static.waitwaitpay.com/web/sd_se/index.html">https://static.waitwaitpay.com/web/sd_se/index.html</a></li>
<li>接口：<a target="_blank" rel="noopener" href="https://api.waitwaitpay.com/api/vendors/nearby">https://api.waitwaitpay.com/api/vendors/nearby</a></li>
<li>目标：响应数据<code>ZmQzOTI0MjBlNnic7VvJcuM4Ev0aHqXADuRRtKWIPnT0uU8KEABtdWkbLVXj</code></li>
</ul>
<h4 id="3-2-逆向分析">3.2 逆向分析</h4>
<p>打开目标网站，往下拉，在开发者工具可以抓到这三个包，其中nearby接口请求到的数据是加密之后的密文</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282024893.png" alt="image-20220329140603995"></p>
<h5 id="3-2-1-关键字搜索">3.2.1 关键字搜索</h5>
<p>这个时候可以尝试再在该文件里搜索 JSON.parse( ，就会找到这样一个地方，这里可以发现有一个decode函数，就比较可疑，下个断点</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282024674.png" alt="image-20220329141945204"></p>
<p><strong>数据处理</strong></p>
<p>往上看堆栈，可以发现该函数就是解密的入口，讲请求得到的加密数据e传到f函数，即可解密得到明文数据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282024559.png" alt="image-20220329142942404"></p>
<p>可以很明显的看到这个f函数内部关键调用了这两个函数来进行数据的解密，那么，我们首先就来看看这个 a.default.decode ，向上寻找a是在哪里被定义的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282024739.png" alt="image-20220329150156127"></p>
<p>可发现 a = s(n(432))，这里的432就是代表导出webpack打包的大数组里面第432个大函数，大数组指的是这个大数组</p>
<h5 id="3-2-2-JavaScript分析">3.2.2 JavaScript分析</h5>
<p>​		那我们在本地js里面，怎么才能实现像浏览器这样导出呢，这个时候我们可以直接去找到 <strong>导出器</strong> 类似于 <strong>exports</strong> 这样的关键字，所有的 <strong>webpack</strong> 导出器都是长这样的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282024560.png" alt="image-20220329150257570"></p>
<ul>
<li>
<p>直接复制全部的代码，之前已经发现处理解密的话只有<code>f</code>函数，观察整个函数调用第三方库很少，那么就可以全复制代码，然后调用这个函数即可。</p>
</li>
<li>
<p>直接扣出加密代码，调用当前这个函数</p>
<ul>
<li>
<p>本地的话，我们就可以这样来进行导出然后赋值给a还有o</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">s</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> e &amp;&amp; e.<span class="property">__esModule</span> ? e : &#123;</span><br><span class="line">        <span class="attr">default</span>: e</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 这里的window.xiaoxiaobai就是上面导出器函数</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="title function_">s</span>(<span class="variable language_">window</span>.<span class="title function_">xl</span>(<span class="number">432</span>));</span><br><span class="line"><span class="keyword">var</span> o = <span class="title function_">s</span>(<span class="variable language_">window</span>.<span class="title function_">xl</span>(<span class="number">423</span>));</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282024161.png" alt="image-20220821214608114"></p>
</li>
</ul>
</li>
</ul>
<h4 id="3-3-代码处理">3.3 代码处理</h4>
<ul>
<li>代码比较多。6w多行！！就不复制在这儿了，有需要的上百度网盘下载</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">链接：https:<span class="regexp">//</span>pan.baidu.com<span class="regexp">/s/</span><span class="number">1</span>bkTFBs0oehozi32b6btaqQ </span><br><span class="line">提取码：m57l</span><br></pre></td></tr></table></figure>
<h3 id="总结">总结</h3>
<ul>
<li>找到这个加载器</li>
<li>找到调用模块</li>
<li>构造一个自执行方法</li>
<li>导出加密方法</li>
<li>编写自定义方法 按照流程加密</li>
</ul>
<h2 id="RPC-技术">RPC 技术</h2>
<p>RPC，英文 RangPaCong，中文让爬虫，旨在为爬虫开路，秒杀一切，让爬虫畅通无阻！<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282025041.png" alt="图片"></p>
<h3 id="1-JSRPC-简介">1. JSRPC 简介</h3>
<p>​		<strong>RPC</strong> 技术是非常复杂的，对于我们搞爬虫、逆向的来说，不需要完全了解，只需要知道这项技术如何在逆向中应用就行了。</p>
<p>RPC 在逆向中，简单来说就是将本地和浏览器，看做是服务端和客户端，二者之间通过 <code>WebSocket</code> 协议进行 <code>RPC</code> 通信，在浏览器中将加密函数暴露出来，在本地直接调用浏览器中对应的加密函数，从而得到加密结果，不必去在意函数具体的执行逻辑，也省去了扣代码、补环境等操作，可以省去大量的逆向调试时间。</p>
<h3 id="2-Sekiro-RPC">2. Sekiro-RPC</h3>
<h4 id="2-1-sk食用方式">2.1 sk食用方式</h4>
<h5 id="2-1-0-网盘地址">2.1.0 网盘地址</h5>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">链接：https:<span class="regexp">//</span>pan.baidu.com<span class="regexp">/s/</span><span class="number">1</span>wJESOx24r3m7As6NfKfRaA </span><br><span class="line">提取码：<span class="number">1234</span></span><br></pre></td></tr></table></figure>
<h5 id="2-1-1-执行方式">2.1.1 执行方式</h5>
<p>在本地开启服务端</p>
<ul>
<li>
<p>需要有 Java 环境，配置参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_62959684/article/details/122469086">https://blog.csdn.net/qq_62959684/article/details/122469086</a></p>
<ul>
<li>JDK远程地址：链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1qWutQEJ7315exPqQzNLspA">https://pan.baidu.com/s/1qWutQEJ7315exPqQzNLspA</a>  提取码：vhfg</li>
</ul>
</li>
<li>
<p>Linux &amp; Mac：<code>bin/sekiro.sh</code></p>
</li>
<li>
<p>Windows：<code>bin/sekiro.bat</code></p>
</li>
</ul>
<h5 id="2-2-2-客户端环境">2.2.2 客户端环境</h5>
<ul>
<li>地址：<a target="_blank" rel="noopener" href="https://sekiro.virjar.com/sekiro-doc/assets/sekiro_web_client.js">https://sekiro.virjar.com/sekiro-doc/assets/sekiro_web_client.js</a></li>
</ul>
<h5 id="2-2-3-参数说明">2.2.3 参数说明</h5>
<ul>
<li>使用原理：客户端注入到浏览器环境，然后通过<code>SekiroClient</code>和 <code>Sekiro </code>服务器通信，即可直接 <code>RPC</code> 调用浏览器内部方法，官方提供的<code> SekiroClient</code> 代码样例如下：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成唯一标记uuid编号</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">guid</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">S4</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (((<span class="number">1</span>+<span class="title class_">Math</span>.<span class="title function_">random</span>())*<span class="number">0x10000</span>)|<span class="number">0</span>).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="title function_">S4</span>()+<span class="title function_">S4</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">S4</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">S4</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">S4</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">S4</span>()+<span class="title function_">S4</span>()+<span class="title function_">S4</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 连接服务端</span></span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> <span class="title class_">SekiroClient</span>(<span class="string">&quot;ws://127.0.0.1:5620/business-demo/register?group=ws-group&amp;clientId=&quot;</span>+<span class="title function_">guid</span>());</span><br><span class="line"><span class="comment">// 业务接口 </span></span><br><span class="line">client.<span class="title function_">registerAction</span>(<span class="string">&quot;登陆&quot;</span>,<span class="keyword">function</span>(<span class="params">request, resolve, reject</span>)&#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&quot;&quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>group</strong>：业务类型（接口组），每个业务一个 <code>group</code>，<code>group</code> 下面可以注册多个终端（<code>SekiroClient</code>），同时<code>group</code> 可以挂载多个 <code>Action</code>；</p>
</li>
<li>
<p><strong>clientId</strong>：指代设备，多个设备使用多个机器提供 <code>API</code> 服务，提供群控能力和负载均衡能力；</p>
</li>
<li>
<p><strong>SekiroClient</strong>：服务提供者客户端，主要场景为手机/浏览器等。最终的 <code>Sekiro</code> 调用会转发到 <code>SekiroClient</code>。每个<code> client</code> 需要有一个惟一的 <code>clientId</code>；</p>
</li>
<li>
<p><strong>registerAction</strong>：接口，同一个 <code>group</code> 下面可以有多个接口，分别做不同的功能；</p>
</li>
<li>
<p><strong>resolve</strong>：将内容传回给客户端的方法；</p>
</li>
<li>
<p><strong>request</strong>：服务端传过来的请求，如果请求里有多个参数，可以以键值对的方式从里面提取参数然后再做处理。</p>
</li>
</ul>
<h4 id="2-2-测试使用">2.2 测试使用</h4>
<h5 id="2-2-1-1新建HTML页面">2.2.1 1新建HTML页面</h5>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://file.virjar.com/sekiro_web_client.js?_=123&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">guid</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">function</span> <span class="title function_">S4</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="keyword">return</span> (((<span class="number">1</span>+<span class="title class_">Math</span>.<span class="title function_">random</span>())*<span class="number">0x10000</span>)|<span class="number">0</span>).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">substring</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> (<span class="title function_">S4</span>()+<span class="title function_">S4</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">S4</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">S4</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">S4</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">S4</span>()+<span class="title function_">S4</span>()+<span class="title function_">S4</span>());</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> client = <span class="keyword">new</span> <span class="title class_">SekiroClient</span>(<span class="string">&quot;ws://127.0.0.1:5620/business-demo/register?group=rpc-test&amp;clientId=&quot;</span> + <span class="title function_">guid</span>());</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">        client.<span class="title function_">registerAction</span>(<span class="string">&quot;clientTime&quot;</span>,<span class="keyword">function</span>(<span class="params">request, resolve,reject </span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">resolve</span>(<span class="string">&quot;&quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>());</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="2-2-2-SK-API">2.2.2 SK API</h5>
<p><code>Sekiro</code> 为我们提供了一些 API</p>
<ul>
<li>
<p>查看分组列表：<a target="_blank" rel="noopener" href="http://127.0.0.1:5620/business-demo/groupList">http://127.0.0.1:5620/business-demo/groupList</a></p>
</li>
<li>
<p>查看队列状态：<a target="_blank" rel="noopener" href="http://127.0.0.1:5620/business-demo/clientQueue?group=test">http://127.0.0.1:5620/business-demo/clientQueue?group=test</a></p>
</li>
<li>
<p>调用转发：<a target="_blank" rel="noopener" href="http://127.0.0.1:5620/business-demo/invoke?group=test&amp;action=test&amp;param=testparm">http://127.0.0.1:5620/business-demo/invoke?group=test&amp;action=test&amp;param=testparm</a></p>
</li>
</ul>
<h5 id="2-2-3-python代码调试">2.2.3 python代码调试</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@author: 夏洛</span></span><br><span class="line"><span class="string">@QQ: 1972386194</span></span><br><span class="line"><span class="string">@file: 测试.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">data = &#123;<span class="string">&quot;group&quot;</span>: <span class="string">&quot;rpc-test&quot;</span>,</span><br><span class="line">        <span class="string">&quot;action&quot;</span>: <span class="string">&quot;clientTime&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">res = requests.get(<span class="string">&quot;http://127.0.0.1:5620/business-demo/invoke&quot;</span>,params=data )</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>
<h4 id="2-3-控制台注入">2.3 控制台注入</h4>
<h5 id="2-3-0-逆向目标">2.3.0 逆向目标</h5>
<ul>
<li>
<p>地址：<a target="_blank" rel="noopener" href="http://q.10jqka.com.cn/">http://q.10jqka.com.cn/</a></p>
</li>
<li>
<p>接口：<a target="_blank" rel="noopener" href="http://q.10jqka.com.cn/index/index/board/all/field/zdf/order/desc/page/2/ajax/1/">http://q.10jqka.com.cn/index/index/board/all/field/zdf/order/desc/page/2/ajax/1/</a></p>
</li>
<li>
<p>对抗：<code>cookie</code>反爬虫处理，关键字<code>v</code></p>
</li>
</ul>
<h5 id="2-3-1-找到关键点">2.3.1 找到关键点</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">document</span>, <span class="string">&#x27;cookie&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span> (<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (val.<span class="title function_">indexOf</span>(<span class="string">&#x27;v&#x27;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">debugger</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hook捕获到cookie设置-&gt;&#x27;</span>, val);</span><br><span class="line">      <span class="keyword">return</span> val;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>找到关键位置，然后导出生成cookie加载的函数</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:/Users/XL/AppData/Roaming/Typora/typora-user-images/image-20220829154301457.png" alt="image-20220829154301457"></p>
<h5 id="2-3-2-在控制台注入">2.3.2 在控制台注入</h5>
<ul>
<li>在控制台注入客户端RPC连接服务器</li>
</ul>
<p>**注：**需要关闭debugger</p>
<h5 id="2-3-3-连接服务器并转发">2.3.3 连接服务器并转发</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">guid</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">S4</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> (((<span class="number">1</span>+<span class="title class_">Math</span>.<span class="title function_">random</span>())*<span class="number">0x10000</span>)|<span class="number">0</span>).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="title function_">S4</span>()+<span class="title function_">S4</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">S4</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">S4</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">S4</span>()+<span class="string">&quot;-&quot;</span>+<span class="title function_">S4</span>()+<span class="title function_">S4</span>()+<span class="title function_">S4</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> <span class="title class_">SekiroClient</span>(<span class="string">&quot;ws://127.0.0.1:5620/business-demo/register?group=rpc-test&amp;clientId=&quot;</span> + <span class="title function_">guid</span>());</span><br><span class="line"></span><br><span class="line">client.<span class="title function_">registerAction</span>(<span class="string">&quot;ths&quot;</span>,<span class="keyword">function</span>(<span class="params">request, resolve,reject </span>)&#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="title function_">sss</span>());</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282026640.png" alt="image-20220829154631871"></p>
<h4 id="2-4-油猴注入形式">2.4 油猴注入形式</h4>
<h5 id="2-4-1-油猴工具介绍">2.4.1 油猴工具介绍</h5>
<p><a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https%3A%2F%2Ftampermonkey.net%2F">Tampermonkey</a>是一款免费的浏览器扩展和最为流行的用户脚本管理器，它适用于 Chrome, Microsoft Edge, Safari, Opera Next, 和 Firefox。<br>
以上是油猴官网给出的介绍。它可以让用户自行在添加脚本，并在开启对应页面时应用。如果你了解&quot;<strong>脚本注入</strong>&quot;，你可以把它认为是一个给自己注入脚本的一个工具。</p>
<p><strong>用户油猴脚本</strong>：<a target="_blank" rel="noopener" href="https://greasyfork.org/zh-CN/scripts">https://greasyfork.org/zh-CN/scripts</a></p>
<p>… 大家可以自行娱乐娱乐， 比如说啊VIP电影免费破解</p>
<table>
<thead>
<tr>
<th style="text-align:left">选项</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">@name</td>
<td style="text-align:left">脚本的名称</td>
</tr>
<tr>
<td style="text-align:left">@namespace</td>
<td style="text-align:left">命名空间，用来区分相同名称的脚本，一般写作者名字或者网址就可以</td>
</tr>
<tr>
<td style="text-align:left">@version</td>
<td style="text-align:left">脚本版本，油猴脚本的更新会读取这个版本号</td>
</tr>
<tr>
<td style="text-align:left">@description</td>
<td style="text-align:left">描述这个脚本是干什么用的</td>
</tr>
<tr>
<td style="text-align:left">@author</td>
<td style="text-align:left">编写这个脚本的作者的名字</td>
</tr>
<tr>
<td style="text-align:left"><strong>@match</strong></td>
<td style="text-align:left">从字符串的起始位置匹配正则表达式，只有匹配的网址才会执行对应的脚本，例如 <code>*</code> 匹配所有，<code>https://www.baidu.com/*</code> 匹配百度等，可以参考 Python re 模块里面的 <code>re.match()</code> 方法，允许多个实例</td>
</tr>
<tr>
<td style="text-align:left"><strong>@include</strong></td>
<td style="text-align:left">和 @match 类似，只有匹配的网址才会执行对应的脚本，但是 @include 不会从字符串起始位置匹配，例如 <code>*://*baidu.com/*</code> 匹配百度，具体区别可以参考 <strong>TamperMonkey 官方文档</strong>[8]</td>
</tr>
<tr>
<td style="text-align:left">@icon</td>
<td style="text-align:left">脚本的 icon 图标</td>
</tr>
<tr>
<td style="text-align:left">@grant</td>
<td style="text-align:left">指定脚本运行所需权限，如果脚本拥有相应的权限，就可以调用油猴扩展提供的 API 与浏览器进行交互。如果设置为 none 的话，则不使用沙箱环境，脚本会直接运行在网页的环境中，这时候无法使用大部分油猴扩展的 API。如果不指定的话，油猴会默认添加几个最常用的 API</td>
</tr>
<tr>
<td style="text-align:left">@require</td>
<td style="text-align:left">如果脚本依赖其他 JS 库的话，可以使用 require 指令导入，在运行脚本之前先加载其它库</td>
</tr>
<tr>
<td style="text-align:left"><strong>@run-at</strong></td>
<td style="text-align:left">脚本注入时机，该选项是能不能 hook 到的关键，有五个值可选：<code>document-start</code>：网页开始时；<code>document-body</code>：body出现时；<code>document-end</code>：载入时或者之后执行；<code>document-idle</code>：载入完成后执行，默认选项；<code>context-menu</code>：在浏览器上下文菜单中单击该脚本时，一般将其设置为 <code>document-start</code></td>
</tr>
</tbody>
</table>
<h5 id="2-4-2-编写油猴注入">2.4.2 编写油猴注入</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         toutiao</span></span><br><span class="line"><span class="comment">// @namespace    https://www.toutiao.com/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  toutiao hook</span></span><br><span class="line"><span class="comment">// @author       xialuo</span></span><br><span class="line"><span class="comment">// @match        https://www.toutiao.com/*</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// @require      https://sekiro.virjar.com/sekiro-doc/assets/sekiro_web_client.js</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">guid</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">S4</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (((<span class="number">1</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>()) * <span class="number">0x10000</span>) | <span class="number">0</span>).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (<span class="title function_">S4</span>() + <span class="title function_">S4</span>() + <span class="string">&quot;-&quot;</span> + <span class="title function_">S4</span>() + <span class="string">&quot;-&quot;</span> + <span class="title function_">S4</span>() + <span class="string">&quot;-&quot;</span> + <span class="title function_">S4</span>() + <span class="string">&quot;-&quot;</span> + <span class="title function_">S4</span>() + <span class="title function_">S4</span>() + <span class="title function_">S4</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> <span class="title class_">SekiroClient</span>(<span class="string">&quot;ws://127.0.0.1:5620/business-demo/register?group=tt-test&amp;clientId=&quot;</span> + <span class="title function_">guid</span>());</span><br><span class="line">    <span class="comment">/* 自定义函数 */</span></span><br><span class="line"></span><br><span class="line">    client.<span class="title function_">registerAction</span>(<span class="string">&quot;toutiao&quot;</span>, <span class="keyword">function</span> (<span class="params">request, resolve, reject</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = request[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!url)&#123;</span><br><span class="line">            <span class="title function_">reject</span>(<span class="string">&quot;url 不能为空&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">resolve</span>(&#123;<span class="string">&quot;signature&quot;</span>: <span class="variable language_">window</span>.<span class="property">byted_acrawler</span>.<span class="title function_">sign</span>(&#123;url&#125;), <span class="string">&quot;cookie&quot;</span>: <span class="variable language_">document</span>.<span class="property">cookie</span>&#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h5 id="2-4-3-python代码调用">2.4.3 python代码调用</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@author: 夏洛</span></span><br><span class="line"><span class="string">@QQ: 1972386194</span></span><br><span class="line"><span class="string">@file: 头条测试.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib3,requests</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sig</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;group&quot;</span>: <span class="string">&quot;tt-test&quot;</span>,</span><br><span class="line">        <span class="string">&quot;action&quot;</span>: <span class="string">&quot;toutiao&quot;</span>,</span><br><span class="line">        <span class="string">&quot;url&quot;</span>: url</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=<span class="string">&quot;http://127.0.0.1:5620/business-demo/invoke&quot;</span>, data=data, verify=<span class="literal">False</span>)</span><br><span class="line">    resp = res.json()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;?&quot;</span> <span class="keyword">in</span> url:</span><br><span class="line">        url += <span class="string">&quot;&amp;_signature=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(resp[<span class="string">&#x27;signature&#x27;</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        url += <span class="string">&quot;?_signature=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(resp[<span class="string">&#x27;signature&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line"></span><br><span class="line">url = get_sig(<span class="string">&#x27;https://www.toutiao.com/api/pc/list/feed?channel_id=0&amp;min_behot_time=1636703275&amp;refresh_count=2&amp;category=pc_profile_recommend&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(url)</span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">res = session.get(url,headers=headers)</span><br><span class="line"><span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="keyword">if</span> res.json().get(<span class="string">&#x27;message&#x27;</span>) == <span class="string">&#x27;success&#x27;</span>:</span><br><span class="line">        items = res.json().get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> items:</span><br><span class="line">            title = i.get(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(title)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>![image-20220412211115059](…/…/…/python-学习/爬虫第八期/27 JS RPC-2022-12-02-夏洛/day23-js-rpc/images/image-20220412211115059.png)</p>
<h4 id="2-5-JS注入动态传参">2.5 JS注入动态传参</h4>
<h5 id="2-5-1-逆向目标">2.5.1 逆向目标</h5>
<ul>
<li>地址：<a target="_blank" rel="noopener" href="https://www.xingtu.cn/sup/creator/hot">https://www.xingtu.cn/sup/creator/hot</a></li>
<li>接口：<a target="_blank" rel="noopener" href="https://www.xingtu.cn/h/api/gateway/handler_get/">https://www.xingtu.cn/h/api/gateway/handler_get/</a></li>
<li>对抗：<code>sign</code>签名处理<code> sign: w((0, r.Z)((0,r.Z)(&#123;&#125;, n), l), s, o)</code></li>
</ul>
<h5 id="2-5-2-逆向分析">2.5.2 逆向分析</h5>
<ol>
<li>
<p>使用<code>xhr</code>断点，进入到响应<code>.interceptors.response.use</code>的位置</p>
</li>
<li>
<p>然后找到请求位置<code>interceptors.request.use</code>下断点</p>
</li>
<li>
<p><code>sign</code>签名验证在https://lf6-cdn2-tos.bytegoofy.com/star/idou_fe/assets/js/chunk-vendors.4ca1ae37.js里面</p>
</li>
</ol>
<h5 id="2-5-2-RPC注入进去">2.5.2  RPC注入进去</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> newElement = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">    newElement.<span class="title function_">setAttribute</span>(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;text/javascript&quot;</span>);</span><br><span class="line">    newElement.<span class="title function_">setAttribute</span>(<span class="string">&quot;src&quot;</span>, <span class="string">&quot;https://sekiro.virjar.com/sekiro-doc/assets/sekiro_web_client.js&quot;</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(newElement);</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">guid</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">S4</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (((<span class="number">1</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>()) * <span class="number">0x10000</span>) | <span class="number">0</span>).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="title function_">S4</span>() + <span class="title function_">S4</span>() + <span class="string">&quot;-&quot;</span> + <span class="title function_">S4</span>() + <span class="string">&quot;-&quot;</span> + <span class="title function_">S4</span>() + <span class="string">&quot;-&quot;</span> + <span class="title function_">S4</span>() + <span class="string">&quot;-&quot;</span> + <span class="title function_">S4</span>() + <span class="title function_">S4</span>() + <span class="title function_">S4</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">startSekiro</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> client = <span class="keyword">new</span> <span class="title class_">SekiroClient</span>(<span class="string">&quot;ws://127.0.0.1:5620/business-demo/register?group=rpc-xl&amp;clientId=&quot;</span> + <span class="title function_">guid</span>());</span><br><span class="line"></span><br><span class="line">        client.<span class="title function_">registerAction</span>(<span class="string">&quot;des&quot;</span>, <span class="keyword">function</span> (<span class="params">request, resolve, reject</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> enc_data = request[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">            <span class="keyword">var</span> res = enc_data;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="title function_">v</span>()(res));</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">setTimeout</span>(startSekiro, <span class="number">1000</span>)</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="2-5-3-接口调用">2.5.3  接口调用</h5>
<ul>
<li>使用python程序来进行调用</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282025860.png" alt="image-20220829190608678"></p>
<h5 id="2-5-4-数据处理">2.5.4 数据处理</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests,httpx</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_data</span>():</span><br><span class="line">    data = &#123;<span class="string">&quot;group&quot;</span>: <span class="string">&quot;rpc-xl&quot;</span>,</span><br><span class="line">            <span class="string">&quot;action&quot;</span>: <span class="string">&quot;des&quot;</span>,</span><br><span class="line">            <span class="string">&quot;data&quot;</span>: <span class="string">&#x27;hot_list_id0service_methodGetHotListDataservice_nameauthor.AdStarAuthorServicesign_strict1tag61e540314fe6649d1b8489d8e39539b8836fb99e1538974d3ac1fe98&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">    res = requests.get(<span class="string">&quot;http://127.0.0.1:5620/business-demo/invoke&quot;</span>,params=data)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line">    <span class="keyword">return</span> res.json().get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():</span><br><span class="line">    url = <span class="string">&#x27;https://www.xingtu.cn/h/api/gateway/handler_get/&#x27;</span></span><br><span class="line">    params = &#123;</span><br><span class="line">    <span class="string">&quot;hot_list_id&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tag&quot;</span>: <span class="string">&quot;61e540314fe6649d1b8489d8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;service_name&quot;</span>: <span class="string">&quot;author.AdStarAuthorService&quot;</span>,</span><br><span class="line">    <span class="string">&quot;service_method&quot;</span>: <span class="string">&quot;GetHotListData&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sign_strict&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    sign = des_data()</span><br><span class="line">    params[<span class="string">&#x27;sign&#x27;</span>] = sign</span><br><span class="line">    <span class="built_in">print</span>(params)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">        <span class="string">&quot;cookie&quot;</span>: <span class="string">&quot;passport_csrf_token=716a6ee6bb6ae9fe54c4def566579821; passport_csrf_token_default=716a6ee6bb6ae9fe54c4def566579821; csrftoken=2WxhAKTfiTIfrZMDDGEefFi; tt_webid=7125341076596196878; gfpart_1.0.1.3839_220078=0; gfpart_1.0.1.3880_220078=1; csrf_session_id=989c7a1f558481addafc6a4445352540; ttcid=0891c26ee93b4f99a10e9617e05bfd6521; MONITOR_WEB_ID=a3ed951f-2a8d-4227-af45-fd8d6ab1c558; tt_scid=6YpBFdUP4y4viKPpF7.VwWymz5HfHwEji21sTogt2orWNJWqFx2mvEqK2F-FTP1j3e36; s_v_web_id=verify_l7eigj3o_JgIGTLCk_XV4L_4rbD_AN3O_OGR9TFMOjind; _tea_utm_cache_2018=undefined; passport_auth_status=fb7ee123cc0428b8c547fdea31241cb5%2C335b6426aae826682b6e84c8e827def4; passport_auth_status_ss=fb7ee123cc0428b8c547fdea31241cb5%2C335b6426aae826682b6e84c8e827def4; sid_guard=b0bdf59ccd1bee257f53107a3ce0b50a%7C1661762541%7C5183999%7CFri%2C+28-Oct-2022+08%3A42%3A20+GMT; uid_tt=6c1566658a3baed6a71c342a0769603d; uid_tt_ss=6c1566658a3baed6a71c342a0769603d; sid_tt=b0bdf59ccd1bee257f53107a3ce0b50a; sessionid=b0bdf59ccd1bee257f53107a3ce0b50a; sessionid_ss=b0bdf59ccd1bee257f53107a3ce0b50a; sid_ucp_v1=1.0.0-KDczYzBmOGY4MDYyMjlmOTZjNTNiZTQ2NGY0M2Y4YzA1MzEzOTdhZTAKFgjIk8Dk7I3-ARDt97GYBhimDDgIQCYaAmxmIiBiMGJkZjU5Y2NkMWJlZTI1N2Y1MzEwN2EzY2UwYjUwYQ; ssid_ucp_v1=1.0.0-KDczYzBmOGY4MDYyMjlmOTZjNTNiZTQ2NGY0M2Y4YzA1MzEzOTdhZTAKFgjIk8Dk7I3-ARDt97GYBhimDDgIQCYaAmxmIiBiMGJkZjU5Y2NkMWJlZTI1N2Y1MzEwN2EzY2UwYjUwYQ; star_sessionid=b0bdf59ccd1bee257f53107a3ce0b50a; gftoken=YjBiZGY1OWNjZHwxNjYxNzYyNjE0OTF8fDAGBgYGBgY; pay_sessionid=sOmyHbM1VmFN1cplmbaj9btodVx2M5E7uB1z9v2XpuqnBWyjEFef8RmPmYBMFnv8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pragma&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sec-ch-ua&quot;</span>: <span class="string">&quot;\&quot;Chromium\&quot;;v=\&quot;104\&quot;, \&quot; Not A;Brand\&quot;;v=\&quot;99\&quot;, \&quot;Google Chrome\&quot;;v=\&quot;104\&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sec-ch-ua-mobile&quot;</span>: <span class="string">&quot;?0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sec-ch-ua-platform&quot;</span>: <span class="string">&quot;\&quot;Windows\&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sec-fetch-dest&quot;</span>: <span class="string">&quot;document&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sec-fetch-mode&quot;</span>: <span class="string">&quot;navigate&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sec-fetch-site&quot;</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sec-fetch-user&quot;</span>: <span class="string">&quot;?1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;upgrade-insecure-requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.get(url,params=params,headers=headers,)</span><br><span class="line">    <span class="built_in">print</span>(res.url)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line">des_data()</span><br></pre></td></tr></table></figure>
<h2 id="JSVMP">JSVMP</h2>
<p><strong>说明</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本教程仅供学习交流使用，严禁用于商业用途和非法用途，否则由此产生的一切后果均与本人无关，请各学员自觉遵守相关法律法规。</span><br></pre></td></tr></table></figure>
<h3 id="1-简介">1 简介</h3>
<h4 id="1-1-js虚拟机保护方案">1.1 js虚拟机保护方案</h4>
<p>参考文章：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/YDx5Dr-HDfAm-sAqeWW0qg">https://mp.weixin.qq.com/s/YDx5Dr-HDfAm-sAqeWW0qg</a></p>
<p>关于jsvmp的解法一般有3种，<code>补环境，和插桩扣逻辑，jsrpc</code>，当然还有自动化等方式可自行研究试试</p>
<h3 id="2-实战分析">2 实战分析</h3>
<ul>
<li>
<p>掌握插桩调试</p>
</li>
<li>
<p>掌握基本补环境操作</p>
</li>
</ul>
<h4 id="2-1-逆向目标-2">2.1  逆向目标</h4>
<ul>
<li>目标：<a target="_blank" rel="noopener" href="https://www.toutiao.com/">https://www.toutiao.com/</a></li>
<li>参数：<code>_signature:  _02B4Z6wo00901-PSSggAAIDC</code></li>
</ul>
<h4 id="2-2-逆向分析-2">2.2 逆向分析</h4>
<p>进入<code>I</code>函数，在<code>return o</code>即<code>signature</code>，经分析得最后一句就是``var o = window.byted_acrawler.sign.call(n, i)<code> , 也就是</code>signature<code>是</code>window.byted_acrawler.sign`函数生成的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282025395.png" alt="image-20221018145754018"></p>
<h5 id="2-2-1-补环境操作">2.2.1 补环境操作</h5>
<h6 id="1、补充第一个referrer">1、补充第一个referrer</h6>
<p>鉴于js的第一句判断了<code>window</code>是否=<code>undefined</code>，如果<code>=undefined则glb=global</code>(node环境<code>global</code>是全局变量)，否则<code>glb=window</code>(浏览器<code>window</code>是全局变量)，所以我们先补个<code>window</code>对象（有两种方法，①本地js先用<code>sdom</code>补充一个<code>window，②window=global）</code>，本次采用<code>window=global</code>的方法；<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282026641.png" alt="image-20221018150800840"></p>
<p><strong>小插曲知识点1</strong>：<code>日志断点又称插桩</code>,可以在console界面输出A变量值以及S[R][A]值；此处可以补很多东西，但是我们先看报错再后面挑着补</p>
<ul>
<li>使用浏览器打开日志断点,输入<code>A,S[R][A]</code></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282025399.png" alt="image-20221018151510074"></p>
<p><strong>小插曲知识点2：</strong><code>条件断点</code>，当A变量等于<code>referrer</code>时会自动<code>debugger</code>住</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282025398.png" alt="image-20221018193545053"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282025407.png" alt="image-20221018154028571"></p>
<h6 id="2、补充sign">2、补充sign</h6>
<p><strong>第二次运行报错如下，缺少<code>sign</code>这个函数</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">TypeError</span>: <span class="title class_">Cannot</span> read properties <span class="keyword">of</span> <span class="title function_">undefined</span> (reading <span class="string">&#x27;sign&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282025411.png" alt="image-20221018154759698"></p>
<p><strong>第二次运行报错原因分析</strong>，js文件检测了是否是<code>node</code>环境，如<code>exports</code>只在<code>node</code>环境下存在，但是浏览器是<code>undefined</code>，所以我们直接把<code>&quot;undefined&quot; != typeof exports ? exports : void 0 </code>替换成浏览器输出的结果<code>undefined</code><br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282025570.png" alt="image-20221018155612716"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282025388.png" alt="image-20221018155849684"></p>
<h6 id="3、补充-href">3、补充 href</h6>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">S[R] = S[R][A]</span><br><span class="line">     ^</span><br><span class="line"><span class="title class_">TypeError</span>: <span class="title class_">Cannot</span> read properties <span class="keyword">of</span> <span class="title function_">undefined</span> (reading <span class="string">&#x27;href&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>3.1、解决方案</p>
<ul>
<li>使用插桩继续调试，然后补充对应环境即可</li>
</ul>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">= &#123;</span></span><br><span class="line"><span class="title">    href</span>:&#x27;https://www.toutiao.com/&#x27;,</span><br><span class="line">    protocol:&#x27;https&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="4、补-length">4、补 length</h6>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">S[R] = S[R][A]</span><br><span class="line">      ^</span><br><span class="line"><span class="title class_">TypeError</span>: <span class="title class_">Cannot</span> read properties <span class="keyword">of</span> <span class="title function_">undefined</span> (reading <span class="string">&#x27;length&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>注：这里可以下断点查看、到了哪个位置给程序报的错、可以发现在执行完<code>protocol</code>就开始报错，所以可以判断没有<code>protocol</code>、在控制台执行打出即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:/Users/XL/AppData/Roaming/Typora/typora-user-images/image-20221205223627376.png" alt="image-20221205223627376"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:/Users/XL/AppData/Roaming/Typora/typora-user-images/image-20221205223703551.png" alt="image-20221205223703551"></p>
<h6 id="5、补useragent">5、补useragent</h6>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:/Users/XL/AppData/Roaming/Typora/typora-user-images/image-20221205223758751.png" alt="image-20221205223758751"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">navigator = &#123;</span><br><span class="line">    <span class="attr">userAgent</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282026642.png" alt="image-20221018162925649"></p>
<h6 id="6、参数长短补充">6、参数长短补充</h6>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">据前辈介绍<span class="keyword">signature</span>长短和cookie的长度有关，所以打上条件断点，然后我们再补个cookie，而且document.cookie的位置得往后放，否则可能被删除清空什么的；还有<span class="keyword">signature</span>如果不成功的话，有可能就是此处<span class="number">281</span>行出了问题，可以对比的继续补环境</span><br></pre></td></tr></table></figure>
<h4 id="2-3-案例code">2.3 案例code</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sign</span>(<span class="params">pp</span>):</span><br><span class="line">    signa = execjs.<span class="built_in">compile</span>(<span class="built_in">open</span>(<span class="string">&#x27;aa.js&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>).read()).call(<span class="string">&#x27;get_sign&#x27;</span>,pp)</span><br><span class="line">    <span class="keyword">return</span> signa</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;authority&quot;</span>: <span class="string">&quot;i.snssdk.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;accept-language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cache-control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pragma&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">    <span class="string">&quot;referer&quot;</span>: <span class="string">&quot;https://www.toutiao.com/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sec-ch-ua&quot;</span>: <span class="string">&quot;^\\^Chromium^^;v=^\\^106^^, ^\\^Google&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sec-ch-ua-mobile&quot;</span>: <span class="string">&quot;?0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sec-ch-ua-platform&quot;</span>: <span class="string">&quot;^\\^Windows^^&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sec-fetch-dest&quot;</span>: <span class="string">&quot;empty&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sec-fetch-mode&quot;</span>: <span class="string">&quot;cors&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sec-fetch-site&quot;</span>: <span class="string">&quot;cross-site&quot;</span>,</span><br><span class="line">    <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">    <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">    <span class="string">&quot;origin&quot;</span>: <span class="string">&quot;https://www.toutiao.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;access-control-request-headers&quot;</span>: <span class="string">&quot;content-type&quot;</span>,</span><br><span class="line">    <span class="string">&quot;access-control-request-method&quot;</span>: <span class="string">&quot;POST&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&quot;_S_WIN_WH&quot;</span>: <span class="string">&quot;1631_748&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_S_DPR&quot;</span>: <span class="string">&quot;1.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_S_IPAD&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tt_webid&quot;</span>: <span class="string">&quot;7125340976496215589&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ttcid&quot;</span>: <span class="string">&quot;af0a3ffe0342459282b3b41073a931e426&quot;</span>,</span><br><span class="line">    <span class="string">&quot;csrftoken&quot;</span>: <span class="string">&quot;3e5c6c4772e586f2f8f2c25745914ab9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;s_v_web_id&quot;</span>: <span class="string">&quot;verify_l7d90e5m_AVBEjJn8_ZHlS_4PDF_BMYV_v5HtPvp7Pxeu&quot;</span>,</span><br><span class="line">    <span class="string">&quot;MONITOR_WEB_ID&quot;</span>: <span class="string">&quot;a3ed951f-2a8d-4227-af45-fd8d6ab1c558&quot;</span>,</span><br><span class="line">    <span class="string">&quot;local_city_cache&quot;</span>: <span class="string">&quot;^%^E9^%^95^%^BF^%^E6^%^B2^%^99&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_tea_utm_cache_24&quot;</span>: <span class="string">&quot;undefined&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ttwid&quot;</span>: <span class="string">&quot;1^%^7CbwiwxwyD2PbYRS3V5P3vpvR1EN-Iwiqicj_VNrFsM9g^%^7C1666081140^%^7Cd9aea9f3de2c3ed62318563856b529d65b7b6495151977756631e87aeb68ecfa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tt_scid&quot;</span>: <span class="string">&quot;IOB8RVnWE3XRiQTmqc9xdbPJA.-kxRc3ADliV7EU.LsP52IhKxUUsJHu0n5bwVjZa317&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;https://www.toutiao.com/api/pc/list/feed&quot;</span></span><br><span class="line">urla = <span class="string">&#x27;https://www.toutiao.com/api/pc/list/feed?offset=0&amp;channel_id=94349549395&amp;max_behot_time=0&amp;category=pc_profile_channel&amp;disable_raw_data=true&amp;aid=24&amp;app_name=toutiao_web&#x27;</span></span><br><span class="line">signa = get_sign(urla)</span><br><span class="line">urlx = urla + <span class="string">&#x27;&amp;_signature=&#x27;</span> + signa</span><br><span class="line">response = requests.get(urlx, headers=headers, cookies=cookies)</span><br><span class="line"><span class="built_in">print</span>(response.url)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>
<h2 id="补环境系列教程">补环境系列教程</h2>
<ul>
<li>掌握自动吐坏境操作</li>
<li>掌握环境差异化hook操作</li>
</ul>
<h3 id="1-项目实操一">1 项目实操一</h3>
<h4 id="1-1-逆向目标">1.1  逆向目标</h4>
<ul>
<li>目标：<a target="_blank" rel="noopener" href="https://www.zhihu.com/topic/19555513/hot">https://www.zhihu.com/topic/19555513/hot</a></li>
<li>参数：<strong>x-zse-96</strong>:  _<code>02B4Z6wo00901-PSSggAAIDC</code></li>
</ul>
<h4 id="1-2-逆向分析">1.2 逆向分析</h4>
<p>全局搜索某乎关键字、然后在JS里面有2处地方，全部选中然后下断点调试</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282026739.png" alt="image-20221129164209119"></p>
<p>从这里可以看出</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">signature: (<span class="number">0</span>,<span class="built_in">Z</span>(r).encrypt)(<span class="built_in">f</span>()(s))</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282026736.png" alt="image-20221129164822023"></p>
<p>进去里面的算法查看，下个断点看数据。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282026738.png" alt="image-20221129164906448"></p>
<p>这就不好办了，那么即使补环境出来的结果，也不知道是不是对的。一般这种情况下，就是计算涉及到的随机数或者时间。而这里就是包含的随机数，所以需要hook随机数的返回</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Math</span>.<span class="property">random</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.50</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后在头部加上<code>jsdom</code>的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span>&#123;<span class="variable constant_">JSDOM</span>&#125;=<span class="built_in">require</span>(<span class="string">&quot;jsdom&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> dom=<span class="keyword">new</span> <span class="title function_">JSDOM</span>(<span class="string">&quot;&lt;!DOCTYPE html&gt;&lt;p&gt;Hello world&lt;/p&gt;&quot;</span>);</span><br><span class="line"><span class="variable language_">window</span>=dom.<span class="property">window</span>;</span><br><span class="line"><span class="variable language_">document</span>=<span class="variable language_">window</span>.<span class="property">document</span>;  <span class="comment">//document对象:代表给定浏览器窗口中的HTML文档,</span></span><br><span class="line">navigator=<span class="variable language_">window</span>.<span class="property">navigator</span>; <span class="comment">// 关于运行当前脚本的应用程序的相关信息</span></span><br><span class="line">location=<span class="variable language_">window</span>.<span class="property">location</span>; <span class="comment">//对象包含当前页面的URL信息</span></span><br><span class="line">history=<span class="variable language_">window</span>.<span class="property">history</span>; <span class="comment">// 历史会话</span></span><br><span class="line">screen=<span class="variable language_">window</span>.<span class="property">screen</span>; <span class="comment">// 浏览器屏幕</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Math</span>.<span class="property">random</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.50</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这个结果和样本明显不一样，说明还缺少了其他环境没有补到,，这个时候就需要使用自动吐环境啦，对前面的环境变量上代理，看看还用到了什么属性和方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span> = <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="variable language_">window</span>, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, property, value, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;设置属性set window&quot;</span>, property, <span class="keyword">typeof</span> value);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(...<span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, property, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;获取属性get window&quot;</span>, property, <span class="keyword">typeof</span> target[property]);</span><br><span class="line">        <span class="keyword">return</span> target[property]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">document</span> = <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="variable language_">document</span>, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, property, value, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;设置属性set document&quot;</span>, property, <span class="keyword">typeof</span> value);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(...<span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, property, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;获取属性get document&quot;</span>, property, <span class="keyword">typeof</span> target[property]);</span><br><span class="line">        <span class="keyword">return</span> target[property]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">navigator = <span class="keyword">new</span> <span class="title class_">Proxy</span>(navigator, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, property, value, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;设置属性set navigator&quot;</span>, property, <span class="keyword">typeof</span> value);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(...<span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, property, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;获取属性get navigator&quot;</span>, property, <span class="keyword">typeof</span> target[property]);</span><br><span class="line">        <span class="keyword">return</span> target[property]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">location = <span class="keyword">new</span> <span class="title class_">Proxy</span>(location, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, property, value, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;设置属性set location&quot;</span>, property, <span class="keyword">typeof</span> value);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(...<span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, property, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;获取属性get location&quot;</span>, property, <span class="keyword">typeof</span> target[property]);</span><br><span class="line">        <span class="keyword">return</span> target[property]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">history = <span class="keyword">new</span> <span class="title class_">Proxy</span>(history, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, property, value, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;设置属性set history&quot;</span>, property, <span class="keyword">typeof</span> value);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(...<span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, property, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;获取属性get history&quot;</span>, property, <span class="keyword">typeof</span> target[property]);</span><br><span class="line">        <span class="keyword">return</span> target[property]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">screen = <span class="keyword">new</span> <span class="title class_">Proxy</span>(screen, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, property, value, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;设置属性set screen&quot;</span>, property, <span class="keyword">typeof</span> value);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(...<span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, property, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;获取属性get screen&quot;</span>, property, <span class="keyword">typeof</span> target[property]);</span><br><span class="line">        <span class="keyword">return</span> target[property]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="2-项目实操二">2 项目实操二</h3>
<h4 id="2-1-逆向目标-3">2.1 逆向目标</h4>
<p>地址：<a target="_blank" rel="noopener" href="http://q.10jqka.com.cn/">http://q.10jqka.com.cn/</a></p>
<h4 id="2-2-补环境实操">2.2 补环境实操</h4>
<p>先补充基本的环境</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282027298.png" alt="image-20221201221307777"></p>
<p>注：如图环境补完后、发现还是没有cookie的值、这个时候需要排查是不是代码走了其他的分支、导致输出异常。可以在<code>try、catch</code>里面输出查看。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282026751.png" alt="image-20221201221150407"></p>
<p>在这个位置输出、可以发现有环境出现了异常，这个时候需要补了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282027299.png" alt="image-20221201221646291"></p>
<h3 id="3-吐环境脚本">3 吐环境脚本</h3>
<h4 id="3-1-简介">3.1 简介</h4>
<p><code>Proxy</code>可以理解为，在目标对象之前设一层&quot;拦截&quot;，外界对该对象的访问，都必须通过这层拦截,可以对外界的访问进行过滤和改写（表示可以用它&quot;代理&quot;某些操作，可以翻为“代理器&quot;）。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282026153.webp" alt="img"></p>
<p>基本使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标对象（被代理对象）</span></span><br><span class="line"><span class="keyword">var</span> target = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;JACK&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理行为对象（对目标对象进行取值或赋值行为时，会进入此对象的方法）</span></span><br><span class="line"><span class="keyword">var</span> handler = &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">target, property, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;get: &quot;</span>, target, property, target[property]);</span><br><span class="line">        <span class="keyword">return</span> target[property];</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">target, property, value</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;set: &quot;</span>, target, property, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(...<span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 Proxy 构造函数实例出新的target对象</span></span><br><span class="line"><span class="keyword">var</span> targets = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handler)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取值操作 会进入handler中的get方法 并打印</span></span><br><span class="line">targets.<span class="property">name</span>     <span class="comment">//  get:  &#123;name: &#x27;JACK&#x27;, age: 18&#125; name JACK</span></span><br><span class="line"><span class="comment">// 赋值操作 会进入handler中的set方法 并打印</span></span><br><span class="line">targets.<span class="property">age</span> = <span class="number">25</span> <span class="comment">//  set:  &#123;name: &#x27;JACK&#x27;, age: 18&#125; age 25</span></span><br></pre></td></tr></table></figure>
<p>Proxy对象由两个部分组成：target、handler</p>
<p>target:目标对象<br>
handler：是一个对象，声明了代理target的指定行为，支持的拦截操作，一共13种：</p>
<ul>
<li>get(target,propKey,receiver)：拦截对象属性的读取。</li>
<li>set(target,propKey,value,receiver)：拦截对象属性的设置，返回一个布尔值（修改成功）。</li>
</ul>
<p>对于JS逆向来说，我们扣完代码的目的就是调用目标网站的加/解密函数或某个值的算法，一般情况下我们把他的算法扣下来能够直接执行，但是如果检测了浏览器指纹，那就比较难了，只能够去深入分析进行补环境。</p>
<p>一般的补环境的是通过运行程序后的undefined报错去一点一点分析，一点一点的去补一些环境，是非常掉头发的。</p>
<p>所以我们使用 Proxy 对全局遍历window、document、navigator等常见环境检测点进行代理，拦截代理对象的读取、函数调用等操作，并通过控制台输出，这样的话我们就能够实现检测环境自吐的功能，后续我们再针对吐出来的环境统一的进行补环境，这样就会方便的多。</p>
<h4 id="3-2-脚本编写">3.2 脚本编写</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span> = <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="variable language_">document</span>, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, property, value, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;设置属性set document&quot;</span>, property, <span class="keyword">typeof</span> value);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">set</span>(...<span class="variable language_">arguments</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, property, receiver</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;获取属性get document&quot;</span>, property, <span class="keyword">typeof</span> target[property]);</span><br><span class="line">        <span class="keyword">return</span> target[property]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="4-jsdom补环境">4 <code>jsdom</code>补环境</h3>
<p>参考地址：<a target="_blank" rel="noopener" href="https://github.com/jsdom/jsdom/wiki/jsdom-%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3">https://github.com/jsdom/jsdom/wiki/jsdom-中文文档</a></p>
<p><code>jsdom</code>是一个纯粹由 <code>javascript</code> 实现的一系列 web标准，特别是 WHATWG 组织制定的<a target="_blank" rel="noopener" href="https://dom.spec.whatwg.org/">DOM</a>和 <a target="_blank" rel="noopener" href="https://html.spec.whatwg.org/multipage/">HTML</a> 标准，用于在<code>nodejs</code>中使用。大体上来说，该项目的目标是模拟足够的Web浏览器子集，以便用于测试和挖掘真实世界的Web应用程序</p>
<h4 id="4-1-环境安装">4.1 环境安装</h4>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install </span><span class="keyword">jsdom </span>--save</span><br></pre></td></tr></table></figure>
<h4 id="4-2-基本使用">4.2 基本使用</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsdom = <span class="built_in">require</span>(<span class="string">&quot;jsdom&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">JSDOM</span> &#125; = jsdom;</span><br><span class="line"><span class="keyword">const</span> dom = <span class="keyword">new</span> <span class="title function_">JSDOM</span>(<span class="string">`&lt;!DOCTYPE html&gt;&lt;p&gt;Hello world&lt;/p&gt;`</span>);</span><br><span class="line">title = dom.<span class="property">window</span>.<span class="property">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;p&quot;</span>).<span class="property">textContent</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(title)</span><br></pre></td></tr></table></figure>
<h4 id="4-3-添加参数形式">4.3 添加参数形式</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dom = <span class="keyword">new</span> <span class="title function_">JSDOM</span>(<span class="string">``</span>, &#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;http://q.10jqka.com.cn/&quot;</span>,</span><br><span class="line">  <span class="attr">referrer</span>: <span class="string">&quot;http://q.10jqka.com.cn/&quot;</span>,</span><br><span class="line">  <span class="attr">contentType</span>: <span class="string">&quot;text/html&quot;</span>,</span><br><span class="line">  <span class="attr">includeNodeLocations</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">storageQuota</span>: <span class="number">10000000</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="COOkIE反爬虫">COOkIE反爬虫</h2>
<h3 id="1-cookie反爬简介">1 cookie反爬简介</h3>
<p>Cookie 反爬虫指的是服务器端通过校验请求头中的 Cookie 值来区分正常用户和爬虫程序的手段，这种手段被广泛应用在 Web 应用中。</p>
<h4 id="1-1-cookie加密原理">1.1 cookie加密原理</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031693.png" alt="image-20220824165530043"></p>
<h3 id="2-cookie逆向实践1">2 cookie逆向实践1</h3>
<ul>
<li>学习响应cookie和session的处理</li>
<li>学习基于首页返回的cookie值</li>
</ul>
<h4 id="2-1-逆向目标-4">2.1 逆向目标</h4>
<ul>
<li>
<p>地址：<a target="_blank" rel="noopener" href="http://www.zjmazhang.gov.cn/hdjlpt/published?via=pc">http://www.zjmazhang.gov.cn/hdjlpt/published?via=pc</a></p>
</li>
<li>
<p>接口：<a target="_blank" rel="noopener" href="http://www.zjmazhang.gov.cn/hdjlpt/letter/pubList">http://www.zjmazhang.gov.cn/hdjlpt/letter/pubList</a></p>
</li>
<li>
<p>对抗：<code>cookie</code>反爬虫处理</p>
</li>
</ul>
<h4 id="2-2-逆向分析-3">2.2 逆向分析</h4>
<ul>
<li>
<p>可以发现抓取接口数据，需要携带对应的cookie才能正常获取</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282028839.png" alt="image-20220823170811179"></p>
</li>
</ul>
<h4 id="2-3-逆向结果">2.3 逆向结果</h4>
<ul>
<li>使用python先提取cookie，然后携带请求可以正常突破</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> ua</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_ck</span>():</span><br><span class="line">    url = <span class="string">&#x27;http://www.zjmazhang.gov.cn/hdjlpt/published?via=pc&#x27;</span></span><br><span class="line">    res = httpx.request(<span class="string">&#x27;GET&#x27;</span>,url)</span><br><span class="line">    cookie = res.cookies.get(<span class="string">&#x27;szxx_session&#x27;</span>)</span><br><span class="line">    token = re.findall(<span class="string">r&quot;var _CSRF = &#x27;(.*?)&#x27;;&quot;</span>,res.text)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> cookie,token</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    c, t = get_ck()</span><br><span class="line">    url = <span class="string">&#x27;http://www.zjmazhang.gov.cn/hdjlpt/letter/pubList&#x27;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;user-agent&#x27;</span>: ua.FakeChromeUA.get_ua(),</span><br><span class="line">        <span class="string">&#x27;X-CSRF-TOKEN&#x27;</span>: t,</span><br><span class="line">        <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;XSRF-TOKEN=&#123;&#125;;szxx_session=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(t, c)</span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;offset&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;limit&quot;</span>: <span class="string">&quot;20&quot;</span>,</span><br><span class="line">        <span class="string">&quot;site_id&quot;</span>: <span class="string">&quot;759010&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    res = httpx.post(url,data=data,headers=headers)</span><br><span class="line">    <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(res.text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;请求错误&#x27;</span>)</span><br><span class="line"></span><br><span class="line">index()</span><br></pre></td></tr></table></figure>
<h3 id="3-cookie逆向实战">3. cookie逆向实战</h3>
<ul>
<li>学习JS设置的cookie处理</li>
<li>学习轻度JS混淆处理</li>
</ul>
<h4 id="3-1-逆向目标-2">3.1 逆向目标</h4>
<ul>
<li>首页：<a target="_blank" rel="noopener" href="https://sh.esfxiaoqu.zhuge.com/page2/">https://sh.esfxiaoqu.zhuge.com/page2/</a></li>
<li>目标：cookie：<code>acw_sc__v2</code></li>
</ul>
<h4 id="3-2-逆向分析-2">3.2 逆向分析</h4>
<p>直接用代码带上参数请求这个接口，发现并没有给我们数据，而是给了一段js。但是这个js可以明显的看到，set了一个cookie，<code>acw_sc__v2</code>，接下来就简单了，直接分析这段js就好了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282028071.png" alt="图片"></p>
<h5 id="3-2-2-JS-调试分析">3.2.2 JS 调试分析</h5>
<ul>
<li>在浏览器里面给<code>arg2</code>下个断点观察对应参数</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031695.png" alt="image-20220824162743929"></p>
<ul>
<li>找出对应的核心代码，方便后续的调试</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282028847.png" alt="image-20220824162627614"></p>
<ul>
<li>老规矩，还原对应的参数和逻辑</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031696.png" alt="image-20220824162919831"></p>
<h4 id="3-3-逆向结果">3.3 逆向结果</h4>
<h5 id="3-3-1-Js还原">3.3.1 Js还原</h5>
<ul>
<li>
<p>详细代码见百度网盘地址</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">链接：https://pan.baidu.com/s/1u9eAfCp0FvLSOKA8YuWntw </span><br><span class="line">提取码：8pbx</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="3-3-2-python还原">3.3.2 python还原</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://sh.esfxiaoqu.zhuge.com/&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate, br&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;sh.esfxiaoqu.zhuge.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Pragma&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sec-ch-ua&quot;</span>: <span class="string">&quot;\&quot;Chromium\&quot;;v=\&quot;104\&quot;, \&quot; Not A;Brand\&quot;;v=\&quot;99\&quot;, \&quot;Google Chrome\&quot;;v=\&quot;104\&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sec-ch-ua-mobile&quot;</span>: <span class="string">&quot;?0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sec-ch-ua-platform&quot;</span>: <span class="string">&quot;\&quot;Windows\&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Sec-Fetch-Dest&quot;</span>: <span class="string">&quot;document&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Sec-Fetch-Mode&quot;</span>: <span class="string">&quot;navigate&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Sec-Fetch-Site&quot;</span>: <span class="string">&quot;same-origin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Sec-Fetch-User&quot;</span>: <span class="string">&quot;?1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_complete_cookie</span>():</span><br><span class="line">    complete_cookie = &#123;&#125;</span><br><span class="line">    <span class="comment"># 第一次不带参数访问首页，获取 acw_tc 和 acw_sc__v2</span></span><br><span class="line">    response = requests.get(url=url, headers=headers)</span><br><span class="line">    complete_cookie.update(response.cookies.get_dict())</span><br><span class="line">    arg1 = re.findall(<span class="string">&quot;arg1=&#x27;(.*?)&#x27;&quot;</span>, response.text)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;tiaoshi.js&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        acw_sc_v2_js = f.read()</span><br><span class="line">    acw_sc__v2 = execjs.<span class="built_in">compile</span>(acw_sc_v2_js).call(<span class="string">&#x27;xl&#x27;</span>, arg1)</span><br><span class="line">    complete_cookie.update(&#123;<span class="string">&quot;acw_sc__v2&quot;</span>: acw_sc__v2&#125;)</span><br><span class="line">    <span class="comment"># 第二次访问首页，获取其他 cookies</span></span><br><span class="line">    response2 = requests.get(url=url, headers=headers, cookies=complete_cookie)</span><br><span class="line">    complete_cookie.update(response2.cookies.get_dict())</span><br><span class="line">    <span class="keyword">return</span> complete_cookie</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    complete_cookie = get_complete_cookie()</span><br></pre></td></tr></table></figure>
<h3 id="4-工具使用">4 工具使用</h3>
<p>使用一键ob还原工具，对代码进行处理</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">链接：https:<span class="regexp">//</span>pan.baidu.com<span class="regexp">/s/</span><span class="number">1</span>DXjOx_1B4CuzFFTwfB7Q-A </span><br><span class="line">提取码：<span class="number">1234</span></span><br></pre></td></tr></table></figure>
<ul>
<li>input文件夹，  存放ob混淆代码;</li>
<li>output文件夹，存放还原后的代码;</li>
<li>tools,存放打包的babel库以及部分还原的AST插件;</li>
<li>main.js  运行主文件;</li>
</ul>
<p><strong>使用方式：</strong></p>
<p>切换到 decodeObfuscator-main 目录，命令行模式下运行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node main.<span class="property">js</span></span><br></pre></td></tr></table></figure>
<h2 id="滑块验证码">滑块验证码</h2>
<h3 id="1-滑块简介">1. 滑块简介</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:/Users/XL/AppData/Roaming/Typora/typora-user-images/image-20220830221204749.png" alt="image-20220830221204749"></p>
<p>**注：**重点是识别滑块缺口，测出需要拖动的距离</p>
<h4 id="1-1-核心步骤">1.1 <strong>核心步骤</strong></h4>
<ol>
<li>
<p>从服务器随机取一张图片，并对图片上的随机<code>x,y</code>坐标和宽高一块区域抠图；</p>
</li>
<li>
<p>根据步骤一的坐标和宽高，使用二维数组保存原图上抠图区域的像素点坐标；</p>
</li>
<li>
<p>根据步骤二的坐标点，对原图的抠图区域的颜色进行处理。</p>
</li>
<li>
<p>完成以上步骤之后得到两张图(扣下来的方块图，带有抠图区域阴影的原图),将这两张图和抠图区域的y坐标传到前台，前端在移动方块验证时，将移动后的x坐标传递到后台与原来的x坐标作比较，如果在阈值内则验证通过。</p>
</li>
<li>
<p>请求验证的步骤：前台向后台发起请求，后台随机一张图片做处理将处理完的两张图片的<code>base64</code>，抠图y坐标和<code>token</code>(token为后台缓存验证码的唯一<code>token</code>,可以用缓存和分布式缓存)返回给前台。</p>
</li>
<li>
<p>前台滑动图片将<code>x</code>坐标和<code>token</code>作为参数请求后台验证，服务器根据<code>token</code>取出<code>x</code>坐标与参数的x进行比较。</p>
</li>
</ol>
<h4 id="1-2-突破规则">1.2 突破规则</h4>
<p>这类验证码可以使用 <code>selenium</code> 操作浏览器拖拽滑块来进行破解，难点两个，一个如何确定拖拽到的位置，另一个是避开人机识别（反爬虫）。</p>
<p>首先我们先看看，<strong>确定滑块验证码需要拖拽的位移距离</strong></p>
<p>有三种方式</p>
<ul>
<li>人工智能机器学习，确定滑块位置</li>
<li>通过完整图片与缺失滑块的图片进行像素对比，确定滑块位置</li>
<li>边缘检测算法，确定位置</li>
</ul>
<p>各有优缺点。人工智能机器学习，确定滑块位置，需要进行训练比较麻烦，所以我们主要看后面两种。</p>
<p><strong>对比完整图片与缺失滑块的图片</strong></p>
<h4 id="1-3-验证码图片处理">1.3 验证码图片处理</h4>
<ul>
<li>
<p>站点:<a target="_blank" rel="noopener" href="https://www.geetest.com/demo/">https://www.geetest.com/demo/</a></p>
</li>
<li>
<p>使用浏览器技术提取滑块图片，进行处理</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提取背景图</span></span><br><span class="line">document.getElementsByClassName(<span class="string">&#x27;geetest_canvas_bg geetest_absolute&#x27;</span>)[<span class="number">0</span>].toDataURL(<span class="string">&#x27;image/png&#x27;</span>)</span><br><span class="line">document.getElementsByClassName(<span class="string">&#x27;geetest_canvas_fullbg geetest_fade geetest_absolute&#x27;</span>)[<span class="number">0</span>].toDataURL(<span class="string">&#x27;image/png&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存图片</span></span><br><span class="line"><span class="keyword">import</span> base64,io</span><br><span class="line">images = q_qt.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">images = base64.b64decode(images)</span><br><span class="line">images = Image.<span class="built_in">open</span>(io.BytesIO(images))</span><br><span class="line">images.save(<span class="string">&#x27;q_qg.png&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="1-4-背景滑块识别">1.4 背景滑块识别</h4>
<ul>
<li>这里使用开源的技术<code>ddddocr</code>进行滑块的识别</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ddddocr</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text_dis</span>():</span><br><span class="line">    slide = ddddocr.DdddOcr(det=<span class="literal">False</span>, ocr=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;bg.png&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        target_bytes = f.read()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;zg.png&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        background_bytes = f.read()</span><br><span class="line">    res = slide.slide_comparison(target_bytes, background_bytes)</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>
<h3 id="2-极验滑块实战">2  极验滑块实战</h3>
<ul>
<li>使用自动化过滑块</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">链接：https://pan.baidu.com/s/1zR2fIvO2iyC3esraWWYIvw </span><br><span class="line">提取码：<span class="number">1234</span></span><br></pre></td></tr></table></figure>
<h3 id="3-手撕滑块">3 手撕滑块</h3>
<h3 id="1、底图还原">1、底图还原</h3>
<p>下 断点，可以分析底图还原逻辑</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:/Users/XL/AppData/Roaming/Typora/typora-user-images/image-20221219145010615.png" alt="image-20221219145010615"></p>
<h3 id="2、跟W值">2、跟W值</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Str</span>_Unicode=<span class="keyword">function</span>(<span class="params">str</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> unid=<span class="string">&#x27;\\u00&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>,len=str.<span class="property">length</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;len-<span class="number">1</span>)&#123;</span><br><span class="line">            unid+=str.<span class="title function_">charCodeAt</span>(i).<span class="title function_">toString</span>(<span class="number">16</span>)+<span class="string">&#x27;\\u00&#x27;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i===len-<span class="number">1</span>)&#123;</span><br><span class="line">            unid+=str.<span class="title function_">charCodeAt</span>(i).<span class="title function_">toString</span>(<span class="number">16</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> unid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>JS</code>里面是被编码的，可以把W值编码，进行查找，在<code>JS</code>里面搜索<code>u0077&quot;:</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> u = r[$_CAHJR(<span class="number">706</span>)]()</span><br><span class="line">, l = V[$_CAIAZ(<span class="number">339</span>)](pt[$_CAHJR(<span class="number">278</span>)](o), r[$_CAHJR(<span class="number">721</span>)]())</span><br><span class="line">, h = m[$_CAIAZ(<span class="number">769</span>)](l)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;w&quot;</span> =  h + u</span><br></pre></td></tr></table></figure>
<p>这里边的<code>W</code>值为 <code>h+u</code>， 可以按照逻辑挨个处理</p>
<h4 id="2-1-分析U生成">2.1 分析U生成</h4>
<h5 id="2-1-1-处理明文">2.1.1 处理明文</h5>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031697.png" alt="image-20221025164115542"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">65536</span> * (<span class="number">1</span> + <span class="title class_">Math</span>[$_BFBFy(<span class="number">14</span>)]()) | <span class="number">0</span>)[$_BFBFy(<span class="number">287</span>)](<span class="number">16</span>)[$_BFBEu(<span class="number">489</span>)](<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>对明文进行改写</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ne = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">t</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ((<span class="number">1</span> + <span class="title class_">Math</span>[<span class="string">&quot;random&quot;</span>]()) * <span class="number">65536</span> | <span class="number">0</span>)[<span class="string">&quot;toString&quot;</span>](<span class="number">16</span>)[<span class="string">&quot;substring&quot;</span>](<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">t</span>() + <span class="title function_">t</span>() + <span class="title function_">t</span>() + <span class="title function_">t</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<h5 id="2-1-2-处理加密方法">2.1.2 处理加密方法</h5>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031933.png" alt="image-20221025171051774"></p>
<p>1、 全局扣代码形式</p>
<ul>
<li>复制所有的<code>JS</code>代码，然后使用<code>xl</code>导出全局<code>U</code>方法</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title function_">U</span>()[$_CBGAZ(<span class="number">353</span>)](<span class="variable language_">this</span>[$_CBFJo(<span class="number">756</span>)](t))</span><br><span class="line"><span class="keyword">new</span> <span class="variable language_">window</span>.<span class="title function_">xl</span>()[<span class="string">&#x27;encrypt&#x27;</span>](<span class="string">&quot;293844e47865d090&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031932.png" alt="image-20221025193715106"></p>
<h4 id="2-2-分析l值">2.2 分析<code>l</code>值</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">l = V[$_CAIAZ(<span class="number">339</span>)](pt[$_CAHJR(<span class="number">278</span>)](o), r[$_CAHJR(<span class="number">721</span>)]())</span><br></pre></td></tr></table></figure>
<p><strong>经过替换后</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">l =   V[<span class="string">&#x27;encrypt&#x27;</span>](pt[<span class="string">&#x27;stringify&#x27;</span>](o), <span class="title function_">ne</span>())</span><br></pre></td></tr></table></figure>
<p><code>pt</code>蛮猜是一个<code>json</code>对象，因为需要把<code>JavaScript</code>对象转成<code>json</code>字符串。需要处理的是<code>o</code>值</p>
<h5 id="2-2-1-处理o值">2.2.1 处理o值</h5>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031937.png" alt="image-20221025201028843"></p>
<p>经过2次比对，发现有几个值在变动</p>
<h6 id="1、先处理aa的值"><strong>1、先处理aa的值</strong></h6>
<ul>
<li>发现在最上边设置的、跳第2个栈、查看第2个参数</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031698.png" alt="image-20221025202751422"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">l =  n[<span class="string">&#x27;$_CICe&#x27;</span>][<span class="string">&#x27;$_BBES&#x27;</span>](n[<span class="string">&#x27;$_CICe&#x27;</span>][<span class="string">&#x27;$_GFJ&#x27;</span>](), n[<span class="string">&#x27;$_CJT&#x27;</span>][<span class="string">&#x27;c&#x27;</span>], n[<span class="string">&#x27;$_CJT&#x27;</span>][<span class="string">&#x27;s&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p>发现 <code>n['$_CICe']['$_BBES']</code>是方法，需要传递3个参数</p>
<ul>
<li><code>'g!).-,-(!!U(tsyyt(yyt()s)yvvs(!!(K92011120202019219$/*'</code></li>
<li><code>[12, 58, 98, 36, 43, 95, 62, 15, 12]</code></li>
<li><code>2a796138</code></li>
</ul>
<p>注：查看<code>n['$_CJT']</code>可以得出后2个值是图片接口获取的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031945.png" alt="image-20221025203736767"></p>
<p>跟栈查看第一个值得结果</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031763.png" alt="image-20221025210626852"></p>
<p>注：这里面是对轨迹进行加密，可以使用全局导出加密轨迹</p>
<p>往上跟堆栈，修改参数导出，然后全局调用</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031225.png" alt="image-20221026125933400"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031699.png" alt="image-20221026125943955"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">get_ps</span> = W[$_CJEZ(<span class="number">251</span>)][<span class="string">&quot;\u0024\u005f\u0047\u0046\u004a&quot;</span>]</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031700.png" alt="image-20221026130014756"></p>
<h6 id="2、处理其他值">2、处理其他值</h6>
<p>参数在这里生成的，可以调试结果</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:/Users/XL/AppData/Roaming/Typora/typora-user-images/image-20221027174708000.png" alt="image-20221027174708000"></p>
<h6 id="4、处理L值">4、处理L值</h6>
<p>该值需要传入2个参数进行加密，生成一个大数组，第一个参数是轨迹信息，第2个参数是随机得值，加密完成返回数组。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031885.png" alt="image-20221026144528623"></p>
<p>可以直接使用全局导出<code>V</code>方法，然后直接传值即可，导出得地点在V函数外边，然后调用<code>'encrypt'</code>这个方法。结果如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031916.png" alt="image-20221026145421348"></p>
<h4 id="2-3-分析h值">2.3 分析<code>h</code>值</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">h = m[$_CAIAZ(<span class="number">769</span>)](l)</span><br></pre></td></tr></table></figure>
<p>导出这个方法</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031701.png" alt="image-20221026152730305"></p>
<p>在函数外部进行导出</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031549.png" alt="image-20221026152814459"></p>
<p>方法调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">get_h</span>(<span class="params"></span>)&#123;</span><br><span class="line">    h = <span class="variable language_">window</span>.<span class="property">h</span>[<span class="string">&quot;\u0024\u005f\u0047\u0047\u0063&quot;</span>](<span class="title function_">get_ls</span>())</span><br><span class="line">    <span class="keyword">return</span> h</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>W值得最终结果</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031548.png" alt="image-20221026152938866"></p>
<h2 id="文本混淆章节">文本混淆章节</h2>
<h3 id="1-文本混淆简介">1.  文本混淆简介</h3>
<p>简单而言就是利用前端技术干扰，页面可以正常展示，而使用爬虫下载后无法提取正常的数据。</p>
<h4 id="1-1-常见的干扰方式">1.1 常见的干扰方式</h4>
<ul>
<li>字体反爬</li>
</ul>
<h3 id="2-字体反爬">2. 字体反爬</h3>
<h4 id="2-1-字体反爬简介">2.1 字体反爬简介</h4>
<p>​		在 <code>CSS3 </code>之前，<code>Web</code> 开发者必须使用用户计算机上已有的字体。目前的技术开发者可以使用<code>@font-face</code>为网页指定字体，开发者可将心仪的字体文件放在 Web 服务器上，并在<code> CSS</code> 样式中使用它。用户使用浏览器访问 <code>Web应用</code>时，对应的字体会被浏览器下载到用户的计算机上。</p>
<p>**注：**使用自动化<code>selenium</code>也无法获取正常的数据</p>
<h3 id="3-某习字体反爬实践">3.  某习字体反爬实践</h3>
<h4 id="3-1-逆向目标-3">3.1 逆向目标</h4>
<ul>
<li>首页：<a target="_blank" rel="noopener" href="https://www.shixiseng.com/">https://www.shixiseng.com/</a></li>
<li>目标：<a target="_blank" rel="noopener" href="https://www.shixiseng.com/interns?keyword=%E4%BA%A7%E5%93%81&amp;city=%E5%85%A8%E5%9B%BD&amp;type=intern&amp;from=menu">https://www.shixiseng.com/interns?keyword=产品&amp;city=全国&amp;type=intern&amp;from=menu</a></li>
<li>逆向：薪酬字体</li>
</ul>
<h4 id="3-2-逆向分析-3">3.2 逆向分析</h4>
<h5 id="3-2-1-网页分析">3.2.1 网页分析</h5>
<ul>
<li>打开网站可以发现，价格的字体是乱码</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031702.png" alt="image-20220830135453763"></p>
<h5 id="3-2-2-页面处理">3.2.2 页面处理</h5>
<ul>
<li>在页面源代码中搜索<code>font-face</code>关键字，可以发现字体文件在网页源代码中</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031703.png" alt="image-20220830140449959"></p>
<ul>
<li>
<p>可以在网络抓包里面进行筛选，可以发现这里面有对应的字体文件加载地址，由后端返回</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031873.png" alt="image-20220830140631194"></p>
</li>
<li>
<p>对于字体文件，可以直接使用工具解析</p>
<ul>
<li>在线地址：<a target="_blank" rel="noopener" href="http://font.qqe2.com/">http://font.qqe2.com/</a>
<ul>
<li>使用方式:
<ul>
<li>下载字体文件到本地目录</li>
<li>访问在线工具网站，点击左上角打开，找到本地目录字体文件即可</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031874.png" alt="image-20220830141035825"></p>
<h5 id="3-3-3-字体分析">3.3.3 字体分析</h5>
<p>正常在网页里面展示的薪酬是：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031704.png" alt="image-20220830141940433"></p>
<ul>
<li>下载后的页面元素</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031881.png" alt="image-20220830141754024"></p>
<ul>
<li>
<p>解析的字体文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031705.png" alt="image-20220830141835755"></p>
</li>
<li>
<p><code>woff</code>文件转化成<code>xml</code>文件进行分析 <code>cmap</code>是关键 原来是<code>unicode</code>码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031811.png" alt="image-20220830153625467"></p>
</li>
</ul>
<h4 id="3-3-逆向结果-2">3.3 逆向结果</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031706.png" alt="image-20220830153726609"></p>
<h5 id="3-3-1-完整code">3.3.1 完整code</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Sxs</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.96 Safari/537.36&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_html</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 第1步：获取html，且存为html文件以便后面研究使用</span></span><br><span class="line">        url = <span class="string">&#x27;https://www.shixiseng.com/interns?keyword=%E4%BA%A7%E5%93%81&amp;city=%E5%85%A8%E5%9B%BD&amp;type=intern&amp;from=menu&#x27;</span></span><br><span class="line">        ret = requests.get(url=url, headers=<span class="variable language_">self</span>.headers).text</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;index.html&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(ret)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_font</span>(<span class="params">self,ret</span>):</span><br><span class="line">        <span class="comment"># 第2步：下载html配套的ttf文件</span></span><br><span class="line">        font_url = re.findall(<span class="string">&#x27;src: url\((.*?)\);&#x27;</span>, ret)</span><br><span class="line">        f_url = <span class="string">&#x27;https://www.shixiseng.com&#x27;</span> + font_url[<span class="number">0</span>] <span class="keyword">if</span> font_url <span class="keyword">else</span> font_url</span><br><span class="line">        font_data = requests.get(f_url)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;file.woff&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(font_data.content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_font_data</span>(<span class="params">self,ttf</span>):</span><br><span class="line">        font_dict = &#123;&#125;</span><br><span class="line">        <span class="comment"># font = TTFont(&quot;file.woff&quot;)</span></span><br><span class="line">        font = TTFont(ttf)</span><br><span class="line">        cmap = font.get(<span class="string">&quot;cmap&quot;</span>).getBestCmap()</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> cmap.items():</span><br><span class="line">            <span class="keyword">if</span> v[<span class="number">3</span>:]:</span><br><span class="line">                content = <span class="string">&quot;\\u00&quot;</span> + v[<span class="number">3</span>:] <span class="keyword">if</span> <span class="built_in">len</span>(v[<span class="number">3</span>:]) == <span class="number">2</span> <span class="keyword">else</span> <span class="string">&quot;\\u&quot;</span> + v[<span class="number">3</span>:]</span><br><span class="line">                real_content = content.encode(<span class="string">&#x27;utf-8&#x27;</span>).decode(<span class="string">&#x27;unicode_escape&#x27;</span>)</span><br><span class="line">                k_hex = <span class="built_in">hex</span>(k)</span><br><span class="line">                <span class="comment"># 网页返回的字体是以&amp;#x开头  ，换成以这个开头，下面代码就是直接替换</span></span><br><span class="line">                real_k = k_hex.replace(<span class="string">&quot;0x&quot;</span>, <span class="string">&quot;&amp;#x&quot;</span>)</span><br><span class="line">                font_dict[real_k] = real_content</span><br><span class="line">        <span class="keyword">return</span> font_dict</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put_html</span>(<span class="params">self,ttf_dict</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;index.html&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            html = f.read()</span><br><span class="line">            <span class="keyword">for</span> k, v <span class="keyword">in</span> ttf_dict.items():</span><br><span class="line">                html = html.replace(k, v)</span><br><span class="line">            <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_data</span>(<span class="params">self,html</span>):</span><br><span class="line">        html = etree.HTML(html)</span><br><span class="line">        li_list = html.xpath(<span class="string">&quot;//div[@class=&#x27;intern-wrap intern-item&#x27;]&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">            title = <span class="string">&quot;&quot;</span>.join(li.xpath(<span class="string">&quot;.//div[@class=&#x27;f-l intern-detail__job&#x27;]//a/text()&quot;</span>)[<span class="number">0</span>].split())</span><br><span class="line">            price = <span class="string">&quot;&quot;</span>.join( li.xpath(<span class="string">&quot;.//div[@class=&#x27;f-l intern-detail__job&#x27;]//span[@class=&#x27;day font&#x27;]/text()&quot;</span>)[<span class="number">0</span>].split())</span><br><span class="line">            name = li.xpath(<span class="string">&#x27;.//a[@class=&quot;title ellipsis&quot;]/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="built_in">print</span>(title, price,name)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 第1步：获取html，且存为html文件以便后面研究使用</span></span><br><span class="line">        ret = <span class="variable language_">self</span>.get_html()</span><br><span class="line">        <span class="comment"># 第2步：下载html配套的ttf文件</span></span><br><span class="line">        <span class="variable language_">self</span>.get_font(ret)</span><br><span class="line">        <span class="comment"># 第3步：提取ttf中摄影的数据</span></span><br><span class="line">        font_dict = <span class="variable language_">self</span>.get_font_data(<span class="string">&#x27;file.woff&#x27;</span>)</span><br><span class="line">        <span class="comment"># 第4步：对下载（HTML内容）进行替换</span></span><br><span class="line">        html = <span class="variable language_">self</span>.put_html(font_dict)</span><br><span class="line">        <span class="comment"># 第5步：使用xpath提取想要的数据</span></span><br><span class="line">        data = <span class="variable language_">self</span>.get_data(html)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    Sxs().main()</span><br></pre></td></tr></table></figure>
<h3 id="4-字体解析工具">4. 字体解析工具</h3>
<p><strong>字体读取工具</strong></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">链接：https:<span class="regexp">//</span>pan.baidu.com<span class="regexp">/s/</span><span class="number">1</span>c57IHzTN0aPVgIO5NMq3OA </span><br><span class="line">提取码：<span class="number">1234</span></span><br></pre></td></tr></table></figure>
<p><strong>4.1 工具安装</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span> fontTools  <span class="comment"># 使用这个包处理字体文件</span></span><br></pre></td></tr></table></figure>
<h4 id="4-2-字体读取">4.2 字体读取</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fontTools.ttLib <span class="keyword">import</span> TTFont</span><br><span class="line"><span class="comment"># 加载字体文件：</span></span><br><span class="line">font = TTFont(<span class="string">&#x27;file.woff&#x27;</span>)</span><br><span class="line"><span class="comment"># 转为xml文件：</span></span><br><span class="line">font.saveXML(<span class="string">&#x27;file.xml&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="4-3-节点读取">4.3 节点读取</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fontTools.ttLib <span class="keyword">import</span> TTFont</span><br><span class="line"><span class="comment"># 加载字体文件：</span></span><br><span class="line">font = TTFont(<span class="string">&#x27;file.woff&#x27;</span>)</span><br><span class="line">kv = font.keys()</span><br><span class="line"><span class="built_in">print</span>(kv)</span><br></pre></td></tr></table></figure>
<p>字体文件不仅包含字形数据和点信息，还包括字符到字形映射、字体标题、命名和水平指标等，这些信息存在对应的表中：</p>
<table>
<thead>
<tr>
<th>表</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>cmap</td>
<td>字符到字形映射</td>
</tr>
<tr>
<td>glyf</td>
<td>字形数据</td>
</tr>
<tr>
<td>head</td>
<td>字体标题</td>
</tr>
<tr>
<td>hhea</td>
<td>水平标题</td>
</tr>
<tr>
<td>hmtx</td>
<td>水平指标</td>
</tr>
<tr>
<td>loca</td>
<td>索引到位置</td>
</tr>
<tr>
<td>maxp</td>
<td>最大限度的</td>
</tr>
<tr>
<td>name</td>
<td>命名</td>
</tr>
<tr>
<td>post</td>
<td>后记</td>
</tr>
</tbody>
</table>
<h4 id="4-4-获取请求到的字体code和name的对应关系">4.4 获取请求到的字体code和name的对应关系</h4>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">code_name_map</span> = font_aa.getBestCmap()</span><br></pre></td></tr></table></figure>
<h4 id="4-5-获取字体坐标信息">4.5 获取字体坐标信息</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">font_aa = TTFont(<span class="string">&#x27;file.woff&#x27;</span>)</span><br><span class="line"><span class="comment"># 获取请求到的字体形状</span></span><br><span class="line">glyf = font_aa[<span class="string">&#x27;glyf&#x27;</span>]</span><br><span class="line"><span class="comment">#font[&#x27;glyf&#x27;][字体编码].coordinates</span></span><br><span class="line">font_aa[<span class="string">&#x27;glyf&#x27;</span>][<span class="string">&#x27;uni4E94&#x27;</span>].coordinates</span><br></pre></td></tr></table></figure>
<h3 id="5-某车字体反爬">5. 某车字体反爬</h3>
<h4 id="5-1-逆向目标">5.1 逆向目标</h4>
<ul>
<li>首页：<a target="_blank" rel="noopener" href="https://www.renrenche.com/">https://www.renrenche.com/</a></li>
<li>目标：<a target="_blank" rel="noopener" href="https://www.renrenche.com/bj/ershouche/p2/?&amp;plog_id=838083390d4b077a45852d11065f60ad">https://www.renrenche.com/bj/ershouche/p2/?&amp;plog_id=838083390d4b077a45852d11065f60ad</a></li>
<li>逆向：标题字体</li>
</ul>
<h4 id="5-2-逆向分析">5.2 逆向分析</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031707.png" alt="image-20220830164839285"></p>
<ul>
<li>
<p>打开网页源代码搜索<code>font-face</code>,查找字体文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031708.png" alt="image-20220830165032274"></p>
</li>
<li>
<p>分析字形关系</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282031520.png" alt="image-20220830165555789"></p>
</li>
</ul>
<h5 id="5-2-1-原字形还原">5.2.1 原字形还原</h5>
<p>请求字体链接，获取字体code和name的对应关系，然后遍历，获取网页中反爬文字的真实文字。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">relation_table = &#123;<span class="string">&quot;zero&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;one&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;two&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;three&quot;</span>: <span class="string">&quot;3&quot;</span>, <span class="string">&quot;four&quot;</span>: <span class="string">&quot;4&quot;</span>, <span class="string">&quot;five&quot;</span>: <span class="string">&quot;5&quot;</span>, <span class="string">&quot;seven&quot;</span>: <span class="string">&quot;6&quot;</span>,<span class="string">&quot;eight&quot;</span>: <span class="string">&quot;7&quot;</span>, <span class="string">&quot;six&quot;</span>: <span class="string">&quot;8&quot;</span>, <span class="string">&quot;nine&quot;</span>: <span class="string">&quot;9&quot;</span>&#125;</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">woff_font</span>(<span class="params">font_url</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取字体真实对应关系&#x27;&#x27;&#x27;</span></span><br><span class="line">    newmap = &#123;&#125;</span><br><span class="line">    resp = session.get(font_url)  <span class="comment"># 请求字体链接</span></span><br><span class="line">    woff_data = BytesIO(resp.content)</span><br><span class="line">    font = TTFont(woff_data)  <span class="comment"># 读取woff数据</span></span><br><span class="line">    cmap = font.getBestCmap()  <span class="comment"># 获取字体对应关系</span></span><br><span class="line">    font.close()</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> cmap.items():</span><br><span class="line">        value = v</span><br><span class="line">        key = <span class="built_in">str</span>(k - <span class="number">48</span>)  <span class="comment"># 获取真实的key</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            get_real_data = relation_table[value]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            get_real_data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> get_real_data != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            newmap[key] = get_real_data  <span class="comment"># 将字体真实结果对应</span></span><br><span class="line">    <span class="keyword">return</span> newmap</span><br></pre></td></tr></table></figure>
<h4 id="5-3-逆向代码">5.3 逆向代码</h4>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">链接：https:<span class="regexp">//</span>pan.baidu.com<span class="regexp">/s/</span><span class="number">1</span>uhqLb7pVkRjgHlwwMxEJVA </span><br><span class="line">提取码：<span class="number">1234</span></span><br></pre></td></tr></table></figure>
<h2 id="Scrapy采集框架"><code>Scrapy</code>采集框架</h2>
<h2 id="1-学习目标">1 学习目标</h2>
<p>1、框架流程和结构设计原理</p>
<p>2、框架爬虫程序编写</p>
<p>3、框架日志模块使用</p>
<p>4、框架请求发送流程</p>
<h2 id="2-scrapy简介">2 <code>scrapy</code>简介</h2>
<p>​		<code>Scrapy</code>是用纯<code>Python</code>实现一个为了爬取网站数据、提取结构性数据而编写的应用框架，用途非常广泛，用户只需要定制开发几个模块就可以轻松的实现一个爬虫，用来抓取网页内容以及各种图片，非常之方便。</p>
<h3 id="2-0-单个爬虫编写">2.0 单个爬虫编写</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Spider</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 负责全局配置</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">url_list</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 负责任务池维护</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 负责网络请求模块</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 负责解析数据模块</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 负责数据存储</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 负责模块调度</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="2-1-架构介绍">2.1 架构介绍</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282033187.png" alt=""></p>
<h4 id="2-2-1-名词解析">2.2.1 名词解析</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282033196.png" alt="在这里插入图片描述"></p>
<h4 id="2-2-2-运行逻辑图">2.2.2 运行逻辑图</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282033631.png" alt="image-20220908143553410"></p>
<h2 id="3-框架使用">3 框架使用</h2>
<h3 id="3-1-项目搭建">3.1 项目搭建</h3>
<h4 id="3-1-1-框架安装">3.1.1 框架安装</h4>
<p>查找历史版本：<a target="_blank" rel="noopener" href="https://pypi.org/project/Scrapy/#history">https://pypi.org/project/Scrapy/#history</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install scrapy==<span class="number">2.3</span><span class="number">.0</span> -i 清华源</span><br></pre></td></tr></table></figure>
<h4 id="3-1-2-项目创建">3.1.2  项目创建</h4>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">scrapy 2.3.0 - no active project</span><br><span class="line"></span><br><span class="line">usage:</span><br><span class="line">  scrapy &lt;command&gt;[options] [args]</span><br><span class="line"></span><br><span class="line">Available commands :</span><br><span class="line">  bench      Run quick benchmark test #测试电脑性能</span><br><span class="line">  fetch      Fetch a URL using the scrapy down1oader#将源代码下载下来并显示出来</span><br><span class="line">  genspider      Generate new spider using pre-defined temp1ates#创建一个新的spider文件</span><br><span class="line">  runspider      Run a self-contained spider (without creating a project)# 这个和通过craw1启动爬虫不同，scrapy runspider爬虫文件名称</span><br><span class="line">  settings      Get settings values#获取当前的配置信息</span><br><span class="line">  she11      Interactive scraping console#进入scrapy 的交互模式</span><br><span class="line">  startproject      create new project#创建爬虫项目</span><br><span class="line">  version      Print scrapy version#显示scrapy框架的版本</span><br><span class="line">  view      open URL in browser，as seen by scrapy#将网页document内容下载下来，并且在浏览器显示出来</span><br></pre></td></tr></table></figure>
<p><strong>项目创建</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy startproject ps</span><br></pre></td></tr></table></figure>
<p><strong>文件介绍</strong></p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">- </span>scrapy.cfg：它是 Scrapy 项目的配置文件，其内定义了项目的配置文件路径、部署相关信息等内容。</span><br><span class="line"><span class="bullet">- </span>items.py：它定义 Item 数据结构，所有的 Item 的定义都可以放这里。</span><br><span class="line"><span class="bullet">- </span>pipelines.py：它定义 Item Pipeline 的实现，所有的 Item Pipeline 的实现都可以放这里。</span><br><span class="line"><span class="bullet">- </span>settings.py：它定义项目的全局配置。</span><br><span class="line"><span class="bullet">- </span>middlewares.py：它定义 Spider Middlewares 和 Downloader Middlewares 的实现。</span><br><span class="line"><span class="bullet">- </span>spiders：其内包含一个个 Spider 的实现，每个 Spider 都有一个文件。</span><br></pre></td></tr></table></figure>
<h2 id=""></h2>
<h4 id="3-1-3-创建爬虫">3.1.3 创建爬虫</h4>
<p>​		<code>Spider</code> 是自己定义的类，<code>Scrapy</code> 用它来从网页里抓取内容，并解析抓取的结果。不过这个类必须继承 <code>Scrapy</code> 提供的 <code>Spider</code> 类 <code>scrapy.Spider</code>，还要定义 <code>Spider</code> 的名称和起始请求，以及怎样处理爬取后的结果的方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd 项目路径</span><br><span class="line">scrapy genspider  爬虫名称  目标地址</span><br></pre></td></tr></table></figure>
<p><strong>配置文件简介</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Scrapy settings for ScrapyDemo project</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动生成的配置，无需关注，不用修改</span></span><br><span class="line">BOT_NAME = <span class="string">&#x27;ScrapyDemo&#x27;</span></span><br><span class="line">SPIDER_MODULES = [<span class="string">&#x27;ScrapyDemo.spiders&#x27;</span>]</span><br><span class="line">NEWSPIDER_MODULE = <span class="string">&#x27;ScrapyDemo.spiders&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置UA，但不常用，一般都是在MiddleWare中添加</span></span><br><span class="line">USER_AGENT = <span class="string">&#x27;ScrapyDemo (+http://www.yourdomain.com)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遵循robots.txt中的爬虫规则，很多人喜欢False，当然我也喜欢....</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对网站并发请求总数，默认16</span></span><br><span class="line">CONCURRENT_REQUESTS = <span class="number">32</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 相同网站两个请求之间的间隔时间，默认是0s。相当于time.sleep()</span></span><br><span class="line">DOWNLOAD_DELAY = <span class="number">3</span></span><br><span class="line"><span class="comment"># 下面两个配置二选一，但其值不能大于CONCURRENT_REQUESTS，默认启用PER_DOMAIN</span></span><br><span class="line"><span class="comment"># 对网站每个域名的最大并发请求，默认8</span></span><br><span class="line">CONCURRENT_REQUESTS_PER_DOMAIN = <span class="number">16</span></span><br><span class="line"><span class="comment"># 默认0，对网站每个IP的最大并发请求，会覆盖上面PER_DOMAIN配置，</span></span><br><span class="line"><span class="comment"># 同时DOWNLOAD_DELAY也成了相同IP两个请求间的间隔了</span></span><br><span class="line">CONCURRENT_REQUESTS_PER_IP = <span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用cookie，默认是True，启用</span></span><br><span class="line">COOKIES_ENABLED = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求头设置，这里基本上不用</span></span><br><span class="line">DEFAULT_REQUEST_HEADERS = &#123;</span><br><span class="line"><span class="comment">#   &#x27;Accept&#x27;: &#x27;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#x27;,</span></span><br><span class="line"><span class="comment">#   &#x27;Accept-Language&#x27;: &#x27;en&#x27;,</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置启用Spider MiddleWares，Key是class，Value是优先级</span></span><br><span class="line">SPIDER_MIDDLEWARES = &#123;</span><br><span class="line">    <span class="string">&#x27;ScrapyDemo.middlewares.ScrapydemoSpiderMiddleware&#x27;</span>: <span class="number">543</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置启用Downloader MiddleWares</span></span><br><span class="line"></span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">    <span class="string">&#x27;ScrapyDemo.middlewares.ScrapydemoDownloaderMiddleware&#x27;</span>: <span class="number">543</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置并启用扩展，主要是一些状态监控</span></span><br><span class="line">EXTENSIONS = &#123;</span><br><span class="line">    <span class="string">&#x27;scrapy.extensions.telnet.TelnetConsole&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置启用Pipeline用来持久化数据</span></span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   <span class="string">&#x27;ScrapyDemo.pipelines.ScrapydemoPipeline&#x27;</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-执行爬虫">3.2 执行爬虫</h3>
<h4 id="3-2-1-终端运行爬虫">3.2.1 终端运行爬虫</h4>
<ul>
<li>需要去到项目跟路径执行指令</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl xxxx</span><br></pre></td></tr></table></figure>
<h4 id="3-2-2-脚本运行">3.2.2 脚本运行</h4>
<ul>
<li>在<code>Scrapy</code>中有一个可以控制终端命令的模块<code>cmdline</code>。导入了这个模块，我们就能操控终端</li>
<li><code>execute</code>方法能执行终端的命令行</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> cmdline</span><br><span class="line"></span><br><span class="line">cmdline.execute(<span class="string">&quot;scrapy crawl xxxx&quot;</span>.split())</span><br><span class="line">cmdline.execute([<span class="string">&quot;scrapy&quot;</span>,<span class="string">&quot;crawl&quot;</span>,<span class="string">&quot;xxxx&quot;</span>])</span><br></pre></td></tr></table></figure>
<p><strong>运行报错</strong></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImportError: cannot <span class="keyword">import</span> <span class="type">name</span> <span class="string">&#x27;HTTPClientFactory&#x27;</span> <span class="keyword">from</span> <span class="string">&#x27;twisted.web.client&#x27;</span> (<span class="type">unknown</span> <span class="keyword">location</span>)</span><br></pre></td></tr></table></figure>
<p><strong>解决：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 降低Twisted版本</span></span><br><span class="line">pip install Twisted==<span class="number">20.3</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>
<h3 id="3-3-scrapy-shell调试">3.3  <code>scrapy shell</code>调试</h3>
<p>基本使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy shell https://dig.chouti.com/</span><br></pre></td></tr></table></figure>
<p>数据提取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">datas =response.xpath(<span class="string">&#x27;//div[@class=&quot;link-con&quot;]/div&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> datas:</span><br><span class="line">   <span class="built_in">print</span>(i.xpath(<span class="string">&#x27;.//a[@class=&quot;link-title link-statistics&quot;]/text()&#x27;</span>).extract_first())</span><br></pre></td></tr></table></figure>
<h2 id="4-实战演示">4 实战演示</h2>
<ul>
<li>目标地址:<a target="_blank" rel="noopener" href="https://book.douban.com/top250">https://book.douban.com/top250</a></li>
</ul>
<h3 id="4-1-spider结构">4.1  spider结构</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> cmdline</span><br><span class="line"><span class="keyword">import</span> bs4</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TopSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;top&#x27;</span></span><br><span class="line">    <span class="comment"># allowed_domains = [&#x27;top.com&#x27;]</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;https://book.douban.com/top250?start=0&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment">#print(response.text)</span></span><br><span class="line">        bs = bs4.BeautifulSoup(response.text, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">        datas = bs.find_all(<span class="string">&#x27;tr&#x27;</span>, class_=<span class="string">&quot;item&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> datas:</span><br><span class="line">            item = &#123;&#125;</span><br><span class="line">            item[<span class="string">&#x27;title&#x27;</span>] = data.find_all(<span class="string">&#x27;a&#x27;</span>)[<span class="number">1</span>][<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">            item[<span class="string">&#x27;publish&#x27;</span>] = data.find(<span class="string">&#x27;p&#x27;</span>, class_=<span class="string">&#x27;pl&#x27;</span>).text</span><br><span class="line">            item[<span class="string">&#x27;score&#x27;</span>] = data.find(<span class="string">&#x27;span&#x27;</span>, class_=<span class="string">&#x27;rating_nums&#x27;</span>).text</span><br><span class="line">            <span class="built_in">print</span>(item)</span><br><span class="line">            </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cmdline.execute(<span class="string">&#x27;scrapy crawl top&#x27;</span>.split())</span><br></pre></td></tr></table></figure>
<h3 id="4-2-定义数据">4.2 定义数据</h3>
<p>在<code>scrapy</code>中，我们会专门定义一个用于记录数据的类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoubanItem</span>(scrapy.Item):</span><br><span class="line">    <span class="comment"># define the fields for your item here like:</span></span><br><span class="line">    <span class="comment"># name = scrapy.Field()</span></span><br><span class="line">    title = scrapy.Field()</span><br><span class="line">    <span class="comment">#定义书名的数据属性</span></span><br><span class="line">    publish = scrapy.Field()</span><br><span class="line">    <span class="comment">#定义出版信息的数据属性</span></span><br><span class="line">    score = scrapy.Field()</span><br></pre></td></tr></table></figure>
<p><code>scrapy.Field()</code>这行代码实现的是，让数据能以类似字典的形式记录。但记录的方式却不是字典，是是我们定义的<code>DoubanItem</code>，属于“自定义的<code>Python</code>字典”。</p>
<h3 id="4-3-定义管道存储">4.3 定义管道存储</h3>
<h4 id="4-3-1-配置管道">4.3.1 配置管道</h4>
<p>放开配置文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   <span class="string">&#x27;douban.pipelines.DoubanPipeline&#x27;</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-3-2-存储文件编写">4.3.2 存储文件编写</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoubanPipeline</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;da.json&#x27;</span>, <span class="string">&#x27;a+&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(json.dumps(<span class="built_in">dict</span>(item), ensure_ascii=<span class="literal">False</span>))</span><br><span class="line">            f.write(<span class="string">&#x27;\r\n&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="4-3-3-配置日志">4.3.3 配置日志</h4>
<p>配置日志来做记录</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOG_LEVEL = <span class="string">&#x27;WARNING&#x27;</span></span><br><span class="line">LOG_FILE = <span class="string">&#x27;./log.log&#x27;</span></span><br></pre></td></tr></table></figure>
<p>配置日志为警告级别，如果有数据是警告级别那么将记录到文件</p>
<h2 id="5-scrapy表单处理">5 <code>scrapy</code>表单处理</h2>
<h4 id="5-1-目标地址">5.1 目标地址</h4>
<ul>
<li>首页:<a target="_blank" rel="noopener" href="http://www.cninfo.com.cn/new/commonUrl?url=disclosure/list/notice#regulator">http://www.cninfo.com.cn/new/commonUrl?url=disclosure/list/notice#regulator</a></li>
<li>接口：<a target="_blank" rel="noopener" href="http://www.cninfo.com.cn/new/disclosure">http://www.cninfo.com.cn/new/disclosure</a></li>
</ul>
<h4 id="5-2-程序编写">5.2 程序编写</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PostTestSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;post_test&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;cninfo.com&#x27;</span>]</span><br><span class="line">    <span class="comment"># start_urls = [&#x27;http://www.cninfo.com.cn/new/disclosure&#x27;]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">        url = <span class="string">&#x27;http://www.cninfo.com.cn/new/disclosure&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">            form_data = &#123;</span><br><span class="line">                <span class="string">&quot;column&quot;</span>: <span class="string">&quot;szse_gem_latest&quot;</span>,</span><br><span class="line">                <span class="string">&quot;pageNum&quot;</span>: <span class="built_in">str</span>(i),</span><br><span class="line">                <span class="string">&quot;pageSize&quot;</span>: <span class="string">&quot;30&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sortName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sortType&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;clusterFlag&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">yield</span> scrapy.FormRequest(url=url,formdata=form_data,meta=&#123;<span class="string">&#x27;page&#x27;</span>:form_data[<span class="string">&#x27;pageNum&#x27;</span>]&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;正在采集第<span class="subst">&#123;response.meta.get(<span class="string">&quot;page&quot;</span>)&#125;</span>页&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="6-框架扩展">6 框架扩展</h2>
<h3 id="6-1-框架去重设计">6.1 框架去重设计</h3>
<p><code> dont_filter</code>实现了框架去重的功能</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> cmdline</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HuyaSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;huya&#x27;</span></span><br><span class="line">    <span class="comment"># allowed_domains = [&#x27;hy.com&#x27;]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">        url = [<span class="string">&#x27;https://www.huya.com/cache.php?m=LiveList&amp;do=getLiveListByPage&amp;gameId=1663&amp;tagAll=0&amp;page=2&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;https://www.huya.com/cache.php?m=LiveList&amp;do=getLiveListByPage&amp;gameId=1663&amp;tagAll=0&amp;page=2&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> url:</span><br><span class="line">            <span class="comment"># 框架默认对地址进行了去重</span></span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url=i,dont_filter=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        items = json.loads(response.text)</span><br><span class="line">        data = items.get(<span class="string">&#x27;data&#x27;</span>).get(<span class="string">&#x27;datas&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">len</span>(data))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cmdline.execute(<span class="string">&#x27;scrapy crawl huya&#x27;</span>.split())</span><br></pre></td></tr></table></figure>
<h2 id="Scrapy功能学习"><code>Scrapy</code>功能学习</h2>
<h3 id="1-scrapy数据提取">1 <code>scrapy</code>数据提取</h3>
<p><code>Scrapy </code>还提供了自己的数据提取方法，即 <code>Selector</code>（选择器）。<code>Selector </code>是基于 <code>lxml</code> 来构建的，支持 <code>XPath </code>选择器、<code>CSS </code>选择器以及正则表达式，功能全面，解析速度和准确度非常高</p>
<h4 id="1-1-直接使用">1.1. 直接使用</h4>
<p><code>Selector</code> 是一个可以独立使用的模块。我们可以直接利用<code>Selector</code>这个类来构建一个选择器对象，然后调用它的相关方法如 <code>xpath</code>、<code>css</code>等来提取数据。</p>
<p>例如，针对一段 <code>HTML</code> 代码，我们可以用如下方式构建 <code>Selector </code>对象来提取数据：</p>
<h5 id="1-2-xpath选择器">1.2 <code>xpath</code>选择器</h5>
<p><strong>1.2.1 测试代码</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">html = &#x27;&#x27;&#x27;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">&#x27;http://example.com/&#x27;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Example website<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;images&#x27;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;image1.html&#x27;</span>&gt;</span>Name: My image 1 <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;image1_thumb.jpg&#x27;</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;image2.html&#x27;</span>&gt;</span>Name: My image 2 <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;image2_thumb.jpg&#x27;</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;image3.html&#x27;</span>&gt;</span>Name: My image 3 <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;image3_thumb.jpg&#x27;</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;image4.html&#x27;</span>&gt;</span>Name: My image 4 <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;image4_thumb.jpg&#x27;</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;image5.html&#x27;</span>&gt;</span>Name: My image 5 <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;image5_thumb.jpg&#x27;</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>
<p><strong>构建对象</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = Selector(text=html)</span><br></pre></td></tr></table></figure>
<p><strong>节点提取</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = response.xpath(<span class="string">&#x27;//a&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>**注：**这里面的话就使用常规<code>xpath</code>语法就好拉</p>
<h5 id="1-3-正则匹配">1.3 正则匹配</h5>
<p><code>Scrapy</code> 的选择器还支持正则匹配。比如，在示例的 <code>a </code>节点中的文本类似于<code>Name: My image 1</code>，现在我们只想把 <code>Name: </code>后面的内容提取出来，这时就可以借助<code>re</code>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.xpath(<span class="string">&#x27;//a/text()&#x27;</span>).re(<span class="string">&#x27;Name:\s(.*)&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>给 <code>re() </code>方法传了一个正则表达式，其中 (.*) 就是要匹配的内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(response.xpath(<span class="string">&#x27;//a/text()&#x27;</span>).re(<span class="string">&#x27;(.*?):\s(.*)&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>提取返回的第一个值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extract_first()    extract()</span><br></pre></td></tr></table></figure>
<h3 id="2-scrapy中间件">2 <code>scrapy</code>中间件</h3>
<p>​		<code>Scheduler </code>从队列中拿出一个 <code>Request</code> 发送给 <code>Downloader</code> 执行下载，这个过程会经过 <code>Downloader Middleware</code> 的处理。另外，当 <code>Downloader</code> 将 <code>Request </code>下载完成得到 <code>Response</code> 返回给 <code>Spider</code> 时会再次经过 <code>Downloader Middleware</code> 处理。</p>
<p>也就是说，<code>Downloader Middleware </code>在整个架构中起作用的位置是以下两个。</p>
<ul>
<li>在 <code>Scheduler</code> 调度出队列的 <code>Request</code> 发送给 <code>Downloader </code>下载之前，也就是我们可以在 <code>Request </code>执行下载之前对其进行修改。</li>
<li>在下载后生成的 <code>Response</code> 发送给 <code>Spider</code> 之前，也就是我们可以在生成 <code>Resposne </code>被 <code>Spider</code> 解析之前对其进行修改。</li>
</ul>
<h4 id="2-1-目的">2.1 目的</h4>
<p>​		<code>Downloader Middleware</code> 的功能十分强大，修改 <code>User-Agent</code>、处理重定向、设置代理、失败重试、设置 <code>Cookies</code> 等功能都需要借助它来实现。下面我们来了解一下 <code>Downloader Middleware</code> 的详细用法</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282032097.png" alt="image-20220909140827526"></p>
<p>**注：**如果没有中间件的话，就是一个光光的请求了</p>
<h4 id="2-2-中间件介绍">2.2 中间件介绍</h4>
<p>可以看到里面主要有五个方法：</p>
<ol>
<li>from_crawler：类方法，用于初始化中间件</li>
<li>process_request：每个request通过下载中间件时，都会调用该方法</li>
<li>process_response：处理下载器返回的响应内容</li>
<li>process_exception：当下载器或者处理请求异常时，调用此方法</li>
<li>spider_opened：内置的信号量回调方法</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">       <span class="comment"># Called for each request that goes through the downloader</span></span><br><span class="line">       <span class="comment"># middleware.</span></span><br><span class="line">       <span class="comment"># 每个交给下载器的request对象都会经过该方法，并期望返回response</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># Must either:</span></span><br><span class="line">       <span class="comment"># 如果该方法返回的是None，则继续执行其他下载中间件的process_request方法送往下载器，直到合适的下载器函数被调用，该request被执行，返回response</span></span><br><span class="line">       <span class="comment"># - return None: continue processing this request</span></span><br><span class="line">       <span class="comment"># 如果该方法返回的是response，则终止当前流程，也终止继续调用其他process_request方法，将该response通过引擎返回给爬虫</span></span><br><span class="line">       <span class="comment"># - or return a Response object</span></span><br><span class="line">       <span class="comment"># 如果该方法返回的是request，则终止当前流程，也终止继续调用其他process_request方法，将request返回给调度器，大多数情况是更换新的request请求</span></span><br><span class="line">       <span class="comment"># - or return a Request object</span></span><br><span class="line">       <span class="comment"># 抛出IgnoreRequest异常, 该异常就会交个process_exception方法进行处理; 如果没有任何一个方法处理该异常</span></span><br><span class="line">       <span class="comment"># 那么该请求就直接被忽略了, 也不会记录错误日志.</span></span><br><span class="line">       <span class="comment"># - or raise IgnoreRequest: process_exception() methods of</span></span><br><span class="line">       <span class="comment">#   installed downloader middleware will be called</span></span><br><span class="line">       <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response, spider</span>):</span><br><span class="line">       <span class="comment"># Called with the response returned from the downloader.</span></span><br><span class="line">       <span class="comment"># 当下载器完成http请求，返回响应给引擎的时候调用</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># Must either;</span></span><br><span class="line">       <span class="comment"># 如果返回response，则继续执行，其他下载中间件也会处理该response，直至交给引擎再交给爬虫</span></span><br><span class="line">       <span class="comment"># - return a Response object</span></span><br><span class="line">       <span class="comment">#　如果返回request,则中间件终止，该request返回引擎再给调度器</span></span><br><span class="line">       <span class="comment"># - return a Request object</span></span><br><span class="line">       <span class="comment"># 抛出 IgnoreRequest 异常; 该请求就被忽略了且不做记录</span></span><br><span class="line">       <span class="comment"># - or raise IgnoreRequest</span></span><br><span class="line">       <span class="keyword">return</span> response</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>2.2.1 中间件激活</strong></p>
<p><code>DOWNLOADER_MIDDLEWARES</code>参数用来设置下载器中间件。其中，<code>Key</code>为中间件路径，<code>Value</code>为中间件执行优先级，<strong>「数字越小，越先执行」</strong>，当<code>Value</code>为**「None」**时，表示禁用。</p>
<h4 id="2-3-自定义中间件">2.3 自定义中间件</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RandomUserAgentMiddleware</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.user_agents = [</span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US)&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.2 (KHTML, like Gecko) Chrome/22.0.1216.0 Safari/537.2&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:15.0) Gecko/20100101 Firefox/15.0.1&#x27;</span></span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        request.headers[<span class="string">&#x27;User-Agent&#x27;</span>] = random.choice(<span class="variable language_">self</span>.user_agents)</span><br></pre></td></tr></table></figure>
<p><strong>2.3.1 激活配置</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">   <span class="string">&#x27;scrapydownloadertest.middlewares.RandomUserAgentMiddleware&#x27;</span>: <span class="number">543</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-1-拓展专题-配置自动化">2.3.1 拓展专题-配置自动化</h5>
<p>地址：<a target="_blank" rel="noopener" href="https://phantomjs.org/download.html">https://phantomjs.org/download.html</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> logging <span class="keyword">import</span> getLogger</span><br><span class="line"><span class="keyword">from</span> scrapy.http <span class="keyword">import</span> HtmlResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SeleniumMiddleware</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.logger = getLogger(__name__)</span><br><span class="line">        <span class="variable language_">self</span>.timeout = random.randint(<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">        <span class="variable language_">self</span>.browser =webdriver.Chrome()</span><br><span class="line">        <span class="variable language_">self</span>.browser.set_window_size(<span class="number">1400</span>, <span class="number">700</span>)</span><br><span class="line">        <span class="variable language_">self</span>.browser.set_page_load_timeout(<span class="variable language_">self</span>.timeout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        <span class="variable language_">self</span>.logger.debug(<span class="string">&#x27;PhantomJS is Starting&#x27;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.browser.get(request.url)</span><br><span class="line">        body = <span class="variable language_">self</span>.browser.page_source</span><br><span class="line">        <span class="keyword">return</span> HtmlResponse(url=request.url, body=body, request=request, encoding=<span class="string">&#x27;utf-8&#x27;</span>,status=<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__del__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.browser.close()</span><br></pre></td></tr></table></figure>
<p>测试python代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> pydispatch <span class="keyword">import</span> dispatcher</span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> cmdline, signals</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestSpider</span>(scrapy.Spider):</span><br><span class="line"></span><br><span class="line">    name = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">    start_url = <span class="string">&#x27;https://careers.tencent.com/tencentcareer/api/post/Query?timestamp=1630663331818&amp;countryId=&amp;cityId=&amp;bgIds=&amp;productId=&amp;categoryId=&amp;parentCategoryId=&amp;attrId=&amp;keyword=python&amp;pageIndex=&#123;&#125;&amp;pageSize=10&amp;language=zh-cn&amp;area=cn&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">3</span>):</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url=<span class="variable language_">self</span>.start_url.<span class="built_in">format</span>(i),callback=<span class="variable language_">self</span>.parse)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="variable language_">self</span>.logger.info(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cmdline.execute(<span class="string">&#x27;scrapy crawl test&#x27;</span>.split())</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-scrapy数据存储">3 <code>scrapy</code>数据存储</h3>
<h4 id="3-1-基于mongo存储">3.1 基于<code>mongo</code>存储</h4>
<ul>
<li>首页：<a target="_blank" rel="noopener" href="https://hot.online.sh.cn/node/node_65634.htm">https://hot.online.sh.cn/node/node_65634.htm</a></li>
<li>需求：使用框架采集</li>
</ul>
<h5 id="3-1-1-爬虫文件编写">3.1.1  爬虫文件编写</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> cmdline</span><br><span class="line"><span class="keyword">from</span> news.items <span class="keyword">import</span> NewsItem</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HotSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;hot&#x27;</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;https://hot.online.sh.cn/node/node_65634.htm&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        news_list = response.css(<span class="string">&#x27;div.list_thread&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> news <span class="keyword">in</span> news_list:</span><br><span class="line">            items = NewsItem()</span><br><span class="line">            items[<span class="string">&#x27;title&#x27;</span>] = news.xpath(<span class="string">&#x27;.//h2/a/text()&#x27;</span>).extract_first()</span><br><span class="line">            items[<span class="string">&#x27;times&#x27;</span>] = news.xpath(<span class="string">&#x27;.//h3/text()&#x27;</span>).extract_first()</span><br><span class="line">            items[<span class="string">&#x27;info&#x27;</span>]  = news.xpath(<span class="string">&#x27;.//p/text()&#x27;</span>).extract_first()</span><br><span class="line">            <span class="keyword">yield</span>  items</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 处理翻页</span></span><br><span class="line">        <span class="built_in">next</span> = response.xpath(<span class="string">&#x27;//center/a[text()=&quot;下一页&quot;]/@href&#x27;</span>).extract_first()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">next</span>:</span><br><span class="line">            <span class="comment"># https://movie.douban.com/top250?start=25&amp;filter=</span></span><br><span class="line">            url = <span class="string">&#x27;https://hot.online.sh.cn/node/&#x27;</span></span><br><span class="line">            <span class="built_in">print</span>(url + <span class="built_in">next</span>)</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(urljoin(url, <span class="built_in">next</span>), callback=<span class="variable language_">self</span>.parse)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cmdline.execute(<span class="string">&#x27;scrapy crawl hot&#x27;</span>.split())</span><br></pre></td></tr></table></figure>
<h5 id="3-1-2-管道文件编写">3.1.2  管道文件编写</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Define your item pipelines here</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Don&#x27;t forget to add your pipeline to the ITEM_PIPELINES setting</span></span><br><span class="line"><span class="comment"># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span></span><br><span class="line"><span class="comment"># useful for handling different item types with a single interface</span></span><br><span class="line"><span class="keyword">from</span> itemadapter <span class="keyword">import</span> ItemAdapter</span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NewsPipeline</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_spider</span>(<span class="params">self,spider</span>):</span><br><span class="line">        <span class="variable language_">self</span>.client = pymongo.MongoClient()</span><br><span class="line">        <span class="variable language_">self</span>.db = <span class="variable language_">self</span>.client.news  <span class="comment"># 指令库</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        items = <span class="built_in">dict</span>(item)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(items,<span class="built_in">dict</span>):</span><br><span class="line">            <span class="variable language_">self</span>.db[<span class="string">&#x27;xl&#x27;</span>].insert_one(items)</span><br><span class="line">            <span class="keyword">return</span> item</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;数据格式有误&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="3-2-基于MySQL存储">3.2 基于<code>MySQL</code>存储</h4>
<h5 id="3-2-1-配置编写">3.2.1 配置编写</h5>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATA_CONFIG = &#123;</span><br><span class="line">   &#x27;config&#x27; : &#123;</span><br><span class="line">      &#x27;host&#x27;:&#x27;127.0.0.1&#x27;,</span><br><span class="line">      &#x27;port&#x27;:3306,</span><br><span class="line">      &#x27;user&#x27;:&#x27;root&#x27;,</span><br><span class="line">      &#x27;password&#x27;:&#x27;&#x27;,</span><br><span class="line">      &#x27;db&#x27;:&#x27;yy&#x27;,</span><br><span class="line">      &#x27;charset&#x27;:&#x27;utf8&#x27;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-2-2-存储文件编写">3.2.2 存储文件编写</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NewsPipeline_mysql</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_spider</span>(<span class="params">self,spider</span>):</span><br><span class="line">        data_config = spider.settings[<span class="string">&#x27;DATA_CONFIG&#x27;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.conn = pymysql.connect(**data_config[<span class="string">&#x27;config&#x27;</span>])</span><br><span class="line">        <span class="variable language_">self</span>.cursor = <span class="variable language_">self</span>.conn.cursor()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close_spider</span>(<span class="params">self,spider</span>):</span><br><span class="line">        <span class="comment"># 关闭游标和连接</span></span><br><span class="line">        <span class="variable language_">self</span>.cursor.close()</span><br><span class="line">        <span class="variable language_">self</span>.conn.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        <span class="comment"># 插入数到数据库</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(item, items.NewsItem_hot):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                sql = <span class="string">&#x27;insert into info (title,crate_time,info) values (%s,%s,%s)&#x27;</span></span><br><span class="line">                <span class="variable language_">self</span>.cursor.execute(sql, (</span><br><span class="line">                    item[<span class="string">&#x27;title&#x27;</span>],</span><br><span class="line">                    item[<span class="string">&#x27;times&#x27;</span>],</span><br><span class="line">                    item[<span class="string">&#x27;info&#x27;</span>],</span><br><span class="line">                ))</span><br><span class="line">                <span class="comment"># 提交</span></span><br><span class="line">                <span class="variable language_">self</span>.conn.commit()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="variable language_">self</span>.conn.rollback()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;信息写入错误%s-%s&#x27;</span> % (item[<span class="string">&#x27;url&#x27;</span>], e))</span><br></pre></td></tr></table></figure>
<h2 id="feapder-框架"><code>feapder</code> 框架</h2>
<p><strong>学习目标</strong></p>
<ul>
<li>
<p>掌握便捷式框架操作流程</p>
</li>
<li>
<p>掌握请求钩子结构使用</p>
</li>
<li>
<p>掌握框架项目搭建流程</p>
</li>
<li>
<p>掌握数据入库与去重</p>
<h2 id="-2"></h2>
</li>
</ul>
<h3 id="1-简介-2">1 简介</h3>
<p>国内文档：<a target="_blank" rel="noopener" href="https://boris-code.gitee.io/feapder">https://boris-code.gitee.io/feapder</a></p>
<p><strong>feapder</strong> 是一款上手简单，功能强大的Python爬虫框架，使用方式类似<code>scrapy</code>，方便由<code>scrapy</code>框架切换过来，框架内置3种爬虫：</p>
<h4 id="1-1-支持的场景">1.1  支持的场景</h4>
<ul>
<li><code>AirSpider</code>爬虫比较轻量，学习成本低。面对一些数据量较少，无需断点续爬，无需分布式采集的需求，可采用此爬虫。</li>
<li><code>Spider</code>是一款基于<code>redis</code>的分布式爬虫，适用于海量数据采集，支持断点续爬、爬虫报警、数据自动入库等功能</li>
<li><code>BatchSpider</code>是一款分布式批次爬虫，对于需要周期性采集的数据，优先考虑使用本爬虫。</li>
</ul>
<h4 id="1-2-架构说明">1.2 架构说明</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282033781.png" alt="boris-spider -1-"></p>
<h5 id="1-2-1模块说明">1.2.1<strong>模块说明</strong></h5>
<ul>
<li>spider <strong>框架调度核心</strong></li>
<li>parser_control <strong>模版控制器</strong>，负责调度parser</li>
<li>collector <strong>任务收集器</strong>，负责从任务队里中批量取任务到内存，以减少爬虫对任务队列数据库的访问频率及并发量</li>
<li>parser <strong>数据解析器</strong></li>
<li>start_request 初始任务下发函数</li>
<li>item_buffer <strong>数据缓冲队列</strong>，批量将数据存储到数据库中</li>
<li>request_buffer <strong>请求任务缓冲队列</strong>，批量将请求任务存储到任务队列中</li>
<li>request <strong>数据下载器</strong>，封装了requests，用于从互联网上下载数据</li>
<li>response <strong>请求响应</strong>，封装了response, 支持xpath、css、re等解析方式，自动处理中文乱码</li>
</ul>
<h5 id="1-2-2-流程说明">1.2.2 <strong>流程说明</strong></h5>
<ol>
<li>spider调度<strong>start_request</strong>生产任务</li>
<li><strong>start_request</strong>下发任务到request_buffer中</li>
<li>spider调度<strong>request_buffer</strong>批量将任务存储到任务队列数据库中</li>
<li>spider调度<strong>collector</strong>从任务队列中批量获取任务到内存队列</li>
<li>spider调度<strong>parser_control</strong>从collector的内存队列中获取任务</li>
<li><strong>parser_control</strong>调度<strong>request</strong>请求数据</li>
<li><strong>request</strong>请求与下载数据</li>
<li>request将下载后的数据给<strong>response</strong>，进一步封装</li>
<li>将封装好的<strong>response</strong>返回给<strong>parser_control</strong>（图示为多个parser_control，表示多线程）</li>
<li>parser_control调度对应的<strong>parser</strong>，解析返回的response（图示多组parser表示不同的网站解析器）</li>
<li>parser_control将parser解析到的数据item及新产生的request分发到<strong>item_buffer</strong>与<strong>request_buffer</strong></li>
<li>spider调度<strong>item_buffer</strong>与<strong>request_buffer</strong>将数据批量入库</li>
</ol>
<h3 id="2-使用">2 使用</h3>
<h4 id="2-1-环境安装">2.1 环境安装</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install feapder</span><br></pre></td></tr></table></figure>
<h4 id="2-2-创建普通爬虫">2.2 创建普通爬虫</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">feapder create -s xxxx</span><br></pre></td></tr></table></figure>
<h4 id="2-3-爬虫小案例">2.3 爬虫小案例</h4>
<ol>
<li>下发任务：下发任务</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">yield</span> feapder.Request(<span class="string">&quot;https://www.icswb.com/channel-list-channel-161.html&quot;</span>)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>解析标题及详情页链接</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, request, response</span>):</span><br><span class="line">    <span class="comment"># 提取网站title</span></span><br><span class="line">    <span class="built_in">print</span>(response.xpath(<span class="string">&quot;//title/text()&quot;</span>).extract_first())</span><br><span class="line">    <span class="comment"># 提取网站描述</span></span><br><span class="line">    article_list = response.xpath(<span class="string">&#x27;//ul[@id=&quot;NewsListContainer&quot;]/li&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> article_list[:-<span class="number">1</span>]:</span><br><span class="line">        title = i.xpath(<span class="string">&#x27;./h3/a/text()&#x27;</span>).extract_first()</span><br><span class="line">        url = i.xpath(<span class="string">&#x27;./h3/a/@href&#x27;</span>).extract_first()</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line">        <span class="keyword">yield</span> feapder.Request(<span class="string">&#x27;https://www.icswb.com&#x27;</span>+url, callback=<span class="variable language_">self</span>.parser_detail, title=title)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>抓详情需要将列表采集到的url作为新任务，然后请求，解析。写法很简单，代码如下：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">parser_detail</span>(<span class="params">self, request, response</span>):</span><br><span class="line">    title = request.title</span><br><span class="line">    content = response.xpath(<span class="string">&#x27;//article[@class=&quot;am-article&quot;]&#x27;</span>).extract_first()</span><br><span class="line">    <span class="built_in">print</span>(content)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>启动代码</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 开启多线程方式</span></span><br><span class="line">    SpiderTest(thread_count=<span class="number">5</span>).start()</span><br></pre></td></tr></table></figure>
<h5 id="2-3-1-数据入库">2.3.1 数据入库</h5>
<p><code>feapder</code>给我们提供了方法</p>
<ul>
<li>参考：<a target="_blank" rel="noopener" href="https://feapder.com/#/source_code/MysqlDB">https://feapder.com/#/source_code/MysqlDB</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> feapder.db.mysqldb <span class="keyword">import</span> MysqlDB</span><br><span class="line">db = MysqlDB(</span><br><span class="line">    ip=<span class="string">&quot;localhost&quot;</span>, port=<span class="number">3306</span>, db=<span class="string">&quot;feapder&quot;</span>, user_name=<span class="string">&quot;feapder&quot;</span>, user_pass=<span class="string">&quot;feapder123&quot;</span></span><br><span class="line">)</span><br><span class="line">tt = <span class="string">&#x27;胖双&#x27;</span></span><br><span class="line">cc = <span class="string">&#x27;胖娜&#x27;</span></span><br><span class="line">sql = <span class="string">&quot;insert ignore into xxx (title,content) values (&#x27;%s&#x27;, &#x27;%s&#x27;)&quot;</span> % (tt,cc)</span><br><span class="line">db.add(sql)</span><br></pre></td></tr></table></figure>
<p>1、创建配置文件</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">feapder <span class="built_in">create</span> <span class="comment">--setting</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>激活配置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # MYSQL</span></span><br><span class="line">MYSQL_IP = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">MYSQL_PORT = <span class="number">3306</span></span><br><span class="line">MYSQL_DB = <span class="string">&quot;test8&quot;</span></span><br><span class="line">MYSQL_USER_NAME = <span class="string">&quot;root&quot;</span></span><br><span class="line">MYSQL_USER_PASS = <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>2、创建item文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">feapder create -i xxx     <span class="comment"># xxx=表名</span></span><br></pre></td></tr></table></figure>
<p>3、项目引入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xxx_item <span class="keyword">import</span> XxxItem</span><br><span class="line">   ....</span><br><span class="line">item = XxxItem()</span><br><span class="line">item.title = titles</span><br><span class="line">item.content = contents</span><br><span class="line"><span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure>
<p>注：数据是一次入库，降低对数据库的操作</p>
<h4 id="2-4-自定义中间件">2.4 自定义中间件</h4>
<ul>
<li>请求前会经过这个函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> feapder</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo1s</span>(feapder.AirSpider):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">3</span>):</span><br><span class="line">            <span class="keyword">yield</span> feapder.Request(<span class="string">&quot;http://httpbin.org/get&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">download_midware</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        我是自定义的下载中间件 </span></span><br><span class="line"><span class="string">        :param request:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        request.headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&quot;lalala&quot;</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> request</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        <span class="built_in">print</span>(response.text)</span><br><span class="line">            <span class="comment"># print(title, url)</span></span><br></pre></td></tr></table></figure>
<h4 id="2-5-自定义下载器">2.5 自定义下载器</h4>
<p>自定义下载器即在下载中间件里下载，然后返回response即可，如使用httpx库下载以便支持http2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> feapder, httpx</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo1s</span>(feapder.AirSpider):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">yield</span> feapder.Request(<span class="string">&quot;http://httpbin.org/get&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        <span class="keyword">if</span> response.status_code != <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&quot;response code not 200&quot;</span>)  <span class="comment"># 重试</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    Demo1s(thread_count=<span class="number">1</span>).start()</span><br></pre></td></tr></table></figure>
<h4 id="2-6-对接自动化">2.6 对接自动化</h4>
<p>​		采集动态页面时（Ajax渲染的页面），常用的有两种方案。一种是找接口拼参数，这种方式比较复杂但效率高，需要一定的爬虫功底；另外一种是采用浏览器渲染的方式，直接获取源码，简单方便</p>
<p>内置浏览器渲染支持 <strong>CHROME</strong> 、<strong>PHANTOMJS</strong>、<strong>FIREFOX</strong></p>
<p><a target="_blank" rel="noopener" href="https://boris-code.gitee.io/feapder/#/source_code/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93?id=%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F%EF%BC%9A">使用方式：</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">yield</span> feapder.Request(<span class="string">&quot;https://news.qq.com/&quot;</span>, render=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>在返回的Request中传递<code>render=True</code>即可</p>
<p>注意：框架用的是老版本，需要降低现有版本</p>
<ul>
<li>
<p>版本查看方法：<a target="_blank" rel="noopener" href="https://pypi.org/project/selenium/#history">https://pypi.org/project/selenium/#history</a></p>
</li>
<li>
<pre><code class="language-python">pip install selenium==3.141.0
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">##### 2.6.1 配置</span></span><br><span class="line"></span><br><span class="line">+ 在setting里面改配置</span><br><span class="line">+ 在项目里面重写配置</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">__custom_setting__ = dict(</span><br><span class="line">        <span class="attribute">WEBDRIVER</span>=dict(</span><br><span class="line">            <span class="attribute">pool_size</span>=1,  # 浏览器的数量</span><br><span class="line">            <span class="attribute">load_images</span>=<span class="literal">True</span>,  # 是否加载图片</span><br><span class="line">            <span class="attribute">user_agent</span>=None,  # 字符串 或 无参函数，返回值为user_agent</span><br><span class="line">            <span class="attribute">proxy</span>=None,  # xxx.xxx.xxx.xxx:xxxx 或 无参函数，返回值为代理地址</span><br><span class="line">            <span class="attribute">headless</span>=<span class="literal">False</span>,  # 是否为无头浏览器</span><br><span class="line">            <span class="attribute">driver_type</span>=<span class="string">&quot;CHROME&quot;</span>,  # CHROME、PHANTOMJS、FIREFOX</span><br><span class="line">            <span class="attribute">timeout</span>=30,  # 请求超时时间</span><br><span class="line">            window_size=(1024, 800),  # 窗口大小</span><br><span class="line">            <span class="attribute">executable_path</span>=<span class="string">&#x27;D:\software\inters\python3\chromedriver.exe&#x27;</span>,  # 浏览器路径，默认为默认路径</span><br><span class="line">            <span class="attribute">render_time</span>=0,  # 渲染时长，即打开网页等待指定时间后再获取源码</span><br><span class="line">            custom_argument=[<span class="string">&quot;--ignore-certificate-errors&quot;</span>],  # 自定义浏览器渲染参数</span><br><span class="line">        )</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ul>
<p><strong>自动适配浏览器驱动</strong></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">WEBDRIVER</span> <span class="operator">=</span> dict(</span><br><span class="line">    ...</span><br><span class="line">    auto_install_driver<span class="operator">=</span>True</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>即浏览器渲染相关配置 <code>auto_install_driver</code> 设置True，让其自动对比驱动版本，版本不符或驱动不存在时自动下载</p>
<h5 id="2-6-2-操作浏览器对象">2.6.2 操作浏览器对象</h5>
<ul>
<li>通过 <code>response.browser</code> 获取浏览器对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> feapder</span><br><span class="line"><span class="keyword">from</span> feapder.utils.webdriver <span class="keyword">import</span> WebDriver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestRender</span>(feapder.AirSpider):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">yield</span> feapder.Request(<span class="string">&quot;http://www.baidu.com&quot;</span>, render=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        browser: WebDriver = response.browser</span><br><span class="line">        browser.find_element_by_id(<span class="string">&quot;kw&quot;</span>).send_keys(<span class="string">&quot;feapder&quot;</span>)</span><br><span class="line">        browser.find_element_by_id(<span class="string">&quot;su&quot;</span>).click()</span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line">        <span class="built_in">print</span>(browser.page_source)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># response也是可以正常使用的</span></span><br><span class="line">        <span class="comment"># response.xpath(&quot;//title&quot;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 若有滚动，可通过如下方式更新response，使其加载滚动后的内容</span></span><br><span class="line">        <span class="comment"># response.text = browser.page_source</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    TestRender().start()</span><br></pre></td></tr></table></figure>
<h5 id="2-6-3-拦截XHR-数据">2.6.3 拦截XHR 数据</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">WEBDRIVER = <span class="built_in">dict</span>(</span><br><span class="line">    ...</span><br><span class="line">    xhr_url_regexes=[</span><br><span class="line">        <span class="string">&quot;接口1正则&quot;</span>,</span><br><span class="line">        <span class="string">&quot;接口2正则&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>数据获取</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">browser: WebDriver = response.browser</span><br><span class="line"><span class="comment"># 提取文本</span></span><br><span class="line">text = browser.xhr_text(<span class="string">&quot;接口1正则&quot;</span>)</span><br><span class="line"><span class="comment"># 提取json</span></span><br><span class="line">data = browser.xhr_json(<span class="string">&quot;接口1正则&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>获取对象</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">browser: WebDriver = response.browser</span><br><span class="line">xhr_response = browser.xhr_response(<span class="string">&quot;接口1正则&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;请求接口&quot;</span>, xhr_response.request.url)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;请求头&quot;</span>, xhr_response.request.headers)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;请求体&quot;</span>, xhr_response.request.data)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;返回头&quot;</span>, xhr_response.headers)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;返回地址&quot;</span>, xhr_response.url)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;返回内容&quot;</span>, xhr_response.content)</span><br></pre></td></tr></table></figure>
<h5 id="2-6-4-示例代码">2.6.4 示例代码</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Created on 2022-09-13 21:39:47</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">@summary:</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">@author: XL</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> feapder</span><br><span class="line"><span class="keyword">from</span> feapder.utils.webdriver <span class="keyword">import</span> WebDriver</span><br><span class="line"><span class="keyword">from</span> feapder.network.downloader <span class="keyword">import</span> SeleniumDownloader</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>(feapder.AirSpider):</span><br><span class="line">    __custom_setting__ = <span class="built_in">dict</span>(</span><br><span class="line">        WEBDRIVER=<span class="built_in">dict</span>(</span><br><span class="line">            pool_size=<span class="number">1</span>,  <span class="comment"># 浏览器的数量</span></span><br><span class="line">            load_images=<span class="literal">True</span>,  <span class="comment"># 是否加载图片</span></span><br><span class="line">            user_agent=<span class="literal">None</span>,  <span class="comment"># 字符串 或 无参函数，返回值为user_agent</span></span><br><span class="line">            proxy=<span class="literal">None</span>,  <span class="comment"># xxx.xxx.xxx.xxx:xxxx 或 无参函数，返回值为代理地址</span></span><br><span class="line">            headless=<span class="literal">False</span>,  <span class="comment"># 是否为无头浏览器</span></span><br><span class="line">            driver_type=<span class="string">&quot;CHROME&quot;</span>,  <span class="comment"># CHROME、PHANTOMJS、FIREFOX</span></span><br><span class="line">            timeout=<span class="number">30</span>,  <span class="comment"># 请求超时时间</span></span><br><span class="line">            window_size=(<span class="number">1024</span>, <span class="number">800</span>),  <span class="comment"># 窗口大小</span></span><br><span class="line">            executable_path=<span class="string">&#x27;D:\software\inters\python3\chromedriver.exe&#x27;</span>,  <span class="comment"># 浏览器路径，默认为默认路径</span></span><br><span class="line">            render_time=<span class="number">0</span>,  <span class="comment"># 渲染时长，即打开网页等待指定时间后再获取源码</span></span><br><span class="line">            custom_argument=[<span class="string">&quot;--ignore-certificate-errors&quot;</span>],  <span class="comment"># 自定义浏览器渲染参数</span></span><br><span class="line"></span><br><span class="line">            xhr_url_regexes=[</span><br><span class="line">                <span class="string">&quot;/api/post/Query&quot;</span>,</span><br><span class="line">            ],  <span class="comment"># 拦截 https://careers.tencent.com/tencentcareer/api/post/Query 接口</span></span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">yield</span> feapder.Request(<span class="string">&quot;https://careers.tencent.com/search.html?keyword=python&quot;</span>,render=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, request, response</span>):</span><br><span class="line">        <span class="comment"># print(response.text)</span></span><br><span class="line">        <span class="comment"># 可以使用自动化提取</span></span><br><span class="line">        <span class="comment"># 数据提取第一种 使用xpath提取</span></span><br><span class="line">        <span class="comment"># title = response.xpath(&#x27;//h4[@class=&quot;recruit-title&quot;]/text()&#x27;)</span></span><br><span class="line">        <span class="comment"># print(title)</span></span><br><span class="line">        <span class="comment"># 数据提取第2种 继续使用自动化</span></span><br><span class="line">        <span class="comment"># browser: WebDriver = response.browser</span></span><br><span class="line">        <span class="comment"># time.sleep(3)</span></span><br><span class="line">        <span class="comment"># title = browser.find_element_by_class_name(&#x27;recruit-title&#x27;).text</span></span><br><span class="line">        <span class="comment"># print(title)</span></span><br><span class="line">        <span class="comment"># 数据提取第3种，使用API接口拦截</span></span><br><span class="line">        browser: WebDriver = response.browser</span><br><span class="line">        time.sleep(<span class="number">1.5</span>)</span><br><span class="line">        <span class="comment"># 获取接口数据 文本类型</span></span><br><span class="line">        <span class="comment"># data = browser.xhr_text(&quot;/api/post/Query&quot;)</span></span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="comment"># data = browser.xhr_json(&quot;/api/post/Query&quot;)</span></span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="comment"># 自定义提取数据</span></span><br><span class="line">        xhr_response = browser.xhr_response(<span class="string">&quot;/api/post/Query&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请求头&quot;</span>, xhr_response.request.headers)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请求体&quot;</span>, xhr_response.request.data)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;返回内容&quot;</span>, xhr_response.content)</span><br><span class="line">        <span class="comment"># 关闭浏览器</span></span><br><span class="line">        response.close_browser(request)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    Test().start()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-项目搭建">3 项目搭建</h3>
<h4 id="3-1-创建项目">3.1 创建项目</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">feapder create -p <span class="tag">&lt;<span class="name">project_name</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282033729.jpeg" alt="-w354"></p>
<ul>
<li>items： 文件夹存放与数据库表映射的item</li>
<li>spiders： 文件夹存放爬虫脚本</li>
<li><a target="_blank" rel="noopener" href="http://main.py">main.py</a>： 运行入口</li>
<li><a target="_blank" rel="noopener" href="http://setting.py">setting.py</a>： 爬虫配置文件</li>
</ul>
<h4 id="3-2-创建普通爬虫">3.2 <strong>创建普通爬虫</strong></h4>
<ul>
<li>需要先切换到spiders文件夹下</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">feapder create -s first_spider</span><br></pre></td></tr></table></figure>
<h4 id="3-3-配置自动化">3.3 配置自动化</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">WEBDRIVER = <span class="built_in">dict</span>(</span><br><span class="line">    pool_size=<span class="number">1</span>,  <span class="comment"># 浏览器的数量</span></span><br><span class="line">    load_images=<span class="literal">True</span>,  <span class="comment"># 是否加载图片</span></span><br><span class="line">    user_agent=<span class="literal">None</span>,  <span class="comment"># 字符串 或 无参函数，返回值为user_agent</span></span><br><span class="line">    proxy=<span class="literal">None</span>,  <span class="comment"># xxx.xxx.xxx.xxx:xxxx 或 无参函数，返回值为代理地址</span></span><br><span class="line">    headless=<span class="literal">False</span>,  <span class="comment"># 是否为无头浏览器</span></span><br><span class="line">    driver_type=<span class="string">&quot;CHROME&quot;</span>,  <span class="comment"># CHROME、PHANTOMJS、FIREFOX</span></span><br><span class="line">    timeout=<span class="number">30</span>,  <span class="comment"># 请求超时时间</span></span><br><span class="line">    window_size=(<span class="number">1024</span>, <span class="number">800</span>),  <span class="comment"># 窗口大小</span></span><br><span class="line">    executable_path=<span class="string">&#x27;D:\software\inters\python3\chromedriver.exe&#x27;</span>,  <span class="comment"># 浏览器路径，默认为默认路径</span></span><br><span class="line">    render_time=<span class="number">0</span>,  <span class="comment"># 渲染时长，即打开网页等待指定时间后再获取源码</span></span><br><span class="line">    custom_argument=[</span><br><span class="line">        <span class="string">&quot;--ignore-certificate-errors&quot;</span>,</span><br><span class="line">        <span class="string">&quot;--disable-blink-features=AutomationControlled&quot;</span>,</span><br><span class="line">    ],  <span class="comment"># 自定义浏览器渲染参数</span></span><br><span class="line">    xhr_url_regexes=[</span><br><span class="line">        <span class="string">&quot;/hbsearch/HotelSearch&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">    auto_install_driver=<span class="literal">False</span>,  <span class="comment"># 自动下载浏览器驱动 支持chrome 和 firefox</span></span><br><span class="line">    use_stealth_js=<span class="literal">True</span>,  <span class="comment"># 使用stealth.min.js隐藏浏览器特征</span></span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="3-4-业务逻辑分析">3.4 业务逻辑分析</h4>
<h5 id="3-5-1-翻页">3.5.1 翻页</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">next_page</span>(<span class="params">self,browser</span>):</span><br><span class="line">    <span class="comment"># 11568</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">    time.sleep(<span class="number">0.3</span>)</span><br><span class="line">    js = <span class="string">&quot;window.scrollTo(0, &#123;&#125;)&quot;</span>.<span class="built_in">format</span>(x*<span class="number">1000</span>) <span class="comment"># 1000 2000 3000 4000 5000</span></span><br><span class="line">    browser.execute_script(js)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h5 id="3-5-2-点击">3.5.2 点击</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_next_page</span>(<span class="params">self,browser</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        next_btn = browser.find_element_by_xpath(<span class="string">&#x27;.//a[@class=&quot;pn-next&quot;]&#x27;</span>)      <span class="comment"># 下一页地址</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;next-disabled&#x27;</span> <span class="keyword">in</span> next_btn.get_attribute(<span class="string">&#x27;class&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;没有下一页，抓取完成&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            next_btn.click()</span><br><span class="line">	<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">         <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>
<h4 id="3-5-数据解析">3.5 数据解析</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">browser: WebDriver = response.browser</span><br><span class="line">    time.sleep(<span class="number">1.5</span>)</span><br><span class="line">    <span class="variable language_">self</span>.next_page(browser)</span><br><span class="line">    res = browser.page_source</span><br><span class="line">    html = etree.HTML(res)</span><br><span class="line">    page = <span class="string">&#x27;&#x27;</span>.join(html.xpath(<span class="string">&#x27;//span[@class=&quot;p-num&quot;]/a[@class=&quot;curr&quot;]/text()&#x27;</span>))  <span class="comment"># 提取当前页面</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;正在采集第<span class="subst">&#123;page&#125;</span>个页面&#x27;</span>)</span><br><span class="line">    goods_ids = html.xpath(</span><br><span class="line">        <span class="string">&#x27;.//ul[@class=&quot;gl-warp clearfix&quot;]/li[@class=&quot;gl-item&quot;]/@data-sku&#x27;</span>)  <span class="comment"># 获取商品id号     作为页面的id号</span></span><br><span class="line">    goods_names_tag = html.xpath(<span class="string">&#x27;.//div[@class=&quot;p-name p-name-type-2&quot;]/a/em&#x27;</span>)  <span class="comment"># 提取商品标题</span></span><br><span class="line">    goods_prices = html.xpath(<span class="string">&#x27;.//div[@class=&quot;p-price&quot;]//i&#x27;</span>)  <span class="comment"># 提取商品价格</span></span><br><span class="line">    goods_stores_tag = html.xpath(<span class="string">&#x27;.//div[@class=&quot;p-shop&quot;]&#x27;</span>)  <span class="comment"># 提取店铺</span></span><br><span class="line">    goods_commits = html.xpath(<span class="string">&#x27;.//div[@class=&quot;p-commit&quot;]//a&#x27;</span>)  <span class="comment"># 提取评价</span></span><br><span class="line">    goods_names = []</span><br><span class="line">    <span class="keyword">for</span> goods_name <span class="keyword">in</span> goods_names_tag:</span><br><span class="line">        goods_names.append(goods_name.xpath(<span class="string">&#x27;string(.)&#x27;</span>).strip())</span><br><span class="line">    goods_stores = []</span><br><span class="line">    <span class="keyword">for</span> goods_store <span class="keyword">in</span> goods_stores_tag:</span><br><span class="line">        goods_stores.append(goods_store.xpath(<span class="string">&#x27;string(.)&#x27;</span>).strip())</span><br><span class="line">    goods_price = []</span><br><span class="line">    <span class="keyword">for</span> price <span class="keyword">in</span> goods_prices:</span><br><span class="line">        goods_price.append(price.xpath(<span class="string">&#x27;string(.)&#x27;</span>).strip())</span><br><span class="line">    goods_commit = []</span><br><span class="line">    <span class="keyword">for</span> commit <span class="keyword">in</span> goods_commits:</span><br><span class="line">        goods_commit.append(commit.xpath(<span class="string">&#x27;string(.)&#x27;</span>).strip())</span><br></pre></td></tr></table></figure>
<h4 id="3-6-数据入库">3.6 数据入库</h4>
<p>更改配置文件</p>
<ul>
<li>放开mongo注释</li>
<li>放开管道mongo注释</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> feapder <span class="keyword">import</span> Item</span><br><span class="line">	...</span><br><span class="line">item = Item()  <span class="comment"># 声明一个item</span></span><br><span class="line">item.table_name = <span class="string">&quot;test_mongo&quot;</span>  <span class="comment"># 指定存储的表名</span></span><br><span class="line">item.ID = goods_ids[i]</span><br><span class="line">item.标题 = goods_names[i]</span><br><span class="line">item.价格 =goods_price[i]</span><br><span class="line">item.店铺 = goods_stores[i]</span><br><span class="line"><span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure>
<h2 id="Scrapy-Redis-分布式">Scrapy-Redis 分布式</h2>
<h3 id="1-分布式概述">1 分布式概述</h3>
<h4 id="1-0-scrapy-redis是什么">1.0 scrapy-redis是什么</h4>
<p>之前我们已经学习了Scrapy，它是一个通用的爬虫框架，能够耗费很少的时间就能够写出爬虫代码</p>
<p>Scrapy-redis是scrapy的一个组件，它使用了Redis数据库做为基础，目的为了更方便地让Scrapy实现分布式爬取</p>
<p>Scrapy能做的事情很多，但是要做到大规模的分布式应用则捉襟见肘。有能人改变了Scrapy的队列调度，将起始的网址从start_urls里分离出来，改为从redis读取，多个客户端可以同时读取同一个redis，从而实现了分布式的爬虫。</p>
<h4 id="1-1-分布式简介">1.1 分布式简介</h4>
<p>分布式爬虫用一个共同的爬虫程序，同时部署到多台电脑上运行，这样可以 提高爬虫速度，实现分布式爬虫</p>
<p>大型分布式爬虫主要分为以下3个层级：分布式数据中心、分布式抓取服务器及分布式爬虫程序</p>
<p><strong>分布式爬虫的前提：</strong></p>
<ol>
<li>要保证每一台计算机都能够正常的执行scrapy命令，能够启动爬虫，这是对计算机硬件的最低水平、计算机系统环境和网络等多方面的基本需求，不再赘述。</li>
<li>要保证所有的爬虫程序可以访问同一个队列</li>
</ol>
<p><strong>分布式思路：</strong><br>
1.在存入数据的时候，我们可以规定一台电脑是主机，所有人都链接这个电脑数据库存入数据。<br>
2.数据都是重复的。—怎么让数据不重复，就可以实现分布式。</p>
<p>如果实现分布式，我们需要建立一个公共的区域，让多台电脑去公共区域里面拿任务，这个思想和多线程任务分配很像。</p>
<p>通过公共管理对象，来约束每一个相互独立的资源或者程序</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282033432.png" alt=""></p>
<ul>
<li><code>Master端</code>(核心服务器) ：使用 <code>ubuntu18</code>，搭建一个<code>Redis</code>数据库，不负责爬取，只负责<strong>url指纹判重、Request的分配，以及数据的存储</strong></li>
<li><code>Slaver端</code>(爬虫程序执行端) ：使用 <code>Mac OS X</code> 、<code>Ubuntu 18.04</code>, 负责执行爬虫程序，运行过程中提交新的<code>Request</code>给<code>Master</code></li>
</ul>
<h4 id="1-2-框架简介">1.2 框架简介</h4>
<h5 id="1-2-1-环境建设">1.2.1  环境建设</h5>
<ul>
<li>开源地址： <a target="_blank" rel="noopener" href="https://github.com/rmax/scrapy-redis.git">https://github.com/rmax/scrapy-redis.git</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip  install scrapy-redis</span><br></pre></td></tr></table></figure>
<ul>
<li>Scheduler</li>
<li>Duplication Filter</li>
<li>Item Pipline</li>
<li>Base Spider</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282033648.png" alt=""></p>
<p>如上图所示：scrapy-redis在scrapy的架构上增加了redis，基于redis特性增加了如下组件。</p>
<h5 id="1-2-2-scrapy-redis组件">1.2.2 scrapy-redis组件</h5>
<p><strong>1. Scheduler（调度）：</strong></p>
<p><code>scrapy</code>改造了<code>python</code>本来的<code>collection.deque</code>(双向队列)形成了自己<code>scrapy queue</code>，而<code>scrapy-redis</code> 的解决是把这个<code>scrapy queue</code>换成<code>redis</code>数据库，从同一个<code>redis-server</code>存放要爬取的<code>request</code>，便能让多个<code>spider</code>去同一个数据库里读取。</p>
<p>Scrapy中跟“待爬队列”直接相关的就是调度器<code>Scheduler</code>，它负责对新的request进行入列操作（加入Scrapy queue），取出下一个要爬取的request（从Scrapy queue中取出）等操作。它把待爬队列按照优先级建立了一个字典结构，比如：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    优先级<span class="number">0</span> : 队列0</span><br><span class="line">    优先级<span class="number">1</span> : 队列1</span><br><span class="line">    优先级<span class="number">2</span> : 队列2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后根据request中的优先级，来决定该入哪个队列，出列时则按优先级较小的优先出列。为了管理这个比较高级的队列字典，Scheduler需要提供一系列的方法。但是原来的Scheduler已经无法使用，所以使用Scrapy-redis的scheduler组件。</p>
<p><strong>2. Duplication Filter（去重）：</strong></p>
<p>Scrapy中用集合实现这个request去重功能，Scrapy中把已经发送的request指纹放入到一个集合中，把下一个request的指纹拿到集合中比对，如果该指纹存在于集合中，说明这个request发送过了，如果没有则继续操作。这个核心的判重功能是这样实现的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">request_seen</span>(<span class="params">self, request</span>):</span><br><span class="line">    <span class="comment"># self.request_figerprints就是一个指纹集合  </span></span><br><span class="line">    fp = <span class="variable language_">self</span>.request_fingerprint(request)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这就是判重的核心操作  </span></span><br><span class="line">    <span class="keyword">if</span> fp <span class="keyword">in</span> <span class="variable language_">self</span>.fingerprints:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="variable language_">self</span>.fingerprints.add(fp)</span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>.file:</span><br><span class="line">        <span class="variable language_">self</span>.file.write(fp + os.linesep)</span><br></pre></td></tr></table></figure>
<p>在scrapy-redis中去重是由<code>Duplication Filter</code>组件来实现的，它通过redis的set 不重复的特性，巧妙的实现了Duplication Filter去重。scrapy-redis调度器从引擎接受request，将request的指纹存⼊redis的set检查是否重复，并将不重复的request push写⼊redis的 request queue。</p>
<p>引擎请求request(Spider发出的）时，调度器从redis的request queue队列⾥里根据优先级pop 出⼀个request 返回给引擎，引擎将此request发给spider处理。</p>
<p><strong>3. Item Pipline（管道）：</strong></p>
<p>引擎将(Spider返回的)爬取到的Item给<code>Item Pipeline</code>，<code>scrapy-redis</code> 的<code>Item Pipeline</code>将爬取到的 <code>Item </code>存⼊<code>redis</code>的<code> items queue</code>。</p>
<p>修改过<code>Item Pipeline</code>可以很方便的根据<code>key</code>从<code>items queue</code>提取<code>item</code>，从而实现 <code>items processes</code>集群。</p>
<p><strong>4. Base Spider（爬虫）：</strong></p>
<p>不再使用<code>scrapy</code>原有的<code>Spider</code>类，重写的<code>RedisSpider</code>继承了<code>Spider</code>和<code>RedisMixin</code>这两个类，<code>RedisMixin</code>是用来从<code>redis</code>读取<code>url</code>的类。</p>
<p>当我们生成一个Spider继承RedisSpider时，调用setup_redis函数，这个函数会去连接redis数据库，然后会设置signals(信号)：</p>
<ul>
<li>一个是当spider空闲时候的signal，会调用spider_idle函数，这个函数调用<code>schedule_next_request</code>函数，保证spider是一直活着的状态，并且抛出DontCloseSpider异常。</li>
<li>一个是当抓到一个item时的signal，会调用item_scraped函数，这个函数会调用<code>schedule_next_request</code>函数，获取下一个request。</li>
</ul>
<h3 id="2-分布式配置">2 分布式配置</h3>
<h4 id="2-1-redis配置">2.1 redis配置</h4>
<p>默认情况下，Redis服务值运行本地电脑访问，即Redis运行在哪台电脑就只允许这台电脑上的软件连接试用它</p>
<p>既然我们要做分布式爬取，就意味着别的电脑也需要访问Redis，因此需要对Redis进行配置</p>
<p>配置参考地址：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/masonblog/p/12726914.html">https://www.cnblogs.com/masonblog/p/12726914.html</a></p>
<ol>
<li>
<p>别忘了修改爬虫的配置文件<code>settings.py</code>，将Redis服务器地址改为你运行Redis的服务器的ip</p>
</li>
<li>
<p>服务器安装：<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_60028455/article/details/125316625">https://blog.csdn.net/m0_60028455/article/details/125316625</a></p>
</li>
</ol>
<h4 id="2-2-核心配置">2.2 核心配置</h4>
<p>首先最主要的是，需要将调度器的类和去重的类替换为 <code>Scrapy-Redis </code>提供的类，在 <code>settings.py</code> 里面添加如下配置即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SCHEDULER = <span class="string">&quot;scrapy_redis.scheduler.Scheduler&quot;</span></span><br><span class="line">DUPEFILTER_CLASS = <span class="string">&quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span></span><br></pre></td></tr></table></figure>
<p>直接在 <code>settings.py</code> 里面配置为 <code>REDIS_URL</code> 变量即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis://[:password]@host:port/db</span><br><span class="line"></span><br><span class="line">REDIS_URL = <span class="string">&#x27;redis://172.25.197.89:6379/0&#x27;</span></span><br></pre></td></tr></table></figure>
<h5 id="2-2-1-配置调度队列">2.2.1 配置调度队列</h5>
<p>此项配置是可选的，默认使用 <code>PriorityQueue</code>。如果想要更改配置，可以配置 SCHEDULER_QUEUE_CLASS 变量，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SCHEDULER_QUEUE_CLASS = <span class="string">&#x27;scrapy_redis.queue.PriorityQueue&#x27;</span>  <span class="comment"># 使用有序集合来存储</span></span><br><span class="line">SCHEDULER_QUEUE_CLASS = <span class="string">&#x27;scrapy_redis.queue.FifoQueue&#x27;</span>  <span class="comment"># 先进先出</span></span><br><span class="line">SCHEDULER_QUEUE_CLASS = <span class="string">&#x27;scrapy_redis.queue.LifoQueue&#x27;</span>  <span class="comment"># 先进后出、后进先出</span></span><br></pre></td></tr></table></figure>
<h5 id="2-2-2-配置持久化">2.2.2 配置持久化</h5>
<p>此配置是可选的，默认是 False。Scrapy-Redis 默认会在爬取全部完成后清空爬取队列和去重指纹集合。</p>
<p>如果不想自动清空爬取队列和去重指纹集合，可以增加如下配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SCHEDULER_PERSIST = <span class="literal">True</span>   <span class="comment"># 底层 就是监听爬虫信号  触发redis指令 清空数据库</span></span><br></pre></td></tr></table></figure>
<h5 id="2-2-3-配置重爬">2.2.3 配置重爬</h5>
<p>此配置是可选的，默认是 False。如果配置了持久化或者强制中断了爬虫，那么爬取队列和指纹集合不会被清空，爬虫重新启动之后就会接着上次爬取。如果想重新爬取，我们可以配置重爬的选项</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SCHEDULER_FLUSH_ON_START = <span class="literal">True</span>  </span><br></pre></td></tr></table></figure>
<p>这样将 SCHEDULER_FLUSH_ON_START 设置为 True 之后，爬虫每次启动时，爬取队列和指纹集合都会清空。所以要做分布式爬取，我们必须保证只能清空一次，否则每个爬虫任务在启动时都清空一次，就会把之前的爬取队列清空，势必会影响分布式爬取。</p>
<p><strong>scrapy-redis键名介绍</strong></p>
<hr>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282033286.png" alt="img"></p>
<h3 id="3-项目实战">3 项目实战</h3>
<h4 id="3-1-目标地址">3.1 目标地址</h4>
<ul>
<li>首页:<a target="_blank" rel="noopener" href="http://gz.jumei.com/">http://gz.jumei.com/</a></li>
<li>数据:<a target="_blank" rel="noopener" href="http://search.jumei.com/?filter=0-11-1&amp;search=%E4%BF%9D%E6%B9%BF&amp;from=search_toplist_%E4%BF%9D%E6%B9%BF_word_pos_1&amp;cat=">http://search.jumei.com/?filter=0-11-1&amp;search=保湿&amp;from=search_toplist_保湿_word_pos_1&amp;cat=</a></li>
</ul>
<h4 id="3-2-项目分析">3.2 项目分析</h4>
<p>数据页面，从图可以看出，数据全在html页面里面，可以使用xpath进行提取</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="C:/Users/XL/AppData/Roaming/Typora/typora-user-images/image-20220919130329632.png" alt="image-20220919130329632"></p>
<h4 id="3-3-项目结构">3.3 项目结构</h4>
<p><strong>改写spider文件</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> scrapy_redis.spiders <span class="keyword">import</span> RedisSpider</span><br><span class="line"><span class="keyword">from</span> jmyp.items <span class="keyword">import</span> JmypItem</span><br><span class="line"><span class="keyword">from</span> scrapy_redis.dupefilter <span class="keyword">import</span> RFPDupeFilter</span><br><span class="line"><span class="keyword">from</span> scrapy_redis.scheduler <span class="keyword">import</span> Scheduler</span><br><span class="line"><span class="keyword">from</span> scrapy_redis.queue <span class="keyword">import</span> PriorityQueue,LifoQueue,FifoQueue</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MmSpider</span>(<span class="title class_ inherited__">RedisSpider</span>):</span><br><span class="line">    name = <span class="string">&#x27;mm&#x27;</span></span><br><span class="line">    <span class="comment"># allowed_domains = [&#x27;jumei.com&#x27;]</span></span><br><span class="line">    <span class="comment"># start_urls = [&#x27;http://gz.jumei.com/&#x27;]</span></span><br><span class="line">    <span class="comment"># keyword = [&#x27;保湿&#x27;,&#x27;香水&#x27;]</span></span><br><span class="line">    redis_key = <span class="string">&#x27;lisi&#x27;</span></span><br><span class="line">    <span class="comment"># lpush lisi http://search.jumei.com/?filter=0-11-1&amp;search=香水</span></span><br><span class="line">    <span class="comment"># def start_requests(self):</span></span><br><span class="line">    <span class="comment">#     for i in self.keyword[1:]:</span></span><br><span class="line">    <span class="comment">#         url = f&#x27;http://search.jumei.com/?filter=0-11-1&amp;search=&#123;i&#125;&#x27;</span></span><br><span class="line">    <span class="comment">#         yield scrapy.Request(url=url)</span></span><br><span class="line"></span><br><span class="line">    rules = &#123;</span><br><span class="line">        <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;.//div[@class=&quot;s_l_name&quot;]/a//text()&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;price&#x27;</span>: <span class="string">&#x27;.//div[@class=&quot;search_list_price&quot;]/span/text()&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;link&#x27;</span>: <span class="string">&#x27;.//div[@class=&quot;s_l_pic&quot;]/a/@href&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        html = etree.HTML(response.text)</span><br><span class="line">        good_list = html.xpath(<span class="string">&#x27;//div[@class=&quot;products_wrap&quot;]/ul/li&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> good_list[<span class="number">1</span>:<span class="number">3</span>]:</span><br><span class="line">            items = JmypItem()</span><br><span class="line">            <span class="comment"># items = &#123;&#125;</span></span><br><span class="line">            items[<span class="string">&#x27;title&#x27;</span>] = <span class="variable language_">self</span>.get_title(data)</span><br><span class="line">            items[<span class="string">&#x27;price&#x27;</span>] = <span class="variable language_">self</span>.get_price(data)</span><br><span class="line">            items[<span class="string">&#x27;link&#x27;</span>] = <span class="variable language_">self</span>.get_link(data)</span><br><span class="line">            <span class="comment"># print(items)</span></span><br><span class="line">            <span class="keyword">yield</span> items</span><br><span class="line"></span><br><span class="line">        <span class="built_in">next</span> = html.xpath(<span class="string">&#x27;//ul[@class=&quot;page-nav&quot;]/li[@class=&quot;last&quot;]&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">next</span>:</span><br><span class="line">            page = <span class="string">&#x27;&#x27;</span>.join(html.xpath(<span class="string">&#x27;//a[@class=&quot;next&quot;]/@href&#x27;</span>))</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url=page)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_title</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="comment"># 标题</span></span><br><span class="line">        title = <span class="string">&#x27;&#x27;</span>.join(x.xpath(<span class="variable language_">self</span>.rules[<span class="string">&#x27;title&#x27;</span>])).strip()</span><br><span class="line">        <span class="keyword">return</span> title</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_price</span>(<span class="params">self,x</span>):</span><br><span class="line">        price = <span class="string">&#x27;&#x27;</span>.join(x.xpath(<span class="variable language_">self</span>.rules[<span class="string">&#x27;price&#x27;</span>]))</span><br><span class="line">        <span class="keyword">return</span> price</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_link</span>(<span class="params">self,x</span>):</span><br><span class="line">        link = <span class="string">&#x27;&#x27;</span>.join(x.xpath(<span class="variable language_">self</span>.rules[<span class="string">&#x27;link&#x27;</span>]))</span><br><span class="line">        <span class="keyword">return</span> link</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>item文件编写</strong></p>
<ul>
<li>编写item文件，定义数据结构</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JmypItem</span>(scrapy.Item):</span><br><span class="line">    <span class="comment"># define the fields for your item here like:</span></span><br><span class="line">    <span class="comment"># name = scrapy.Field()</span></span><br><span class="line">    title = scrapy.Field()</span><br><span class="line">    price = scrapy.Field()</span><br><span class="line">    link = scrapy.Field()</span><br></pre></td></tr></table></figure>
<p><strong>scrapy-redis 改写</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">    <span class="string">&#x27;jmyp.pipelines.JmypPipeline&#x27;</span>: <span class="number">290</span>,</span><br><span class="line">    <span class="string">&#x27;scrapy_redis.pipelines.RedisPipeline&#x27;</span>: <span class="number">300</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 指定使用scrapy-redis的去重</span></span><br><span class="line">DUPEFILTER_CLASS = <span class="string">&#x27;scrapy_redis.dupefilters.RFPDupeFilter&#x27;</span></span><br><span class="line"><span class="comment"># 指定使用scrapy-redis的调度器</span></span><br><span class="line">SCHEDULER = <span class="string">&quot;scrapy_redis.scheduler.Scheduler&quot;</span></span><br><span class="line"><span class="comment"># 默认的 按优先级排序(Scrapy默认)，由sorted set实现的一种非FIFO、LIFO方式。</span></span><br><span class="line">SCHEDULER_QUEUE_CLASS = <span class="string">&#x27;scrapy_redis.queue.SpiderPriorityQueue&#x27;</span></span><br><span class="line"><span class="comment"># redis连接</span></span><br><span class="line">REDIS_URL = <span class="string">&#x27;redis://172.25.197.89:6379/0&#x27;</span></span><br><span class="line"><span class="comment">#默认情况下,RFPDupeFilter只记录第一个重复请求。将DUPEFILTER_DEBUG设置为True会记录所有重复的请求。</span></span><br><span class="line">DUPEFILTER_DEBUG =<span class="literal">True</span></span><br><span class="line"><span class="comment"># 在redis中保持scrapy-redis用到的各个队列，从而允许暂停和暂停后恢复，也就是不清理redis queues</span></span><br><span class="line">SCHEDULER_PERSIST = <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p><strong>数据保存到mongo</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="keyword">from</span> jmyp.items <span class="keyword">import</span> JmypItem</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JmypPipeline</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        collection = pymongo.MongoClient()</span><br><span class="line">        <span class="variable language_">self</span>.conn = collection[<span class="string">&#x27;xxx&#x27;</span>][<span class="string">&#x27;xx&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(item, JmypItem):</span><br><span class="line">            <span class="variable language_">self</span>.conn.insert_one(<span class="built_in">dict</span>(item))</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
<p><strong>Scrapy-redis框架执行过程总结：</strong></p>
<ol>
<li>最后总结一下scrapy-redis的总体思路：这套组件通过重写scheduler和 spider类，实现了调度、spider启动和redis的交互。</li>
<li>实现新的dupefilter和queue类，达到了判重和调度容器和redis 的交互，因为每个主机上的爬虫进程都访问同一个redis数据库，所以调度和判重都统一进行统一管理，达到了分布式爬虫的目的。</li>
<li>当spider被初始化时，同时会初始化一个对应的scheduler对象，这个调度器对象通过读取settings，配置好自己的调度容器queue和判重工具dupefilter。</li>
<li>每当一个spider产出一个request的时候，scrapy引擎会把这个reuqest递交给这个spider对应的scheduler对象进行调度，scheduler对象通过访问redis对request进行判重，如果不重复就把他添加进redis中的调度器队列里。当调度条件满足时，scheduler对象就从redis的调度器队列中取出一个request发送给spider，让他爬取。</li>
<li>当spider爬取的所有暂时可用url之后，scheduler发现这个spider对应的redis的调度器队列空了，于是触发信号spider_idle，spider收到这个信号之后，直接连接redis读取start_urls池，拿取新的一批url入口，然后再次重复上边的工作。</li>
</ol>
<h3 id="4-扩展方面">4 扩展方面</h3>
<p>redis地址</p>
<ul>
<li>redis服务：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42405819/article/details/125711224">https://blog.csdn.net/weixin_42405819/article/details/125711224</a></li>
<li>redis可视化：<a target="_blank" rel="noopener" href="https://goanother.com/cn/#download">https://goanother.com/cn/#download</a></li>
</ul>
<p>子系统安装：<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_60028455/article/details/125316625">https://blog.csdn.net/m0_60028455/article/details/125316625</a></p>
<p><strong>注：</strong></p>
<ul>
<li>
<p>新的ubuntu在本地连接，需要安装ssh服务端</p>
</li>
<li>
<p>本课程练习，需要在服务器安装redis</p>
</li>
<li>
<p>解释器：<a target="_blank" rel="noopener" href="https://docs.conda.io/en/latest/miniconda.html#">https://docs.conda.io/en/latest/miniconda.html#</a></p>
</li>
</ul>
<h2 id="爬虫项目部署">爬虫项目部署</h2>
<p>前期工作</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">虚拟机安装（里面的镜像适用vm16）</span><br><span class="line"><span class="comment"># xshell  下载</span></span><br><span class="line">链接：https:<span class="regexp">//</span>pan.baidu.com<span class="regexp">/s/</span><span class="number">1</span>Y44erVDYgScE_fAEDhLAnQ</span><br><span class="line">提取码：fyum</span><br><span class="line">里面的</span><br><span class="line">    用户名  tuling   密码 root</span><br><span class="line">    mysql  用户名  root  密码 root</span><br></pre></td></tr></table></figure>
<h3 id="1-脚本文件部署">1 脚本文件部署</h3>
<p><code>linux</code>内置的<code>cron</code>进程能帮我们实现这些需求，<code>cron</code>搭配<code>shell</code>脚本，非常复杂的指令也没有问题。</p>
<h4 id="1-1-crontab的使用">1.1 <code>crontab</code>的使用</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">crontab [-u username]　　　　//省略用户表表示操作当前用户的crontab</span><br><span class="line">    -e      (编辑工作表)</span><br><span class="line">    -l      (列出工作表里的命令)</span><br><span class="line">    -r      (删除工作)</span><br></pre></td></tr></table></figure>
<p>我们用<strong>crontab -e</strong>进入当前用户的工作表编辑，是常见的vim界面。每行是一条命令。</p>
<p><code>crontab</code>的命令构成为 时间+动作，其时间有<strong>分、时、日、月、周</strong>五种，操作符有</p>
<ul>
<li>***** 取值范围内的所有数字</li>
<li><strong>/</strong> 每过多少个数字</li>
<li><strong>-</strong> 从X到Z</li>
<li>**，**散列数字</li>
</ul>
<table>
<thead>
<tr>
<th>代表意义</th>
<th>分钟</th>
<th>小时</th>
<th>日期</th>
<th>月份</th>
<th>周</th>
<th>命令</th>
</tr>
</thead>
<tbody>
<tr>
<td>数字范围</td>
<td>0~59</td>
<td>0~23</td>
<td>1~31</td>
<td>1~12</td>
<td>0~6</td>
<td>就命令</td>
</tr>
</tbody>
</table>
<h4 id="1-2-为当前用户创建cron服务">1.2  <strong>为当前用户创建<code>cron</code>服务</strong></h4>
<ul>
<li>可以键入 <code>crontab -e </code>编辑<code>crontab</code>服务文件</li>
</ul>
<p><strong>举例：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * *      <span class="comment">#每分钟都执行    </span></span><br></pre></td></tr></table></figure>
<p><strong>实例1:每5分钟执行一次文档写入</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/<span class="number">1</span> * * * * echo <span class="string">&#x27;hello world&#x27;</span> &gt;&gt; /home/poppies/Documents/xialuo/demo/demo.txt</span><br></pre></td></tr></table></figure>
<p><strong>实例2：每小时的第3和第15分钟执行</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span>,<span class="number">15</span> * * * *  echo <span class="string">&#x27;hello world&#x27;</span> &gt;&gt; /home/xxoo/demo/demo.log		</span><br></pre></td></tr></table></figure>
<p><strong>实例：在上午8点的20分钟执行</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span> <span class="number">8</span> * * * myCommand  </span><br></pre></td></tr></table></figure>
<h4 id="1-3-单个脚本使用定时任务部署">1.3  单个脚本使用定时任务部署</h4>
<h5 id="1-3-1-上传本地文件到服务器">1.3.1 上传本地文件到服务器</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp /path/filename username@servername:/path</span><br><span class="line">scp env_ps.py poppies@<span class="number">192.168</span><span class="number">.65</span><span class="number">.234</span>:/home/poppies/Documents/xialuo/demo</span><br></pre></td></tr></table></figure>
<h5 id="1-3-2-定时采集任务">1.3.2 定时采集任务</h5>
<p>1、使用定时任务启动 每5分钟采集一次数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/<span class="number">5</span> * * * *  python /home/poppies/Documents/xialuo/ps/env_ps.py spider &gt;&gt; /home/poppies/Documents/xialuo/demo/demo.log</span><br></pre></td></tr></table></figure>
<h3 id="2-使用scrapyd部署">2 使用<code>scrapyd</code>部署</h3>
<h4 id="2-1-环境安装-2">2.1 环境安装</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install scrapyd</span><br><span class="line">pip install scrapyd-client</span><br></pre></td></tr></table></figure>
<p>官网：<a target="_blank" rel="noopener" href="https://scrapyd.readthedocs.io/en/stable/overview.html">https://scrapyd.readthedocs.io/en/stable/overview.html</a></p>
<p>由于<code>window</code>兼容性问题，所以<code>scrapyd-deploy</code>无法支持</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\software\inters\python3\Scripts</span><br></pre></td></tr></table></figure>
<p>修改 <code>scrapyd-deploy.bat</code>格式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@echo off</span></span><br><span class="line"><span class="string">&quot;D:\software\inters\python3\Scripts\python.exe&quot;</span> <span class="string">&quot;D:\software\inters\python3\Scripts\scrapyd-deploy&quot;</span> % *</span><br></pre></td></tr></table></figure>
<p>执行 <code>scrapyd-deploy -l</code> 看到以下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282034623.png" alt="image-20220921163146603"></p>
<p>​</p>
<h4 id="2-2-查询状态">2.2 <strong>查询状态</strong></h4>
<p>这个接口负责查看 <code>Scrapyd</code> 当前服务和任务的状态，我们可以用 <code>curl </code>命令来请求这个接口，命令如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6800</span>/daemonstatus.json </span><br></pre></td></tr></table></figure>
<h4 id="2-3-爬虫部署">2.3 爬虫部署</h4>
<p>1、把原先注释掉的<code>url</code>那一行取消注释，这个就是我们要部署到目标服务器的地址，<br>
2、 把[deploy]这里改为[deploy:xl]，这里是命名为xl，命名可以任意怎么都可以，只要能标识出来项目就可以。<br>
下边的project 就是我们的工程名，到此配置文件更改完成。</p>
<h5 id="2-3-1-发布项目">2.3.1 发布项目</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里target 为你的服务器命令，prject是你工程的名字，发布工程之前我们的scrapyd.cfg必须修改</span></span><br><span class="line"><span class="comment"># scrapyd-deploy 部署名 -p 工程名称</span></span><br><span class="line">scrapyd-deploy xl -p xialuo</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-启动爬虫">2.3.2 <strong>启动爬虫</strong></h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PROJECT_NAME填入你爬虫工程的名字，SPIDER_NAME填入你爬虫的名字</span></span><br><span class="line">curl http://localhost:<span class="number">6800</span>/schedule.json -d project=xialuo -d spider=ps          </span><br></pre></td></tr></table></figure>
<h5 id="2-3-3-停止爬虫">2.3.3 <strong>停止爬虫</strong></h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:<span class="number">6800</span>/cancel.json -d project=huya -d job=86a3dd29d51811eca18f000ec6599497</span><br></pre></td></tr></table></figure>
<h5 id="2-3-4-查看当前项目">2.3.4 查看当前项目</h5>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:6800/listprojects.json</span><br></pre></td></tr></table></figure>
<h5 id="2-3-4-查看详情">2.3.4 <strong>查看详情</strong></h5>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:6800/listjobs.json?project=xialuo</span><br></pre></td></tr></table></figure>
<h5 id="2-3-5-交互调试">2.3.5 交互调试</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">data = &#123;&#125;</span><br><span class="line">data[<span class="string">&#x27;project&#x27;</span>] = <span class="string">&#x27;huya&#x27;</span></span><br><span class="line">data[<span class="string">&#x27;spider&#x27;</span>] = <span class="string">&#x27;hh&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://127.0.0.1:6800/schedule.json&#x27;</span>  <span class="comment"># 开启爬虫接口</span></span><br><span class="line">res = requests.post(url,data)</span><br><span class="line">res.json()  <span class="comment"># 获取数据   返回jobid</span></span><br><span class="line"><span class="built_in">print</span>(res.json())</span><br><span class="line"><span class="comment"># 1b51dd0ac37e11ea8543000c29c350ab</span></span><br><span class="line"><span class="comment"># 停止</span></span><br><span class="line">datas = &#123;&#125;</span><br><span class="line">datas[<span class="string">&#x27;project&#x27;</span>] = <span class="string">&#x27;xialuo&#x27;</span></span><br><span class="line">datas[<span class="string">&#x27;job&#x27;</span>] = res.json()[<span class="string">&#x27;jobid&#x27;</span>]</span><br><span class="line">res = requests.post(<span class="string">&#x27;http://127.0.0.1:6800/cancel.json&#x27;</span>,data)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(requests.get(<span class="string">&#x27;http://localhost:6800/listjobs.json?project=huya&#x27;</span>).text)</span><br></pre></td></tr></table></figure>
<h3 id="3-Gerapy爬虫部署">3 <code>Gerapy</code>爬虫部署</h3>
<p>​		是一个<strong>基于<code>Scrapyd</code>，<code>Scrapyd API</code>，<code>Django</code>，<code>Vue.js</code>搭建的分布式爬虫管理框架</strong>。简单点说，就是用上述的<code>Scrapyd</code>工具是在命令行进行操作，而<code>Gerapy</code>将命令行和图形界面进行了对接，我们只需要点击按钮就可完成部署，启动，停止，删除的操作。</p>
<h4 id="3-1-环境安装">3.1 <strong>环境安装</strong></h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install gerapy</span><br></pre></td></tr></table></figure>
<p>一、创建新项目</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">　gerapy init</span><br></pre></td></tr></table></figure>
<p>二、对数据库初始化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gerapy migrate      <span class="comment">#   gerapy ==&gt; python manage.py</span></span><br></pre></td></tr></table></figure>
<p>三、启动gerapy服务</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gerapy runserver</span><br></pre></td></tr></table></figure>
<p>四、创建用户名密码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gerapy createsuperuser </span><br></pre></td></tr></table></figure>
<h4 id="3-2-项目部署">3.2 项目部署</h4>
<h5 id="3-2-1-界面展示">3.2.1  界面展示</h5>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282034438.png" alt="image-20220921213145605"></p>
<h5 id="3-2-2-爬虫部署">3.2.2 爬虫部署</h5>
<p>1、打包上传</p>
<p>2、复制代码到包即可</p>
<h3 id="4-docker容器">4 docker容器</h3>
<h4 id="4-1-docker简介">4.1 docker简介</h4>
<p>打包：docker打包就是把软件运行需要的依赖、第三方库、软件打包放到一起，变成一个安装包</p>
<p>分发：可以把打包的安装包上传到仓库、其他人可以下载使用</p>
<p>部署：就是把安装包使用命令运行起来你的应用，自动模拟环境。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Docker是开发人员和系统管理员使用容器开发、部署和运行应用程序的平台。使用Linux容器来部署应用程序称为集装箱化。使用docker轻松部署应用程序</span><br></pre></td></tr></table></figure>
<p>集装箱化的优点：</p>
<ul>
<li>灵活：即使是复杂的应用程序也可封装。</li>
<li>轻量级：容器利用并共享主机内核。</li>
<li>便携式：您可以在本地构建，部署到云上并在任何地方运行。</li>
<li>可扩展性：您可以增加和自动分发容器副本。</li>
<li>可堆叠：您可以垂直堆叠服务并及时并及时堆叠服务。</li>
</ul>
<h4 id="4-2-虚拟机virtual-machine">4.2 虚拟机virtual machine</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">虚拟机(<span class="keyword">virtual</span> machine)就是带环境安装的一种解决方案。它可以在一种操作系统里面运行另一种操作系统，比如在Windows系统里面运行Linux系统。应用程序对此毫无感知，因为虚拟机看上去跟真丝系统一模一样，而对于底层系统来说，虚拟机就是一个普通文件，不需要了就删掉，对其它部分毫无影响。</span><br></pre></td></tr></table></figure>
<p><strong>虚拟机的缺点：</strong></p>
<ul>
<li>**资源占用多：**虚拟机会独占一部分内存和硬盘空间。它运行的时候，其他程序就不能使用这些资源了。哪怕虚拟机里面的应用程序，真正使用的内存只有1M，虚拟机依然需要几百MB的内容才能运行。</li>
<li>**冗余步骤多：**虚拟机是完整的操作系统，一些系统级别的操作步骤，往往无法跳过，比如用户登录。</li>
<li>**启动慢：**启动操作系统需要多久，启动虚拟机就需要多久。可能要等几分钟，应用陈故乡才能真正运行。</li>
</ul>
<h4 id="4-3-容器和虚拟机比较">4.3 容器和虚拟机比较</h4>
<p>一个容器中运行原生Linux和共享主机与其它容器的内核，它运行一个独立的进程，不占用任何其它可执行文件的内存，使其轻量化。</p>
<p>相比之下，虚拟机(VM)运行一个完整的“客户”操作系统，通过虚拟机管理程序虚拟访问主机资源。一般来说，虚拟机提供的环境比大多数应用程序需要的资源多。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282034012.png" alt=""></p>
<ul>
<li>dockerfile       就是源代码</li>
<li>image          镜像   可执行的程序   ubuntu  mysql  redis    nginx   elesticsearch   网站打包成镜像</li>
<li>container    运行的进程</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">磁盘空间使用：docker根据镜像层决定，一般很小几十KB，而虚拟机一般GB单位</span><br><span class="line">性能（相比于宿主机）：docker依附宿主机所以性能接近，但是虚拟机比原主机差</span><br><span class="line">资源利用率：docker资源理由率高，虚拟机低</span><br><span class="line">隔离性：两者都是安全隔离</span><br><span class="line">运行状态：docker直接在宿主机内核上运行，而虚拟机运行在隔离层Hypervisior</span><br><span class="line">并发：docker可起到上千个容器，而虚拟机相对厚重，最多启动几十个</span><br><span class="line">运行速度：docker优于虚拟机</span><br></pre></td></tr></table></figure>
<p>学习地址：<a target="_blank" rel="noopener" href="https://www.runoob.com/docker/docker-tutorial.html">https://www.runoob.com/docker/docker-tutorial.html</a></p>
<h4 id="4-4-docker安装">4.4 docker安装</h4>
<p>下载地址：</p>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/desktop/install/ubuntu/">https://docs.docker.com/desktop/install/ubuntu/</a></p>
</li>
</ul>
<p>卸载旧版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker  docker-common docker-selinux docker-engine</span><br></pre></td></tr></table></figure>
<p>安装</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2 &amp;&amp; python2 /usr/<span class="built_in">bin</span>/yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo &amp;&amp; yum install docker-ce -y</span><br></pre></td></tr></table></figure>
<p>启动</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>
<h4 id="4-5-镜像使用">4.5 镜像使用</h4>
<h5 id="4-5-0-镜像查找">4.5.0 镜像查找</h5>
<p>官方地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker pull ubuntu</span></span><br></pre></td></tr></table></figure>
<h5 id="4-5-1-镜像列举">4.5.1 镜像列举</h5>
<p><strong>docker images</strong> 来列出本地主机上的镜像。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282034439.png" alt="image-20220922194002270"></p>
<p>各个选项说明:</p>
<ul>
<li>**REPOSITORY：**表示镜像的仓库源</li>
<li>**TAG：**镜像的标签</li>
<li>**IMAGE ID：**镜像ID</li>
<li>**CREATED：**镜像创建时间</li>
<li>**SIZE：**镜像大小</li>
</ul>
<h5 id="4-5-2-获取一个新的镜像">4.5.2 获取一个新的镜像</h5>
<p>当我们在本地主机上使用一个不存在的镜像时 Docker 就会自动下载这个镜像。如果我们想预先下载这个镜像，我们可以使用 docker pull 命令来下载它。</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker pull ubuntu</span></span><br></pre></td></tr></table></figure>
<h5 id="4-5-3-查找镜像">4.5.3 查找镜像</h5>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker search ubuntu</span></span><br></pre></td></tr></table></figure>
<h5 id="4-5-4-删除镜像">4.5.4 删除镜像</h5>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker rmi ubuntu</span></span><br></pre></td></tr></table></figure>
<h4 id="4-6-容器使用">4.6 容器使用</h4>
<h5 id="4-6-2-容器操作">4.6.2 容器操作</h5>
<p>以下命令使用 ubuntu 镜像启动一个容器，参数为以命令行模式进入该容器：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> -<span class="keyword">it</span> ubuntu /bin/bash</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li><strong>-i</strong>: 交互式操作。</li>
<li><strong>-t</strong>: 终端。</li>
<li><strong>ubuntu</strong>: ubuntu 镜像。</li>
<li><strong>/bin/bash</strong>：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。</li>
</ul>
<p>查看所有的容器命令如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -<span class="selector-tag">a</span></span><br></pre></td></tr></table></figure>
<p>使用 docker start 启动一个已停止的容器：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start <span class="tag">&lt;<span class="name">容器</span> <span class="attr">ID</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用 docker stop 停止一个容器：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop &lt;容器 ID&gt;</span><br></pre></td></tr></table></figure>
<p><strong>exec 命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it  &lt;容器 ID&gt; /bin/bash</span><br></pre></td></tr></table></figure>
<p>删除容器</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> <span class="operator">-f</span>  &lt;容器 ID&gt;</span><br></pre></td></tr></table></figure>
<p>运行一个 web 应用</p>
<ul>
<li>我们将在docker容器中运行一个 Python Flask 应用来运行一个web应用</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span>  docker pull training/webapp </span><br><span class="line"><span class="built_in">sudo</span> docker run -d -P training/webapp python app.py</span><br></pre></td></tr></table></figure>
<p>参数说明:</p>
<ul>
<li>**-d:**让容器在后台运行。</li>
<li>**-P:**将容器内部使用的网络端口随机映射到我们使用的主机上。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302282034440.png" alt="image-20220922193414906"></p>
<p><strong>注</strong>：Docker 开放了 5000 端口（默认 Python Flask 端口）映射到主机端口 49153上。</p>
<p>这时我们可以通过浏览器访问<code>http://192.168.65.232:49153/</code></p>
<p>我们也可以通过 -p 参数来设置不一样的端口：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run -itd -p 宿主机ip:宿主机端口:容器端口 --name 容器名 镜像名 /bin/bash</span></span><br><span class="line">sudo docker run -d -p <span class="number">5000</span>:<span class="number">5000</span> training/webapp python app.py</span><br></pre></td></tr></table></figure>
<p><strong>注</strong>：容器内部的 5000 端口映射到我们本地主机的 5000 端口上。</p>
<h3 id="5-爬虫简历分享">5 爬虫简历分享</h3>
<p><strong>简历的作用：</strong></p>
<p>1.通过简历筛选关，获得笔面试资格</p>
<p>2.面试时，简历是面试官与你交谈的基础</p>
<p><strong>通过简历筛选</strong>：</p>
<p><strong>一、简历主要筛选哪些项</strong></p>
<p><strong>1.关键技能是否匹配</strong></p>
<pre><code>关键技能的匹配项是否足够。

比如要求：爬虫设计，数据库，自动化工具，网络抓包工具，逆向分析能力
</code></pre>
<p><strong>2.项目经验要求</strong></p>
<p>​	 年限要求</p>
<p>​	 相应行业，相应项目。比如 电商行业、金融行业、旅游行业</p>
<p>​	 有的有 做过XXX的优先</p>
<p><strong>3.学历</strong></p>
<p><strong>4.跳槽频率</strong></p>
<p><strong>5.简历亮点</strong></p>
<p><strong>总结：</strong></p>
<p>投不同公司的不同职位，先了解该职位的技能要求和公司的行业属性。</p>
<p>修改技能，让关键技能更匹配。</p>
<p>把与公司行业相关的项目经验重点描述与位置提前。</p>
<p><strong>项目经验写法：</strong></p>
<p>主要展示你工作经验足（做的项目多，做的项目类型多（电商 旅游 工商等等都抓过。APP 网页都抓过））</p>
<p>细化你个人技能中描述的技能，加以佐证你的个人技能。</p>
<p>重复项目建议合并。（同类型的（比如天眼查/企查查）、（技能重复的合并 几年经验项目全都是一个技能栈 会被认为没长进）</p>
<p><strong>每个项目的措辞：</strong></p>
<p>每一个项目写成一个3-5句逻辑连贯，有意义的话，不要用短语。</p>
<p>**第一句：**问题/背景，突出复杂性</p>
<p>**第二句：**我独立使用（负责）某方法/技巧。突出你的技术</p>
<p>**第三句：**达成的成绩。突出你的成果。</p>
<p><strong>体现你的能力</strong></p>
<p>比如：</p>
<p><strong>1.）体现你的爬虫设计与优化能力</strong></p>
<ul>
<li>
<p>公司现有爬虫性能较差，每天只能日抓30万张页面，我负责把爬虫重构成异步爬虫，并优化网络性能，让单台低配置机器定向抓取200百万张页面</p>
</li>
<li>
<p>公司现有爬虫性能较差，只能日抓30万张页面，我用10天时间重构为异步爬虫，并优化网络性能与重新设计抓取策略，让单台低配置机器定向抓取200百万张页面，后负责维护该爬虫。</p>
</li>
</ul>
<p><strong>2.）体现技能方面</strong></p>
<ul>
<li>运用KKK方法破解XXX网/OOO网/PPP网的JS反爬，后成为公司破解JS反爬方面的生力军。</li>
</ul>
<p><strong>3.）综合技能运用</strong></p>
<p><strong>对比改前：</strong></p>
<pre><code>**项目经验：**

	所用技术：Redis + MongoDB + requests

	使用requests库请求网页
</code></pre>
<p>​		 用redis做缓存管理</p>
<pre><code>	使用MongoDB存储网页

	用打码平台解决验证码，滑块问题。
</code></pre>
<p><strong>改后：</strong></p>
<pre><code>	设计爬虫对天眼查进行抓取

	综合运用社会工程手段（打码，大规模IP等）绕过天眼查的账号登陆，滑块验证。

	借助redis做异步队列，把抓取数据刷入mongo做持久化存储，爬虫可达到XX百万（XX十万抓取量）
</code></pre>
<p><strong>简历与面试禁忌：</strong></p>
<p>1.不要在简历写诸如：我可以无偿加班 我吃苦耐劳之类过头的话。</p>
<p>2.少写精通两字。</p>
<p>3.别在面试中把待遇福利细节问得很细（通知你被录入时，再跟行政详细询问）</p>
<p>4.不会的问题 就回答不会，不要乱扯。</p>
<p>5.简历内容过于夸张，面试时缺一问三不知。</p>
<p>6.简历上的逻辑要自洽 工作时间 描述事实要自洽。</p>
<p>​</p>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>爬虫进阶</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://www.fomal.cc/posts/f27b843b.html">https://www.fomal.cc/posts/f27b843b.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>czz🕉️</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2023-02-28</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2025-05-10</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%88%AC%E8%99%AB/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>爬虫</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">投喂作者</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://tuchuang.voooe.cn/images/2023/01/04/2.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/01/04/2.webp" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://tuchuang.voooe.cn/images/2023/01/04/20f8e49805975b8f8.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/images/2023/01/04/20f8e49805975b8f8.webp" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/9766d63c.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2023/04/11/6434e6c1629c5.jpg" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">mathtype</div></div></a></div><div class="next-post pull-right"><a href="/posts/5c0a4593.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.staticaly.com/gh/czzczzczz/image@main/202302211041120.png" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">爬虫基础</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#javascript%E8%B0%83%E8%AF%95"><span class="toc-text">javascript调试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%B5%8F%E8%A7%88%E5%99%A8%E9%9D%A2%E6%9D%BF%E8%A1%A5%E5%85%85"><span class="toc-text">1. 浏览器面板补充</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Elements"><span class="toc-text">Elements</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Network"><span class="toc-text">Network</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sources"><span class="toc-text">Sources</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E6%A0%B7%E4%BE%8B"><span class="toc-text">5.1 样例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BF%87debugger"><span class="toc-text">5.1.1 浏览器过debugger</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-%E6%96%B9%E6%B3%95%E7%BD%AE%E7%A9%BA"><span class="toc-text">5.1.2 方法置空</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-13-%E8%BF%87OB%E6%B7%B7%E6%B7%86debugger"><span class="toc-text">5.13 过OB混淆debugger</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-hook%E6%8A%80%E6%9C%AF"><span class="toc-text">6  hook技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-Hook%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="toc-text">6.1 Hook步骤：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-HOOK-cookie%E6%93%8D%E4%BD%9C"><span class="toc-text">6.2 HOOK cookie操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-hook-%E6%96%B9%E6%B3%95"><span class="toc-text">6.3 hook 方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-hook-XHR%E8%AF%B7%E6%B1%82"><span class="toc-text">6.4 hook  XHR请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-python%E6%89%A7%E8%A1%8CJS%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">7 python执行JS的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-1-PyExecJS"><span class="toc-text">7.1 PyExecJS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E6%B5%8F%E8%A7%88%E5%99%A8%E7%8E%AF%E5%A2%83%E8%A1%A5%E5%85%85%E6%96%B9%E6%B3%95"><span class="toc-text">8 浏览器环境补充方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%91%98%E8%A6%81%E7%AE%97%E6%B3%95"><span class="toc-text">摘要算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-MD5"><span class="toc-text">1. MD5</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-JavaScript-%E5%AE%9E%E7%8E%B0"><span class="toc-text">1.1 JavaScript 实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-Python-%E5%AE%9E%E7%8E%B0"><span class="toc-text">1.2 Python 实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-SHA"><span class="toc-text">2. SHA</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-JavaScript-%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.1  JavaScript 实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-Python-%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.2 Python 实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-HMAC"><span class="toc-text">3. HMAC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-JavaScript-%E5%AE%9E%E7%8E%B0"><span class="toc-text">3.1 JavaScript 实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-Python-%E5%AE%9E%E7%8E%B0"><span class="toc-text">3.2 Python 实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="toc-text">4. 实战案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E6%A1%88%E4%BE%8B-md5%E5%8A%A0%E5%AF%86%E9%80%86%E5%90%91"><span class="toc-text">4.1 案例 md5加密逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87"><span class="toc-text">4.1.1 逆向目标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-2-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-text">4.1.2 逆向分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-3-python%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%8B%9F"><span class="toc-text">4.1.3 python代码模拟</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E6%A1%88%E4%BE%8Bsha256%E7%B3%BB%E5%88%97"><span class="toc-text">4.2 案例sha256系列</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-1-%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90%EF%BC%9A"><span class="toc-text">4.2.1  抓包分析：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-2-%E8%B0%83%E8%AF%95%E5%8A%A0%E5%AF%86%E5%9C%B0%E5%9C%B0%E7%82%B9"><span class="toc-text">4.2.2 调试加密地地点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-3-python%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">4.2.3 python代码实现</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86"><span class="toc-text">对称加密</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95%E5%BD%92%E7%BA%B3"><span class="toc-text">常见算法归纳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-DES%E7%AE%97%E6%B3%95"><span class="toc-text">1. DES算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-JavaScript-%E5%AE%9E%E7%8E%B0-2"><span class="toc-text">1.1 JavaScript 实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-Python-%E5%AE%9E%E7%8E%B0-2"><span class="toc-text">1.2 Python 实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%AE%9E%E6%93%8D%E7%BB%83%E4%B9%A01"><span class="toc-text">1.3 实操练习1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%AE%9E%E6%93%8D%E7%BB%83%E4%B9%A02"><span class="toc-text">1.4 实操练习2</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87"><span class="toc-text">1.3.1 逆向目标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-2-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-text">1.3.2 逆向分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-3-%E6%95%B0%E6%8D%AE%E8%BF%98%E5%8E%9F"><span class="toc-text">1.3.3  数据还原</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-AES%E7%AE%97%E6%B3%95"><span class="toc-text">2. AES算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E7%AE%97%E6%B3%95%E7%AE%80%E4%BB%8B"><span class="toc-text">2.1 算法简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-JavaScript-%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.2  JavaScript 实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-Python-%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.3 Python 实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%AE%9E%E9%99%85%E6%A1%88%E4%BE%8B"><span class="toc-text">2.4 实际案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87"><span class="toc-text">2.4.1 逆向目标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-2-%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90"><span class="toc-text">2.4.2 抓包分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-3-%E5%8F%82%E6%95%B0%E9%80%86%E5%90%91"><span class="toc-text">2.4.3 参数逆向</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#2-4-3-sign%E7%AD%BE%E5%90%8D%E5%A4%84%E7%90%86"><span class="toc-text">2.4.3 sign签名处理</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-4-4-password%E5%A4%84%E7%90%86"><span class="toc-text">2.4.4 password处理</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86"><span class="toc-text">非对称加密</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%9D%9E%E5%AF%B9%E7%A7%B0%E7%AE%80%E4%BB%8B"><span class="toc-text">1 非对称简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%9D%9E%E5%AF%B9%E7%A7%B0%E7%89%B9%E5%BE%81"><span class="toc-text">2 非对称特征</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-JavaScript-%E5%AE%9E%E7%8E%B0-2"><span class="toc-text">2.1  JavaScript 实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-Python-%E5%AE%9E%E7%8E%B0-2"><span class="toc-text">2.2 Python 实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98"><span class="toc-text">3 案例实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90"><span class="toc-text">3.1 抓包分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%8F%82%E6%95%B0%E9%80%86%E5%90%91"><span class="toc-text">3.2 参数逆向</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-JS%E4%BB%A3%E7%A0%81"><span class="toc-text">3.3 JS代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-python%E4%BB%A3%E7%A0%81"><span class="toc-text">3.4 python代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98"><span class="toc-text">4. 案例实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E9%80%86%E5%90%91%E5%8F%82%E6%95%B0"><span class="toc-text">4.1 逆向参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-text">4.2 逆向分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-JavaScript%E5%88%86%E6%9E%90"><span class="toc-text">4.3 JavaScript分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-%E5%AF%86%E9%92%A5%E5%88%86%E6%9E%90"><span class="toc-text">4.4 密钥分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F"><span class="toc-text">4.5 算法还原</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-1-%E7%94%A8python%E6%A8%A1%E6%8B%9F%E8%AF%B7%E6%B1%82%E6%B5%8B%E8%AF%95"><span class="toc-text">4.5.1 用python模拟请求测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-2-JavaScript%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="toc-text">4.5.2  JavaScript测试代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-3-%E5%AF%86%E7%A0%81%E8%8E%B7%E5%8F%96"><span class="toc-text">4.5.3 密码获取</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebPack%E6%89%93%E5%8C%85"><span class="toc-text">WebPack打包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-webpack%E6%89%93%E5%8C%85%E7%AE%80%E4%BB%8B"><span class="toc-text">1. webpack打包简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-0-%E5%A4%9A%E4%B8%AAJS%E6%96%87%E4%BB%B6%E6%89%93%E5%8C%85%EF%BC%9A"><span class="toc-text">1.0 多个JS文件打包：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-webpack%E6%95%B0%E7%BB%84%E5%BD%A2%E5%BC%8F"><span class="toc-text">1.1 webpack数组形式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-webpack%E5%AF%B9%E8%B1%A1%E5%BD%A2%E5%BC%8F"><span class="toc-text">1.2 webpack对象形式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-webpack%E6%95%99%E5%AD%A6"><span class="toc-text">2. webpack教学</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87"><span class="toc-text">2.1 逆向目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-text">2.2 逆向分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E4%BB%A3%E7%A0%81%E5%A4%84%E7%90%86"><span class="toc-text">2.3 代码处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-webpack%E6%95%99%E5%AD%A6"><span class="toc-text">3. webpack教学</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87"><span class="toc-text">3.1 逆向目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-text">3.2 逆向分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-1-%E5%85%B3%E9%94%AE%E5%AD%97%E6%90%9C%E7%B4%A2"><span class="toc-text">3.2.1 关键字搜索</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-2-JavaScript%E5%88%86%E6%9E%90"><span class="toc-text">3.2.2 JavaScript分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E4%BB%A3%E7%A0%81%E5%A4%84%E7%90%86"><span class="toc-text">3.3 代码处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RPC-%E6%8A%80%E6%9C%AF"><span class="toc-text">RPC 技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-JSRPC-%E7%AE%80%E4%BB%8B"><span class="toc-text">1. JSRPC 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Sekiro-RPC"><span class="toc-text">2. Sekiro-RPC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-sk%E9%A3%9F%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-text">2.1 sk食用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-0-%E7%BD%91%E7%9B%98%E5%9C%B0%E5%9D%80"><span class="toc-text">2.1.0 网盘地址</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-1-%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8F"><span class="toc-text">2.1.1 执行方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-2-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%8E%AF%E5%A2%83"><span class="toc-text">2.2.2 客户端环境</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-text">2.2.3 参数说明</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%B5%8B%E8%AF%95%E4%BD%BF%E7%94%A8"><span class="toc-text">2.2 测试使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-1%E6%96%B0%E5%BB%BAHTML%E9%A1%B5%E9%9D%A2"><span class="toc-text">2.2.1 1新建HTML页面</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-2-SK-API"><span class="toc-text">2.2.2 SK API</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-python%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95"><span class="toc-text">2.2.3 python代码调试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%B3%A8%E5%85%A5"><span class="toc-text">2.3 控制台注入</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-0-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87"><span class="toc-text">2.3.0 逆向目标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-%E6%89%BE%E5%88%B0%E5%85%B3%E9%94%AE%E7%82%B9"><span class="toc-text">2.3.1 找到关键点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%B3%A8%E5%85%A5"><span class="toc-text">2.3.2 在控制台注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B9%B6%E8%BD%AC%E5%8F%91"><span class="toc-text">2.3.3 连接服务器并转发</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E6%B2%B9%E7%8C%B4%E6%B3%A8%E5%85%A5%E5%BD%A2%E5%BC%8F"><span class="toc-text">2.4 油猴注入形式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-1-%E6%B2%B9%E7%8C%B4%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D"><span class="toc-text">2.4.1 油猴工具介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-2-%E7%BC%96%E5%86%99%E6%B2%B9%E7%8C%B4%E6%B3%A8%E5%85%A5"><span class="toc-text">2.4.2 编写油猴注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-3-python%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8"><span class="toc-text">2.4.3 python代码调用</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-JS%E6%B3%A8%E5%85%A5%E5%8A%A8%E6%80%81%E4%BC%A0%E5%8F%82"><span class="toc-text">2.5 JS注入动态传参</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87"><span class="toc-text">2.5.1 逆向目标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-2-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-text">2.5.2 逆向分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-2-RPC%E6%B3%A8%E5%85%A5%E8%BF%9B%E5%8E%BB"><span class="toc-text">2.5.2  RPC注入进去</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-3-%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8"><span class="toc-text">2.5.3  接口调用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-4-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-text">2.5.4 数据处理</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSVMP"><span class="toc-text">JSVMP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E4%BB%8B"><span class="toc-text">1 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-js%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BF%9D%E6%8A%A4%E6%96%B9%E6%A1%88"><span class="toc-text">1.1 js虚拟机保护方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90"><span class="toc-text">2 实战分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87-2"><span class="toc-text">2.1  逆向目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-2"><span class="toc-text">2.2 逆向分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-%E8%A1%A5%E7%8E%AF%E5%A2%83%E6%93%8D%E4%BD%9C"><span class="toc-text">2.2.1 补环境操作</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1%E3%80%81%E8%A1%A5%E5%85%85%E7%AC%AC%E4%B8%80%E4%B8%AAreferrer"><span class="toc-text">1、补充第一个referrer</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2%E3%80%81%E8%A1%A5%E5%85%85sign"><span class="toc-text">2、补充sign</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3%E3%80%81%E8%A1%A5%E5%85%85-href"><span class="toc-text">3、补充 href</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4%E3%80%81%E8%A1%A5-length"><span class="toc-text">4、补 length</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5%E3%80%81%E8%A1%A5useragent"><span class="toc-text">5、补useragent</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#6%E3%80%81%E5%8F%82%E6%95%B0%E9%95%BF%E7%9F%AD%E8%A1%A5%E5%85%85"><span class="toc-text">6、参数长短补充</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E6%A1%88%E4%BE%8Bcode"><span class="toc-text">2.3 案例code</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E7%8E%AF%E5%A2%83%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B"><span class="toc-text">补环境系列教程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%93%8D%E4%B8%80"><span class="toc-text">1 项目实操一</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87"><span class="toc-text">1.1  逆向目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-text">1.2 逆向分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%93%8D%E4%BA%8C"><span class="toc-text">2 项目实操二</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87-3"><span class="toc-text">2.1 逆向目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%A1%A5%E7%8E%AF%E5%A2%83%E5%AE%9E%E6%93%8D"><span class="toc-text">2.2 补环境实操</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%90%90%E7%8E%AF%E5%A2%83%E8%84%9A%E6%9C%AC"><span class="toc-text">3 吐环境脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">3.1 简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99"><span class="toc-text">3.2 脚本编写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-jsdom%E8%A1%A5%E7%8E%AF%E5%A2%83"><span class="toc-text">4 jsdom补环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="toc-text">4.1 环境安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">4.2 基本使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E6%B7%BB%E5%8A%A0%E5%8F%82%E6%95%B0%E5%BD%A2%E5%BC%8F"><span class="toc-text">4.3 添加参数形式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#COOkIE%E5%8F%8D%E7%88%AC%E8%99%AB"><span class="toc-text">COOkIE反爬虫</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-cookie%E5%8F%8D%E7%88%AC%E7%AE%80%E4%BB%8B"><span class="toc-text">1 cookie反爬简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-cookie%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86"><span class="toc-text">1.1 cookie加密原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-cookie%E9%80%86%E5%90%91%E5%AE%9E%E8%B7%B51"><span class="toc-text">2 cookie逆向实践1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87-4"><span class="toc-text">2.1 逆向目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-3"><span class="toc-text">2.2 逆向分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E9%80%86%E5%90%91%E7%BB%93%E6%9E%9C"><span class="toc-text">2.3 逆向结果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-cookie%E9%80%86%E5%90%91%E5%AE%9E%E6%88%98"><span class="toc-text">3. cookie逆向实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87-2"><span class="toc-text">3.1 逆向目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-2"><span class="toc-text">3.2 逆向分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-2-JS-%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90"><span class="toc-text">3.2.2 JS 调试分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E9%80%86%E5%90%91%E7%BB%93%E6%9E%9C"><span class="toc-text">3.3 逆向结果</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-1-Js%E8%BF%98%E5%8E%9F"><span class="toc-text">3.3.1 Js还原</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-2-python%E8%BF%98%E5%8E%9F"><span class="toc-text">3.3.2 python还原</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8"><span class="toc-text">4 工具使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BB%91%E5%9D%97%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-text">滑块验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%BB%91%E5%9D%97%E7%AE%80%E4%BB%8B"><span class="toc-text">1. 滑块简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E6%A0%B8%E5%BF%83%E6%AD%A5%E9%AA%A4"><span class="toc-text">1.1 核心步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E7%AA%81%E7%A0%B4%E8%A7%84%E5%88%99"><span class="toc-text">1.2 突破规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E9%AA%8C%E8%AF%81%E7%A0%81%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86"><span class="toc-text">1.3 验证码图片处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E8%83%8C%E6%99%AF%E6%BB%91%E5%9D%97%E8%AF%86%E5%88%AB"><span class="toc-text">1.4 背景滑块识别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9E%81%E9%AA%8C%E6%BB%91%E5%9D%97%E5%AE%9E%E6%88%98"><span class="toc-text">2  极验滑块实战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%89%8B%E6%92%95%E6%BB%91%E5%9D%97"><span class="toc-text">3 手撕滑块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%BA%95%E5%9B%BE%E8%BF%98%E5%8E%9F"><span class="toc-text">1、底图还原</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%B7%9FW%E5%80%BC"><span class="toc-text">2、跟W值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%88%86%E6%9E%90U%E7%94%9F%E6%88%90"><span class="toc-text">2.1 分析U生成</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-1-%E5%A4%84%E7%90%86%E6%98%8E%E6%96%87"><span class="toc-text">2.1.1 处理明文</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-2-%E5%A4%84%E7%90%86%E5%8A%A0%E5%AF%86%E6%96%B9%E6%B3%95"><span class="toc-text">2.1.2 处理加密方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%88%86%E6%9E%90l%E5%80%BC"><span class="toc-text">2.2 分析l值</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-%E5%A4%84%E7%90%86o%E5%80%BC"><span class="toc-text">2.2.1 处理o值</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1%E3%80%81%E5%85%88%E5%A4%84%E7%90%86aa%E7%9A%84%E5%80%BC"><span class="toc-text">1、先处理aa的值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2%E3%80%81%E5%A4%84%E7%90%86%E5%85%B6%E4%BB%96%E5%80%BC"><span class="toc-text">2、处理其他值</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#4%E3%80%81%E5%A4%84%E7%90%86L%E5%80%BC"><span class="toc-text">4、处理L值</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%88%86%E6%9E%90h%E5%80%BC"><span class="toc-text">2.3 分析h值</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%9C%AC%E6%B7%B7%E6%B7%86%E7%AB%A0%E8%8A%82"><span class="toc-text">文本混淆章节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%96%87%E6%9C%AC%E6%B7%B7%E6%B7%86%E7%AE%80%E4%BB%8B"><span class="toc-text">1.  文本混淆简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B9%B2%E6%89%B0%E6%96%B9%E5%BC%8F"><span class="toc-text">1.1 常见的干扰方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AD%97%E4%BD%93%E5%8F%8D%E7%88%AC"><span class="toc-text">2. 字体反爬</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%AD%97%E4%BD%93%E5%8F%8D%E7%88%AC%E7%AE%80%E4%BB%8B"><span class="toc-text">2.1 字体反爬简介</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9F%90%E4%B9%A0%E5%AD%97%E4%BD%93%E5%8F%8D%E7%88%AC%E5%AE%9E%E8%B7%B5"><span class="toc-text">3.  某习字体反爬实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87-3"><span class="toc-text">3.1 逆向目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90-3"><span class="toc-text">3.2 逆向分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-1-%E7%BD%91%E9%A1%B5%E5%88%86%E6%9E%90"><span class="toc-text">3.2.1 网页分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-2-%E9%A1%B5%E9%9D%A2%E5%A4%84%E7%90%86"><span class="toc-text">3.2.2 页面处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-3-%E5%AD%97%E4%BD%93%E5%88%86%E6%9E%90"><span class="toc-text">3.3.3 字体分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E9%80%86%E5%90%91%E7%BB%93%E6%9E%9C-2"><span class="toc-text">3.3 逆向结果</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-1-%E5%AE%8C%E6%95%B4code"><span class="toc-text">3.3.1 完整code</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AD%97%E4%BD%93%E8%A7%A3%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="toc-text">4. 字体解析工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E5%AD%97%E4%BD%93%E8%AF%BB%E5%8F%96"><span class="toc-text">4.2 字体读取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E8%8A%82%E7%82%B9%E8%AF%BB%E5%8F%96"><span class="toc-text">4.3 节点读取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E5%88%B0%E7%9A%84%E5%AD%97%E4%BD%93code%E5%92%8Cname%E7%9A%84%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB"><span class="toc-text">4.4 获取请求到的字体code和name的对应关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-%E8%8E%B7%E5%8F%96%E5%AD%97%E4%BD%93%E5%9D%90%E6%A0%87%E4%BF%A1%E6%81%AF"><span class="toc-text">4.5 获取字体坐标信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%9F%90%E8%BD%A6%E5%AD%97%E4%BD%93%E5%8F%8D%E7%88%AC"><span class="toc-text">5. 某车字体反爬</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E9%80%86%E5%90%91%E7%9B%AE%E6%A0%87"><span class="toc-text">5.1 逆向目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-text">5.2 逆向分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2-1-%E5%8E%9F%E5%AD%97%E5%BD%A2%E8%BF%98%E5%8E%9F"><span class="toc-text">5.2.1 原字形还原</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E9%80%86%E5%90%91%E4%BB%A3%E7%A0%81"><span class="toc-text">5.3 逆向代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Scrapy%E9%87%87%E9%9B%86%E6%A1%86%E6%9E%B6"><span class="toc-text">Scrapy采集框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87"><span class="toc-text">1 学习目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-scrapy%E7%AE%80%E4%BB%8B"><span class="toc-text">2 scrapy简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-0-%E5%8D%95%E4%B8%AA%E7%88%AC%E8%99%AB%E7%BC%96%E5%86%99"><span class="toc-text">2.0 单个爬虫编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D"><span class="toc-text">2.1 架构介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E5%90%8D%E8%AF%8D%E8%A7%A3%E6%9E%90"><span class="toc-text">2.2.1 名词解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E8%BF%90%E8%A1%8C%E9%80%BB%E8%BE%91%E5%9B%BE"><span class="toc-text">2.2.2 运行逻辑图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8"><span class="toc-text">3 框架使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-text">3.1 项目搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E6%A1%86%E6%9E%B6%E5%AE%89%E8%A3%85"><span class="toc-text">3.1.1 框架安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA"><span class="toc-text">3.1.2  项目创建</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-%E5%88%9B%E5%BB%BA%E7%88%AC%E8%99%AB"><span class="toc-text">3.1.3 创建爬虫</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%89%A7%E8%A1%8C%E7%88%AC%E8%99%AB"><span class="toc-text">3.2 执行爬虫</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E7%BB%88%E7%AB%AF%E8%BF%90%E8%A1%8C%E7%88%AC%E8%99%AB"><span class="toc-text">3.2.1 终端运行爬虫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E8%84%9A%E6%9C%AC%E8%BF%90%E8%A1%8C"><span class="toc-text">3.2.2 脚本运行</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-scrapy-shell%E8%B0%83%E8%AF%95"><span class="toc-text">3.3  scrapy shell调试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%AE%9E%E6%88%98%E6%BC%94%E7%A4%BA"><span class="toc-text">4 实战演示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-spider%E7%BB%93%E6%9E%84"><span class="toc-text">4.1  spider结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE"><span class="toc-text">4.2 定义数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%AE%9A%E4%B9%89%E7%AE%A1%E9%81%93%E5%AD%98%E5%82%A8"><span class="toc-text">4.3 定义管道存储</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-%E9%85%8D%E7%BD%AE%E7%AE%A1%E9%81%93"><span class="toc-text">4.3.1 配置管道</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-2-%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="toc-text">4.3.2 存储文件编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-%E9%85%8D%E7%BD%AE%E6%97%A5%E5%BF%97"><span class="toc-text">4.3.3 配置日志</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-scrapy%E8%A1%A8%E5%8D%95%E5%A4%84%E7%90%86"><span class="toc-text">5 scrapy表单处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E7%9B%AE%E6%A0%87%E5%9C%B0%E5%9D%80"><span class="toc-text">5.1 目标地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99"><span class="toc-text">5.2 程序编写</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%A1%86%E6%9E%B6%E6%89%A9%E5%B1%95"><span class="toc-text">6 框架扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%A1%86%E6%9E%B6%E5%8E%BB%E9%87%8D%E8%AE%BE%E8%AE%A1"><span class="toc-text">6.1 框架去重设计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Scrapy%E5%8A%9F%E8%83%BD%E5%AD%A6%E4%B9%A0"><span class="toc-text">Scrapy功能学习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-scrapy%E6%95%B0%E6%8D%AE%E6%8F%90%E5%8F%96"><span class="toc-text">1 scrapy数据提取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8"><span class="toc-text">1.1. 直接使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-xpath%E9%80%89%E6%8B%A9%E5%99%A8"><span class="toc-text">1.2 xpath选择器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D"><span class="toc-text">1.3 正则匹配</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-scrapy%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">2 scrapy中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E7%9B%AE%E7%9A%84"><span class="toc-text">2.1 目的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-text">2.2 中间件介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">2.3 自定义中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-%E6%8B%93%E5%B1%95%E4%B8%93%E9%A2%98-%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-text">2.3.1 拓展专题-配置自动化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-scrapy%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="toc-text">3 scrapy数据存储</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%9F%BA%E4%BA%8Emongo%E5%AD%98%E5%82%A8"><span class="toc-text">3.1 基于mongo存储</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-1-%E7%88%AC%E8%99%AB%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="toc-text">3.1.1  爬虫文件编写</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-2-%E7%AE%A1%E9%81%93%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="toc-text">3.1.2  管道文件编写</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%9F%BA%E4%BA%8EMySQL%E5%AD%98%E5%82%A8"><span class="toc-text">3.2 基于MySQL存储</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-1-%E9%85%8D%E7%BD%AE%E7%BC%96%E5%86%99"><span class="toc-text">3.2.1 配置编写</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-2-%E5%AD%98%E5%82%A8%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="toc-text">3.2.2 存储文件编写</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#feapder-%E6%A1%86%E6%9E%B6"><span class="toc-text">feapder 框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-2"><span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E4%BB%8B-2"><span class="toc-text">1 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E6%94%AF%E6%8C%81%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-text">1.1  支持的场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%9E%B6%E6%9E%84%E8%AF%B4%E6%98%8E"><span class="toc-text">1.2 架构说明</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1%E6%A8%A1%E5%9D%97%E8%AF%B4%E6%98%8E"><span class="toc-text">1.2.1模块说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-%E6%B5%81%E7%A8%8B%E8%AF%B4%E6%98%8E"><span class="toc-text">1.2.2 流程说明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8"><span class="toc-text">2 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="toc-text">2.1 环境安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%88%9B%E5%BB%BA%E6%99%AE%E9%80%9A%E7%88%AC%E8%99%AB"><span class="toc-text">2.2 创建普通爬虫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E7%88%AC%E8%99%AB%E5%B0%8F%E6%A1%88%E4%BE%8B"><span class="toc-text">2.3 爬虫小案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-%E6%95%B0%E6%8D%AE%E5%85%A5%E5%BA%93"><span class="toc-text">2.3.1 数据入库</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">2.4 自定义中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8B%E8%BD%BD%E5%99%A8"><span class="toc-text">2.5 自定义下载器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-%E5%AF%B9%E6%8E%A5%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-text">2.6 对接自动化</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-%E6%93%8D%E4%BD%9C%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AF%B9%E8%B1%A1"><span class="toc-text">2.6.2 操作浏览器对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-3-%E6%8B%A6%E6%88%AAXHR-%E6%95%B0%E6%8D%AE"><span class="toc-text">2.6.3 拦截XHR 数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-4-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="toc-text">2.6.4 示例代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-text">3 项目搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-text">3.1 创建项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%88%9B%E5%BB%BA%E6%99%AE%E9%80%9A%E7%88%AC%E8%99%AB"><span class="toc-text">3.2 创建普通爬虫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-text">3.3 配置自动化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%88%86%E6%9E%90"><span class="toc-text">3.4 业务逻辑分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-1-%E7%BF%BB%E9%A1%B5"><span class="toc-text">3.5.1 翻页</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-2-%E7%82%B9%E5%87%BB"><span class="toc-text">3.5.2 点击</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90"><span class="toc-text">3.5 数据解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-%E6%95%B0%E6%8D%AE%E5%85%A5%E5%BA%93"><span class="toc-text">3.6 数据入库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Scrapy-Redis-%E5%88%86%E5%B8%83%E5%BC%8F"><span class="toc-text">Scrapy-Redis 分布式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%86%E5%B8%83%E5%BC%8F%E6%A6%82%E8%BF%B0"><span class="toc-text">1 分布式概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-0-scrapy-redis%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">1.0 scrapy-redis是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%88%86%E5%B8%83%E5%BC%8F%E7%AE%80%E4%BB%8B"><span class="toc-text">1.1 分布式简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B"><span class="toc-text">1.2 框架简介</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-%E7%8E%AF%E5%A2%83%E5%BB%BA%E8%AE%BE"><span class="toc-text">1.2.1  环境建设</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-scrapy-redis%E7%BB%84%E4%BB%B6"><span class="toc-text">1.2.2 scrapy-redis组件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE"><span class="toc-text">2 分布式配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-redis%E9%85%8D%E7%BD%AE"><span class="toc-text">2.1 redis配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE"><span class="toc-text">2.2 核心配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-%E9%85%8D%E7%BD%AE%E8%B0%83%E5%BA%A6%E9%98%9F%E5%88%97"><span class="toc-text">2.2.1 配置调度队列</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-2-%E9%85%8D%E7%BD%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">2.2.2 配置持久化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-%E9%85%8D%E7%BD%AE%E9%87%8D%E7%88%AC"><span class="toc-text">2.2.3 配置重爬</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98"><span class="toc-text">3 项目实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E7%9B%AE%E6%A0%87%E5%9C%B0%E5%9D%80"><span class="toc-text">3.1 目标地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E9%A1%B9%E7%9B%AE%E5%88%86%E6%9E%90"><span class="toc-text">3.2 项目分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-text">3.3 项目结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%89%A9%E5%B1%95%E6%96%B9%E9%9D%A2"><span class="toc-text">4 扩展方面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%88%AC%E8%99%AB%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="toc-text">爬虫项目部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%84%9A%E6%9C%AC%E6%96%87%E4%BB%B6%E9%83%A8%E7%BD%B2"><span class="toc-text">1 脚本文件部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-crontab%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">1.1 crontab的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%B8%BA%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E5%88%9B%E5%BB%BAcron%E6%9C%8D%E5%8A%A1"><span class="toc-text">1.2  为当前用户创建cron服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%8D%95%E4%B8%AA%E8%84%9A%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E9%83%A8%E7%BD%B2"><span class="toc-text">1.3  单个脚本使用定时任务部署</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-1-%E4%B8%8A%E4%BC%A0%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">1.3.1 上传本地文件到服务器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-2-%E5%AE%9A%E6%97%B6%E9%87%87%E9%9B%86%E4%BB%BB%E5%8A%A1"><span class="toc-text">1.3.2 定时采集任务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8scrapyd%E9%83%A8%E7%BD%B2"><span class="toc-text">2 使用scrapyd部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85-2"><span class="toc-text">2.1 环境安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%9F%A5%E8%AF%A2%E7%8A%B6%E6%80%81"><span class="toc-text">2.2 查询状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E7%88%AC%E8%99%AB%E9%83%A8%E7%BD%B2"><span class="toc-text">2.3 爬虫部署</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-%E5%8F%91%E5%B8%83%E9%A1%B9%E7%9B%AE"><span class="toc-text">2.3.1 发布项目</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-%E5%90%AF%E5%8A%A8%E7%88%AC%E8%99%AB"><span class="toc-text">2.3.2 启动爬虫</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-%E5%81%9C%E6%AD%A2%E7%88%AC%E8%99%AB"><span class="toc-text">2.3.3 停止爬虫</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-4-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E9%A1%B9%E7%9B%AE"><span class="toc-text">2.3.4 查看当前项目</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-4-%E6%9F%A5%E7%9C%8B%E8%AF%A6%E6%83%85"><span class="toc-text">2.3.4 查看详情</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-5-%E4%BA%A4%E4%BA%92%E8%B0%83%E8%AF%95"><span class="toc-text">2.3.5 交互调试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Gerapy%E7%88%AC%E8%99%AB%E9%83%A8%E7%BD%B2"><span class="toc-text">3 Gerapy爬虫部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="toc-text">3.1 环境安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="toc-text">3.2 项目部署</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-1-%E7%95%8C%E9%9D%A2%E5%B1%95%E7%A4%BA"><span class="toc-text">3.2.1  界面展示</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-2-%E7%88%AC%E8%99%AB%E9%83%A8%E7%BD%B2"><span class="toc-text">3.2.2 爬虫部署</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-docker%E5%AE%B9%E5%99%A8"><span class="toc-text">4 docker容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-docker%E7%AE%80%E4%BB%8B"><span class="toc-text">4.1 docker简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E8%99%9A%E6%8B%9F%E6%9C%BAvirtual-machine"><span class="toc-text">4.2 虚拟机virtual machine</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%AE%B9%E5%99%A8%E5%92%8C%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%AF%94%E8%BE%83"><span class="toc-text">4.3 容器和虚拟机比较</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-docker%E5%AE%89%E8%A3%85"><span class="toc-text">4.4 docker安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-%E9%95%9C%E5%83%8F%E4%BD%BF%E7%94%A8"><span class="toc-text">4.5 镜像使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-0-%E9%95%9C%E5%83%8F%E6%9F%A5%E6%89%BE"><span class="toc-text">4.5.0 镜像查找</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-1-%E9%95%9C%E5%83%8F%E5%88%97%E4%B8%BE"><span class="toc-text">4.5.1 镜像列举</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-2-%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-text">4.5.2 获取一个新的镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-3-%E6%9F%A5%E6%89%BE%E9%95%9C%E5%83%8F"><span class="toc-text">4.5.3 查找镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-4-%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F"><span class="toc-text">4.5.4 删除镜像</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8"><span class="toc-text">4.6 容器使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-6-2-%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">4.6.2 容器操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%88%AC%E8%99%AB%E7%AE%80%E5%8E%86%E5%88%86%E4%BA%AB"><span class="toc-text">5 爬虫简历分享</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>再看看那个光点，它就在这里，这是家园，这是我们 —— 你所爱的每一个人，你认识的一个人，你听说过的每一个人，曾经有过的每一个人，都在它上面度过他们的一生✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/posts/eec9786.html">魔改指南</a><a href="/box/nav/">网址导航</a></li><li><a href="/social/link/">我的朋友</a><a href="/comments/">留点什么</a></li><li><a href="/personal/about/">关于作者</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/box/Gallery/">我的画廊</a><a href="/personal/bb/">我的唠叨</a></li><li><a href="/site/time/">建设进程</a><a href="/site/census/">网站统计</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链⌛</p><div class="ft-img-group"><div class="img-group-item"><a href="https://www.fomal.cc/" title="Fomalhaut🥝"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/60e5d4e39da7c077.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div></div></div></div><div class="copyright"><span><b>&copy;2022-2025</b></span><span><b>&nbsp;&nbsp;By czz🕉️</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v6.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v4.3.1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="本站采用多线部署，主线路托管于Vercel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://user.51.la/" style="margin-inline:5px" title="本站数据分析得益于51la技术支持"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Analytics-51la-3db1eb.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20226665" style="margin-inline:5px" title="本站已加入萌ICP豪华套餐，萌ICP备20226665号"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/萌ICP备-20226665-fe1384.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://bitiful.dogecast.com/buckets" style="margin-inline:5px" title="本网站经Service Worker分流至缤纷云对象存储"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Bucket-缤纷云-9c62da.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://www.netdun.net/" style="margin-inline:5px" title="本站使用网盾星球提供CDN加速与防护"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/CDN-网盾星球-fff2cc.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本网站源码由Github提供存储仓库"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><div class="aplayer no-destroy" data-id="2379161415" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true" data-lrcType="-1"> </div><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><a class="magnet_link_more"  href="https://www.fomal.cc/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --></body></html>